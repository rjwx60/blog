---
typora-root-url: ../../Source
---



<img src="/Image/Basics/Special/Async/1.png" style="zoom:60%;" />



### 一、总结

#### 1-1、异步编程发展历程简述

- 阶段一：回调函数
  - 问题1：缺乏顺序性：其导致调试困难，并与大脑线性思维方式不符；
  - 问题2：缺乏可信任性： 控制反转导致系列信任问题；
- 阶段二：Promise 基于 PromiseA+ 规范的实现
  - 解决：上述问题2，重掌代码执行主动权；
- 阶段三：Generator(生成器函数) 用同步方式来书写代码
  - 解决：上述问题1，但需手动调用 next 方法，将回调成功返回的数据送回 JS 主流程中；
- 阶段四：Async/Await (结合 Promise & Generator)，在 await 后面跟 Promise，自动等待 Promise 决议值
  - 解决：Generator需要手动控制next(...)执行的问题、真正实现了用同步的方式书写异步代码；



#### 1-2、总结

剩：0-7、



### 二、传统回调

<img src="/Image/Basics/Special/Async/2.png" style="zoom:50%;" align="left" />

问题1：回调地狱：充满回调嵌套，代码横向纵向扩展、难以调试和维护、bug 追踪难度大、不符人脑线性处理；

问题2：控制反转：即把程序一部分的执行控制交给某个第三方，而代码和第三方之间没有一份明确表达的契约；

比如：C 先传出接收数据，后异步传回，此时数据是不被 C 可控的，且在第三方的控制下；

<img src="/Image/Basics/Special/Async/3.png" style="zoom:50%;" align="left" />





### 三、Promise

意义：解决因控制反转导致的信任问题



### 四、Generator

意义：解决顺序性问题

优点：解决不符合大脑顺序、线性的思维方式问题；缺点：需要手动控制next()执行；

#### 4-1、ES6 新增2协议：可迭代协议 & 迭代器协议 (补充)：

##### 4-1、可迭代协议

协议允许 Js 对象去定义或定制它们的迭代行为；比如：定义在一个 for...of 结构中，什么值可被循环得到；其中：内置可迭代对象且有默认迭代行为如下 (注意：Object不符合可迭代协议，[但可实现](https://www.imooc.com/qadetail/265962?lastmedia=1))：

- Array
- Map
- Set
- String
- TypeArray
- 函数的 Arguments 对象
- NodeList 对象

注意：为了变成可迭代对象，1个对象必须实现@@iterator方法；即此对象须有一名为 [Symbol.iterator] 的属性，其值为返回一个对象(须符合迭代器协议)的无参函数 (或对象原型链 prototype chain上的某个对象含有)；而当一个对象需要被迭代的时候 (比如开始用于一个for...of循环中) ，其 @@iterator 方法被调用，且无参数，最后返回一个用于在迭代中获得值的迭代器，



##### 4-2、迭代器协议

协议定义一种标准方式，来产生一个有限或无限序列的值；比如：当1个对象被认为是1个迭代器时，其实现了1个next 方法，方法是返回一个对象的无参函数，被返回对象拥有2个属性；

- **done：boolean**
  - 若迭代器已经过了被迭代序列时，则为 true，此时 value 可能描述了该迭代器的返回值；
  - 若迭代器可产生序列中的下1个值，则为 false，这等效于连同 done 属性也不指定；
- **value：any**
  - 迭代器返回的任何 JS 值，done 为 true 时可忽略；

<img src="/Image/Basics/Special/Async/4.png" style="zoom:50%;" align="" />

<img src="/Image/Basics/Special/Async/5.png" style="zoom:50%;" align="" />



#### 4-2、Generator

符合大脑思维习惯的同步书写形式，将异步流程封装到外面，而成功的回调函数里面调用it.next()，将传回的数据放到任务队列里进行排队，当 Js 主线程空闲时则从任务队列里依次取出回调任务并执行；

<img src="/Image/Basics/Special/Async/6.png" style="zoom:50%;" align="left" />

<img src="/Image/Basics/Special/Async/7.png" style="zoom:50%;" align="left" />











### 五、Async/Await

意义：解决 Generator 需手动控制 next 执行的问题(真正实现用同步方式书写异步代码)
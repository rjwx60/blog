<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>六、输入URL到展示过程 | Leibnize 个人学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="素材整理自网络，仅供个人学习记录之用">
    <link rel="preload" href="/assets/css/0.styles.4c1fe16c.css" as="style"><link rel="preload" href="/assets/js/app.58d463af.js" as="script"><link rel="preload" href="/assets/js/3.5b6bd7ce.js" as="script"><link rel="preload" href="/assets/js/1.53e5735b.js" as="script"><link rel="preload" href="/assets/js/171.01628965.js" as="script"><link rel="prefetch" href="/assets/js/10.47a34be1.js"><link rel="prefetch" href="/assets/js/100.2f7c82fb.js"><link rel="prefetch" href="/assets/js/101.57a81617.js"><link rel="prefetch" href="/assets/js/102.8befc7fd.js"><link rel="prefetch" href="/assets/js/103.c690f409.js"><link rel="prefetch" href="/assets/js/104.c8b86b63.js"><link rel="prefetch" href="/assets/js/105.9bac0b69.js"><link rel="prefetch" href="/assets/js/106.77dcd9f8.js"><link rel="prefetch" href="/assets/js/107.305a0cd6.js"><link rel="prefetch" href="/assets/js/108.197f379c.js"><link rel="prefetch" href="/assets/js/109.ed1f6dd8.js"><link rel="prefetch" href="/assets/js/11.d67029e2.js"><link rel="prefetch" href="/assets/js/110.b10adffc.js"><link rel="prefetch" href="/assets/js/111.27cb5e44.js"><link rel="prefetch" href="/assets/js/112.598f5429.js"><link rel="prefetch" href="/assets/js/113.b7f9fe99.js"><link rel="prefetch" href="/assets/js/114.cb9df12d.js"><link rel="prefetch" href="/assets/js/115.4d812f2c.js"><link rel="prefetch" href="/assets/js/116.3a4f5195.js"><link rel="prefetch" href="/assets/js/117.be29161e.js"><link rel="prefetch" href="/assets/js/118.eb6b99b9.js"><link rel="prefetch" href="/assets/js/119.b3f342d7.js"><link rel="prefetch" href="/assets/js/12.f13f81de.js"><link rel="prefetch" href="/assets/js/120.f343ff14.js"><link rel="prefetch" href="/assets/js/121.5983ebbd.js"><link rel="prefetch" href="/assets/js/122.8dd46465.js"><link rel="prefetch" href="/assets/js/123.71ffc4a2.js"><link rel="prefetch" href="/assets/js/124.4e568dbe.js"><link rel="prefetch" href="/assets/js/125.43b22375.js"><link rel="prefetch" href="/assets/js/126.6522a7eb.js"><link rel="prefetch" href="/assets/js/127.8308b909.js"><link rel="prefetch" href="/assets/js/128.1fd06c87.js"><link rel="prefetch" href="/assets/js/129.91e28eff.js"><link rel="prefetch" href="/assets/js/13.ac76083d.js"><link rel="prefetch" href="/assets/js/130.5027f9f0.js"><link rel="prefetch" href="/assets/js/131.4554c2f2.js"><link rel="prefetch" href="/assets/js/132.c643aed4.js"><link rel="prefetch" href="/assets/js/133.5e499634.js"><link rel="prefetch" href="/assets/js/134.59b1b330.js"><link rel="prefetch" href="/assets/js/135.da46fa8a.js"><link rel="prefetch" href="/assets/js/136.3a67d738.js"><link rel="prefetch" href="/assets/js/137.4d5f5f5e.js"><link rel="prefetch" href="/assets/js/138.1fe93dba.js"><link rel="prefetch" href="/assets/js/139.d7f54242.js"><link rel="prefetch" href="/assets/js/14.8e5c3120.js"><link rel="prefetch" href="/assets/js/140.82be0f82.js"><link rel="prefetch" href="/assets/js/141.979c5a91.js"><link rel="prefetch" href="/assets/js/142.658ae82d.js"><link rel="prefetch" href="/assets/js/143.17532399.js"><link rel="prefetch" href="/assets/js/144.dc947607.js"><link rel="prefetch" href="/assets/js/145.fc89bd8c.js"><link rel="prefetch" href="/assets/js/146.a5e1b7eb.js"><link rel="prefetch" href="/assets/js/147.0f8384fc.js"><link rel="prefetch" href="/assets/js/148.fccbb459.js"><link rel="prefetch" href="/assets/js/149.d2d32bbc.js"><link rel="prefetch" href="/assets/js/15.e17af96c.js"><link rel="prefetch" href="/assets/js/150.73f88a17.js"><link rel="prefetch" href="/assets/js/151.dd85d521.js"><link rel="prefetch" href="/assets/js/152.ca632725.js"><link rel="prefetch" href="/assets/js/153.02b859a6.js"><link rel="prefetch" href="/assets/js/154.268e5dd0.js"><link rel="prefetch" href="/assets/js/155.0df9a80c.js"><link rel="prefetch" href="/assets/js/156.0e786e96.js"><link rel="prefetch" href="/assets/js/157.79cdcd86.js"><link rel="prefetch" href="/assets/js/158.8a131380.js"><link rel="prefetch" href="/assets/js/159.7aed0b17.js"><link rel="prefetch" href="/assets/js/16.472bfca7.js"><link rel="prefetch" href="/assets/js/160.31daa77a.js"><link rel="prefetch" href="/assets/js/161.a44e6bf4.js"><link rel="prefetch" href="/assets/js/162.86180287.js"><link rel="prefetch" href="/assets/js/163.c9fd632a.js"><link rel="prefetch" href="/assets/js/164.15e04e68.js"><link rel="prefetch" href="/assets/js/165.69bcb02b.js"><link rel="prefetch" href="/assets/js/166.084ab8e2.js"><link rel="prefetch" href="/assets/js/167.0f42977a.js"><link rel="prefetch" href="/assets/js/168.a4474b7b.js"><link rel="prefetch" href="/assets/js/169.3d05b3ba.js"><link rel="prefetch" href="/assets/js/17.f9d21c6e.js"><link rel="prefetch" href="/assets/js/170.484ffe30.js"><link rel="prefetch" href="/assets/js/172.2dc6c763.js"><link rel="prefetch" href="/assets/js/173.4fa13f79.js"><link rel="prefetch" href="/assets/js/174.5da03623.js"><link rel="prefetch" href="/assets/js/175.7c3cae2a.js"><link rel="prefetch" href="/assets/js/176.3df0d63b.js"><link rel="prefetch" href="/assets/js/177.3aa8d705.js"><link rel="prefetch" href="/assets/js/178.5b48450e.js"><link rel="prefetch" href="/assets/js/179.3a963dce.js"><link rel="prefetch" href="/assets/js/18.8314222e.js"><link rel="prefetch" href="/assets/js/180.d67c14c9.js"><link rel="prefetch" href="/assets/js/181.c7bf4046.js"><link rel="prefetch" href="/assets/js/182.4a4705fd.js"><link rel="prefetch" href="/assets/js/183.9183a7da.js"><link rel="prefetch" href="/assets/js/184.290760c3.js"><link rel="prefetch" href="/assets/js/185.64cd4609.js"><link rel="prefetch" href="/assets/js/186.2940410e.js"><link rel="prefetch" href="/assets/js/187.12b14c61.js"><link rel="prefetch" href="/assets/js/188.1fea2b8b.js"><link rel="prefetch" href="/assets/js/189.04b7d343.js"><link rel="prefetch" href="/assets/js/19.ed77427b.js"><link rel="prefetch" href="/assets/js/190.a7d6ec94.js"><link rel="prefetch" href="/assets/js/191.8ad7d925.js"><link rel="prefetch" href="/assets/js/192.2fd0c8f8.js"><link rel="prefetch" href="/assets/js/193.4f8a87cd.js"><link rel="prefetch" href="/assets/js/194.9e2e73ca.js"><link rel="prefetch" href="/assets/js/195.c6292340.js"><link rel="prefetch" href="/assets/js/196.b7ff135e.js"><link rel="prefetch" href="/assets/js/197.83a7d260.js"><link rel="prefetch" href="/assets/js/198.530f7c9c.js"><link rel="prefetch" href="/assets/js/199.c5048869.js"><link rel="prefetch" href="/assets/js/20.09503993.js"><link rel="prefetch" href="/assets/js/200.3435c341.js"><link rel="prefetch" href="/assets/js/201.1e492eea.js"><link rel="prefetch" href="/assets/js/202.f7b55746.js"><link rel="prefetch" href="/assets/js/203.08e404b6.js"><link rel="prefetch" href="/assets/js/204.1bc4bdd8.js"><link rel="prefetch" href="/assets/js/21.38c15b75.js"><link rel="prefetch" href="/assets/js/22.ae59de53.js"><link rel="prefetch" href="/assets/js/23.1c6d3160.js"><link rel="prefetch" href="/assets/js/24.28c7c43e.js"><link rel="prefetch" href="/assets/js/25.e53d1234.js"><link rel="prefetch" href="/assets/js/26.6fe14a49.js"><link rel="prefetch" href="/assets/js/27.910bdd9c.js"><link rel="prefetch" href="/assets/js/28.9d9cd019.js"><link rel="prefetch" href="/assets/js/29.525906aa.js"><link rel="prefetch" href="/assets/js/30.8a1a47c0.js"><link rel="prefetch" href="/assets/js/31.750a297b.js"><link rel="prefetch" href="/assets/js/32.290c8619.js"><link rel="prefetch" href="/assets/js/33.885855c1.js"><link rel="prefetch" href="/assets/js/34.fb5b3f84.js"><link rel="prefetch" href="/assets/js/35.22021291.js"><link rel="prefetch" href="/assets/js/36.6736dcbf.js"><link rel="prefetch" href="/assets/js/37.50fc071e.js"><link rel="prefetch" href="/assets/js/38.a6f00886.js"><link rel="prefetch" href="/assets/js/39.e5f0c600.js"><link rel="prefetch" href="/assets/js/4.4c62e10b.js"><link rel="prefetch" href="/assets/js/40.7eaf6de1.js"><link rel="prefetch" href="/assets/js/41.c55fd828.js"><link rel="prefetch" href="/assets/js/42.2c5aaafc.js"><link rel="prefetch" href="/assets/js/43.6c939d74.js"><link rel="prefetch" href="/assets/js/44.22ccc866.js"><link rel="prefetch" href="/assets/js/45.56a056b8.js"><link rel="prefetch" href="/assets/js/46.6901927f.js"><link rel="prefetch" href="/assets/js/47.78460423.js"><link rel="prefetch" href="/assets/js/48.12fddaae.js"><link rel="prefetch" href="/assets/js/49.55f5515e.js"><link rel="prefetch" href="/assets/js/5.97a7c0dc.js"><link rel="prefetch" href="/assets/js/50.5c665644.js"><link rel="prefetch" href="/assets/js/51.9fbd3941.js"><link rel="prefetch" href="/assets/js/52.f3a93332.js"><link rel="prefetch" href="/assets/js/53.f7c91d71.js"><link rel="prefetch" href="/assets/js/54.035bd227.js"><link rel="prefetch" href="/assets/js/55.9d4300de.js"><link rel="prefetch" href="/assets/js/56.1fa21a7d.js"><link rel="prefetch" href="/assets/js/57.c6af5e20.js"><link rel="prefetch" href="/assets/js/58.8c0baaa7.js"><link rel="prefetch" href="/assets/js/59.63f1befc.js"><link rel="prefetch" href="/assets/js/6.8e992509.js"><link rel="prefetch" href="/assets/js/60.35539f20.js"><link rel="prefetch" href="/assets/js/61.0872b63b.js"><link rel="prefetch" href="/assets/js/62.6749d184.js"><link rel="prefetch" href="/assets/js/63.0a8a07d3.js"><link rel="prefetch" href="/assets/js/64.a2eeb6f7.js"><link rel="prefetch" href="/assets/js/65.d78ecb46.js"><link rel="prefetch" href="/assets/js/66.1e1a87a2.js"><link rel="prefetch" href="/assets/js/67.b550d647.js"><link rel="prefetch" href="/assets/js/68.68258f2e.js"><link rel="prefetch" href="/assets/js/69.9f502a69.js"><link rel="prefetch" href="/assets/js/7.159745e4.js"><link rel="prefetch" href="/assets/js/70.c9b2fe76.js"><link rel="prefetch" href="/assets/js/71.b7b04483.js"><link rel="prefetch" href="/assets/js/72.edb7dfe5.js"><link rel="prefetch" href="/assets/js/73.869de1e4.js"><link rel="prefetch" href="/assets/js/74.7816f275.js"><link rel="prefetch" href="/assets/js/75.0457b07c.js"><link rel="prefetch" href="/assets/js/76.79a2eaee.js"><link rel="prefetch" href="/assets/js/77.66cfa995.js"><link rel="prefetch" href="/assets/js/78.9dd75caf.js"><link rel="prefetch" href="/assets/js/79.f6111e69.js"><link rel="prefetch" href="/assets/js/8.b79c23ae.js"><link rel="prefetch" href="/assets/js/80.fff0a469.js"><link rel="prefetch" href="/assets/js/81.42c5ebec.js"><link rel="prefetch" href="/assets/js/82.ca2f7f18.js"><link rel="prefetch" href="/assets/js/83.ed547319.js"><link rel="prefetch" href="/assets/js/84.377155d9.js"><link rel="prefetch" href="/assets/js/85.e5aab871.js"><link rel="prefetch" href="/assets/js/86.14705636.js"><link rel="prefetch" href="/assets/js/87.502cb8e9.js"><link rel="prefetch" href="/assets/js/88.d8f271ec.js"><link rel="prefetch" href="/assets/js/89.3e9deca1.js"><link rel="prefetch" href="/assets/js/9.23c0899b.js"><link rel="prefetch" href="/assets/js/90.4de4929c.js"><link rel="prefetch" href="/assets/js/91.307ce9fd.js"><link rel="prefetch" href="/assets/js/92.47e69683.js"><link rel="prefetch" href="/assets/js/93.34abda4c.js"><link rel="prefetch" href="/assets/js/94.00078270.js"><link rel="prefetch" href="/assets/js/95.4c9ca2ce.js"><link rel="prefetch" href="/assets/js/96.9121392c.js"><link rel="prefetch" href="/assets/js/97.41f6bdb8.js"><link rel="prefetch" href="/assets/js/98.4524a102.js"><link rel="prefetch" href="/assets/js/99.7d313788.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4c1fe16c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Leibnize 个人学习笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Leibnize 个人学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Basics/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  基本
</a></div><div class="nav-item"><a href="/NetWork/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></div><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><!----> <h3 class="name" data-v-ca798c94>
    Leibnize 个人学习笔记
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/Basics/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  基本
</a></div><div class="nav-item"><a href="/NetWork/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></div><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/01-前端基础" class="sidebar-heading clickable"><span>01-前端基本</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/02-前端性能" class="sidebar-heading clickable"><span>02-前端性能</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/03-前端工程" class="sidebar-heading clickable"><span>03-前端工程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/04-前端异步" class="sidebar-heading clickable"><span>04-前端异步</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/05-前端设计" class="sidebar-heading clickable"><span>05-前端设计</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/06-前端数据" class="sidebar-heading clickable"><span>06-前端数据</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/07-前端安全" class="sidebar-heading clickable"><span>07-前端安全</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/08-前端概念" class="sidebar-heading clickable"><span>08-前端概念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/09-前端实现" class="sidebar-heading clickable"><span>09-前端实现</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/10-前端新标" class="sidebar-heading clickable"><span>10-前端新标</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/11-前端会话" class="sidebar-heading clickable"><span>11-前端会话</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/12-前端框架" class="sidebar-heading clickable"><span>12-前端框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/14-浏览器相关" class="sidebar-heading clickable open"><span>14-浏览器相关</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Basics/14-浏览器相关/浏览器基本.html" class="sidebar-link">一、浏览器基本</a></li><li><a href="/Basics/14-浏览器相关/浏览器缓存.html" class="sidebar-link">二、浏览器缓存</a></li><li><a href="/Basics/14-浏览器相关/浏览器存储.html" class="sidebar-link">三、浏览器存储</a></li><li><a href="/Basics/14-浏览器相关/浏览器跨域.html" class="sidebar-link">四、浏览器跨域</a></li><li><a href="/Basics/14-浏览器相关/浏览器应用.html" class="sidebar-link">五、浏览器应用</a></li><li><a href="/Basics/14-浏览器相关/输入URL展示.html" class="active sidebar-link">六、输入URL展示</a></li><li><a href="/Basics/14-浏览器相关/Summary.html" class="sidebar-link">七、Summary</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/15-前端核心" class="sidebar-heading clickable"><span>15-前端核心</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/16-前端Node" class="sidebar-heading clickable"><span>16-前端Node</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>六、输入URL到展示过程</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Leibnize 个人学习笔记</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="六、输入url到展示过程"><a href="#六、输入url到展示过程" class="header-anchor">#</a> 六、输入URL到展示过程</h1> <ul><li>DNS 解析：通过域名查询到具体的 IP
<ul><li>操作系统会在本地缓存中查询 IP；若无则去系统配置的 DNS 服务器中查询；若无则直接去 DNS <u>根服务器查询</u>，查询会找出负责 <code>com</code> 这个一级域名的服务器；然后去 <u>一级域名服务器</u> 查询 <code>google</code> 这个二级域名，直至找到最终匹配域名 IP；</li> <li>上述为 DNS 迭代查询，还有种递归查询，区别是前者是由客户端发起请求，后者是由系统配置的 DNS 服务器做请求，得到结果后将数据返回给客户端；</li></ul></li> <li>TCP 三次握手；
<ul><li>应用层会下发数据给传输层，TCP 协议会指明两端的端口号，然后下发给网络层；网络层中的 IP 协议会确定 IP 地址，并且指示数据传输中如何跳转路由器；然后包会再被封装到数据链路层的数据帧结构中，最后就是物理层面的传输；</li></ul></li> <li>TLS 握手；握手流程与加密方式发展；</li> <li>分析 URL，设置请求报文(头，主体)，发送请求；</li> <li>服务器响应；</li> <li>浏览器解析与渲染；
<ul><li>解析时，若是 gzip 格式的话则先解压，然后通过文件的编码格式知道该如何去解码文件；</li> <li>若遇到 script 标签，判断是否存在 async 或 defer ：
<ul><li>前者会并行进行下载和执行 JS，后者会先下载文件，后等待 HTML 解析完成后顺序执行；否则阻塞渲染；</li></ul></li> <li>HTML parser --&gt; DOM Tree
<ul><li>标记化算法，进行元素状态的标记；</li> <li>DOM 树构建；</li></ul></li> <li>CSS parser --&gt; Style Tree
<ul><li>解析 CSS 代码，生成样式树；</li></ul></li> <li>attachment --&gt; Render Tree
<ul><li>结合 DOM 树 与 style 树，生成渲染树；</li></ul></li> <li>Layout：布局</li> <li>GPU painting: 像素绘制页面</li></ul></li></ul> <h2 id="_6-1、网络相关"><a href="#_6-1、网络相关" class="header-anchor">#</a> 6-1、网络相关</h2> <h3 id="_6-1-1、网络请求"><a href="#_6-1-1、网络请求" class="header-anchor">#</a> 6-1-1、网络请求</h3> <ul><li><p>构建请求：浏览器会构建请求行 <code>GET / HTTP/1.1</code></p></li> <li><p>查找强缓存：检查强缓存，若命中直接使用，否则进入下一步；</p></li> <li><p>DNS 解析：域名与 IP 的转换系统，但浏览器提供 <u>DNS数据缓存功能</u>，若某域名已解析过，则会将结果缓存再利用；默认端口 80；</p></li> <li><p>建立 TCP 连接：Chrome 在同一域名下要求同时最多只能有 6 个 TCP 连接，超过则需等待；<u>详看 TCP 协议</u>；</p></li> <li><p>发送 HTTP 请求：请求体只在 POST 方式才会存在；<u>详看 HTTP 协议</u>；</p></li></ul> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Accept:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
<span class="token header-name keyword">Accept-Encoding:</span> gzip, deflate, br
<span class="token header-name keyword">Accept-Language:</span> zh-CN,zh;q=0.9
<span class="token header-name keyword">Cache-Control:</span> no-cache
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Cookie:</span> ......
<span class="token header-name keyword">Host:</span> www.google.com
<span class="token header-name keyword">Pragma:</span> no-cache
<span class="token header-name keyword">Upgrade-Insecure-Requests:</span> 1
<span class="token header-name keyword">User-Agent:</span> Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1
</code></pre></div><h3 id="_6-1-2、网络响应"><a href="#_6-1-2、网络响应" class="header-anchor">#</a> 6-1-2、网络响应</h3> <p>HTTP 请求到达服务器，服务器进行相关处理并响应；<u>详看 HTTP 协议</u>；</p> <p>响应头包含了服务器及其返回数据的一些信息、服务器生成数据的时间、返回的数据类型以及对即将写入的 Cookie 等信息；</p> <p>注意：若请求或响应头中包含 <strong>Connection: Keep-Alive</strong>，则表示建立 <u>持久连接</u>，随后请求统一站点的资源会复用此连接，否则断开连接, 流程结束；</p> <div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Cache-Control:</span> no-cache
<span class="token header-name keyword">Connection:</span> keep-alive
<span class="token header-name keyword">Content-Encoding:</span> gzip
<span class="token header-name keyword">Content-Type:</span> text/html;charset=utf-8
<span class="token header-name keyword">Date:</span> Wed, 04 Dec 2019 12:29:13 GMT
<span class="token header-name keyword">Server:</span> apache
<span class="token header-name keyword">Set-Cookie:</span> rsv_i=f9a0SIItKqzv7kqgAAgphbGyRts3RwTg%2FLyU3Y5Eh5LwyfOOrAsvdezbay0QqkDqFZ0DfQXby4wXKT8Au8O7ZT9UuMsBq2k; path=/; domain=.google.com
</code></pre></div><img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001820.png" style="zoom:50%;"> <h2 id="_6-x、浏览器解析渲染流程"><a href="#_6-x、浏览器解析渲染流程" class="header-anchor">#</a> 6-X、浏览器解析渲染流程</h2> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001821.png" style="zoom:50%;"> <ul><li>渲染进程将 HTML 内容转换为能够读懂的 <strong><u>DOM 树</u></strong>；</li> <li>渲染引擎将 CSS 样式表转化为浏览器可理解的 styleSheets，计算出 DOM 节点的样式；</li> <li>创建 <strong><u>布局树</u></strong>，并计算元素的布局信息；</li> <li>对布局树进行分层，并生成 <strong><u>分层树</u></strong>；</li> <li>为每个图层生成 <strong><u>绘制列表</u></strong>，并将其提交到 <strong><u>合成线程</u></strong>，合成线程将图层分图块，并栅格化将图块转换成位图；</li> <li>合成线程发送绘制图块命令给浏览器进程，浏览器进程根据指令生成页面，并显示到显示器上；</li></ul> <h2 id="_6-2、解析相关"><a href="#_6-2、解析相关" class="header-anchor">#</a> 6-2、解析相关</h2> <p>完成网络请求，若响应头中  <code>Content-Type</code> 值是 <code>text/html</code>，则**<u>进入浏览器解析与渲染工作</u>**，解析部分主要分为以下几个步骤:</p> <ul><li><strong><u>构建 DOM 树</u></strong></li> <li><strong><u>样式计算</u></strong></li> <li><u><strong>生成布局树(Layout Tree)</strong></u></li></ul> <p><strong><u>注意：下述内容极为简略，只作为回忆说明：</u></strong></p> <ul><li>DOM 树：字节数据—&gt;字符串—&gt;Token—&gt;Node—&gt;DOM
<ul><li>网络01 <u>字节数据</u>—&gt;</li> <li><u>HTML字符串</u>—&gt;</li> <li>通过词法分析转换为 <u>标记(标记化—tokenization)(标记还是字符串，是构成代码的最小单位)</u>—&gt;</li> <li>转换为 Node，并根据不同 Node 之前的联系构建为一颗 DOM 树；</li></ul></li> <li>CSSOM 树(同步进行)：字节数据—&gt;字符串—&gt;Token—&gt;Node—&gt;CSSOM
<ul><li>格式化、标准化、并根据继承与层叠规则计算节点具体样式；</li></ul></li> <li>生成渲染树(旧式)</li> <li>布局显示(旧式)</li></ul> <h3 id="_6-2-1、构建-dom-树"><a href="#_6-2-1、构建-dom-树" class="header-anchor">#</a> 6-2-1、构建 DOM 树</h3> <p>由于浏览器无法直接理解 <strong><u>HTML字符串</u></strong>，因此需要先将 HTML 的原始字节数据，转换为文件指定编码的字符，然后浏览器会根据 HTML 规范来将字符串转换成各种令牌标签，最终解析成一个树状的对象数据结构——<strong><u>DOM树</u></strong>；其本质上是一个以 <code>document</code> 为根节点的多叉树；</p> <h3 id="_6-2-1-1、html-文法本质"><a href="#_6-2-1-1、html-文法本质" class="header-anchor">#</a> 6-2-1-1、HTML 文法本质</h3> <p>注意：此处的 HTML 的文法并非指 <strong><u>上下文无关文法</u></strong>；在计算机科学 <u>编译原理</u> 学科中，有非常明确的定义:</p> <blockquote><p>若一个形式文法G = (N, Σ, P, S) 的产生式规则都取如下的形式：V-&gt;w，则叫上下文无关语法。其中 V∈N ，w∈(N∪Σ)* 。</p></blockquote> <p>其中把 G = (N, Σ, P, S) 中各个参量的意义解释一下:</p> <ol><li>N 是<u><strong>非终结符</strong></u>(即最后的符号不是它，下同)集合；</li> <li>Σ 是<u><strong>终结符</strong></u>集合；</li> <li>P 是**<u>开始符</u>**，它必须属于 N ，也即非终结符；</li> <li>S 就是不同的产生式的集合；比如 S -&gt; aSb 等等；</li></ol> <p>用人话讲，<strong><u>上下文无关的文法，就是这个文法中所有产生式的左边都是一个非终结符</u></strong> ，比如：</p> <div class="language- extra-class"><pre class="language-text"><code>// 下面文法中，每个产生式左边都会有一个非终结符，这就是: 上下文无关的文法; 此时，`xBy`一定是可以规约出`xAy`的；
A -&gt; B
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// 反例:
// 下面就是: 非上下文无关的文法; 当遇到 B 时，无法判断是否可以规约出 A，因为取决于左边或右边是否有 a 存在, 故下面是和上下文有关的
aA -&gt; B
Aa -&gt; B
</code></pre></div><p>注意：<strong><u>规范的 HTML 语法</u></strong>，<strong><u>是符合上下文无关文法的</u></strong>，能够体现它 <strong><u>非上下文无关文法的</u></strong> 在它的 <strong>不标准的语法</strong>，比如反例证明如下：</p> <p>因为：解析器扫描到 <code>form</code> 标签时，<strong><u>上下文无关文法</u></strong> 的处理方式是直接创建对应 form 的 DOM 对象，而真实 HTML5 场景中却不是这样，解析器会查看 <code>form</code> 上下文，若此 <code>form</code> 标签的父标签也是 <code>form</code>，则 <strong>直接跳过</strong> 当前 <code>form</code> 标签，否则才创建 DOM 对象；</p> <p>所以：在不标准的语法时，是非上下文无关文法，则标准语法中，就是上下文无关文法(注意多重否定表肯定)；</p> <p><strong><u>注意：上面的叙述想表达的是规范的 HTML 语法是符合上下文无关文法的，但真实场景和实际解析中，考虑到不标准语法的行为，所以是非上下文无关文法；</u></strong></p> <p><strong><u>注意：即理论与实际不符，表示 HTML 不能使用常规语言解析器(常规编程语言一般为上下文无关)完成 HTML Parse；</u></strong></p> <h3 id="_6-2-1-2、解析算法"><a href="#_6-2-1-2、解析算法" class="header-anchor">#</a> 6-2-1-2、解析算法</h3> <p>HTML5 <a href="https://html.spec.whatwg.org/multipage/parsing.html" target="_blank" rel="noopener noreferrer">规范<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 详细地介绍解析算法，算法分为两个阶段:</p> <ul><li><strong>标记化算法</strong>；对应过程为 <strong>词法分析</strong>；</li> <li><strong>建树算法</strong>；对应过程为 <strong>语法分析</strong>；</li></ul> <h3 id="_6-2-1-2-1、标记化算法"><a href="#_6-2-1-2-1、标记化算法" class="header-anchor">#</a> 6-2-1-2-1、标记化算法</h3> <p>算法输入为 <u>HTML文本</u>，输出为 <u>HTML标记</u>，故亦称 <u><strong>标记生成器</strong></u>；</p> <p>算法运用 <strong><u>有限自动状态机</u></strong> 来完成：即在当前状态下，接收一或多个字符，就会更新到下一状态；比如：</p> <div class="language-html extra-class"><pre class="language-html"><code>// 标记化过程展示示例
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    Hello Beijing
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>首先，遇到 <code>&lt;</code>, 状态为 <strong>标记打开</strong>；</li> <li>然后，接收 <code>[a-z]</code> 字符，并进入 <strong>标记名称状态</strong>；</li> <li>然后，上述状态一直保持，直到遇到 <code>&gt;</code>，表示标记名称记录完成，此时进入 <strong>数据状态</strong>；</li> <li>然后，后续的 <code>body</code>  标签做同样处理；</li> <li>然后，当来到 <code>&lt;body&gt;</code> 中的 <code>&gt;</code>，进入<strong>数据状态</strong>，之后保持此状态接收后面字符 <strong>hello TLP</strong>；</li> <li>接着，接收 <code>&lt;/body&gt;</code>  中的 <code>&lt;</code>，回到 <strong>标记打开</strong>，在接收下一个字符 <code>/</code>  时，此时会创建一个 <code>end tag</code> 的 token；</li> <li>随后，进入 <strong>标记名称状态</strong>，遇到 <code>&gt;</code> 则回到<strong>数据状态</strong>；</li> <li>最后，以同样的样式处理 <code>&lt;/html&gt;</code>；</li></ul> <h3 id="_6-2-1-2-2、建树算法"><a href="#_6-2-1-2-2、建树算法" class="header-anchor">#</a> 6-2-1-2-2、建树算法</h3> <p>​	回顾一下，解析第一步是构建 <strong><u>DOM 树</u></strong>，是因为浏览器无法直接理解 <strong><u>HTML字符串</u></strong>，因此需要先将这系列的字节流，转换为一种有意义的、且方便操作的数据结构——<strong><u>DOM 树</u></strong>；而 **<u>DOM 树</u>**是一个以 <code>document</code> 为根节点的多叉树；所以，<u><strong>解析器</strong></u>  首先会创建一个 <code>document</code> 对象 (作为 <strong><u>DOM 树</u></strong> 的根节点)；</p> <p>​	随后，<u><strong>标记生成器</strong></u> 会将每个标记的信息发送给 <strong><u>建树器</u></strong>，<strong><u>建树器</u></strong>  接收到相应的标记时，会 <strong>创建对应的 DOM 对象</strong>，在创建这个 <code>DOM对象</code> 后会做两件事：</p> <ul><li>将 <code>DOM对象</code> 加入 <strong><u>DOM 树</u></strong> 中；</li> <li>将对应标记，压入存放 <strong>开放(与<u>闭合标签</u>意思对应)元素</strong> 的栈中；</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;
  &lt;body&gt;
    Hello Beijing
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div><ul><li>首先，状态为  <strong>初始化状态</strong>；</li> <li>然后，(<strong><u>建树器</u></strong>)接收到 <strong><u>标记生成器</u></strong> 传来的 <code>html</code> 标记，此时状态变为 <strong>before html状态</strong>，同时创建一个 <code>HTMLHtmlElement</code> DOM 元素，并将其添加到 <code>document</code> 根对象上，并进行压栈操作；</li> <li>随后，状态自动变为 <strong>before head</strong>，此时从标记生成器那边传来 <code>body</code> 标记，表示并没有 <code>head</code> 标签， 此时 <strong><u>建树器</u></strong> 会自动创建一个 <code>HTMLHeadElement</code>  (DOM 元素)，并将其添加入到 <strong><u>DOM 树</u></strong> 中；</li> <li>然后，进入到 <strong>in head</strong> 状态，随机直接跳到  <strong>after head</strong>；</li> <li>然后，现在 <strong><u>标记生成器</u></strong> 传来了 <code>body</code> 标记，创建 <code>HTMLBodyElement</code>(DOM 元素)，插入到 <strong><u>DOM 树</u></strong> 中，同时压入开放标记栈；</li> <li>随后，状态变为 <strong>in body</strong>，然后接收后面系列字符：<strong>Hello Beijing</strong>，接收到第一个字符时，会创建 <strong>Text</strong> 节点并将字符插入其中，然后把 <strong>Text</strong> 节点插入到 <strong><u>DOM 树</u></strong> 中的 <code>body元素</code>的下面；后续不断接收后面字符，字符会附在 <strong>Text</strong> 节点上；</li> <li>然后，<strong>标记生成器</strong> 传过来一个 <code>body</code> 的结束标记，进入 <strong>after body</strong> 状态；</li> <li>最后，**标记生成器 **传过来一个 <code>html</code> 的结束标记，进入 <strong>after after body</strong> 状态，表示解析过程到此结束；</li></ul> <h3 id="_6-2-1-2-3、容错机制"><a href="#_6-2-1-2-3、容错机制" class="header-anchor">#</a> 6-2-1-2-3、容错机制</h3> <p>HTML5规范宽容策略十分强悍，接下来是 WebKit 中一些经典的容错示例：</p> <ul><li><p>表单元素嵌套：直接忽略里面的 <code>form</code>；</p></li> <li><p>使用 <code>&lt;/br&gt;</code>  而不是 <code>&lt;br&gt;</code></p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>if (t-&gt;isCloseTag(brTag) &amp;&amp; m_document-&gt;inCompatMode()) {
  reportError(MalformedBRError);
  t-&gt;beginTag = true;
}
// 全部换为 &lt;br&gt; 形式
</code></pre></div><ul><li>表格离散</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&lt;table&gt;
  &lt;table&gt;
    &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt;
  &lt;/table&gt;
  &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// WebKit 会自动转换为:
&lt;table&gt;
    &lt;tr&gt;&lt;td&gt;outer table&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;table&gt;
    &lt;tr&gt;&lt;td&gt;inner table&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</code></pre></div><h3 id="_6-2-1-2-4、流程总结"><a href="#_6-2-1-2-4、流程总结" class="header-anchor">#</a> 6-2-1-2-4、流程总结</h3> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001822.png" align="" style="zoom:50%;"> <ul><li><strong>转码(Bytes -&gt; Characters)</strong> <ul><li>读取接收到的 HTML 二进制数据，按指定编码格式将字节转换为 HTML 字符串；</li></ul></li> <li><strong>Tokens 化(Characters -&gt; Tokens)</strong> <ul><li>解析 HTML，将 HTML 字符串转换为结构清晰的 Tokens，每个 Token 都有特殊的含义同时有自己的一套规则；</li></ul></li> <li><strong>构建 Nodes(Tokens -&gt; Nodes)</strong> <ul><li>每个 Node 都添加特定的属性(或属性访问器)，通过指针能够确定 Node 的父、子、兄弟关系和所属 treeScope</li> <li>比如：iframe 的 treeScope 与外层页面的 treeScope 不同；</li></ul></li> <li><strong>构建 DOM 树(Nodes -&gt; DOM Tree)</strong> <ul><li>最重要的工作是建立起每个结点的父子兄弟关系；</li></ul></li></ul> <h3 id="_6-2-2、样式计算"><a href="#_6-2-2、样式计算" class="header-anchor">#</a> 6-2-2、样式计算</h3> <p>即渲染引擎将 CSS 样式表转化为浏览器可以理解的 styleSheets，计算出 DOM 节点的样式；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001823.png" align="" style="zoom:50%;"> <p>上图即将所有值转换为渲染引擎容易理解、标准化的计算值，此过程为 <strong><u>属性值标准化</u></strong>，处理完成后再处理样式的 <strong><u>继承和层叠</u></strong>，整一过程亦称 CSSOM 构建过程；</p> <h3 id="_6-2-2-1、格式化样式表"><a href="#_6-2-2-1、格式化样式表" class="header-anchor">#</a> 6-2-2-1、格式化样式表</h3> <p>CSS 样式来源有三种：link 标签引用、style 标签样式、元素的内嵌 style 属性；</p> <p>浏览器是无法直接识别 CSS 样式文本，因此渲染引擎收到 CSS 文本后第一件事情就是将其转化为一个结构化的对象 <strong><u>styleSheets</u></strong>；在浏览器控制台能够通过<code>document.styleSheets</code>来查看这个最终结构，结构包含了以上 3 种 CSS来源，为后面的样式操作提供基础；</p> <p>补充：格式化的过程过于复杂，而且对于不同的浏览器会有不同的优化策略，这里就不展开了；</p> <h3 id="_6-2-2-2、标准化样式属性"><a href="#_6-2-2-2、标准化样式属性" class="header-anchor">#</a> 6-2-2-2、标准化样式属性</h3> <p>有些 CSS 样式的数值并不容易被渲染引擎所理解，因此在计算样式前需要将它们标准化；比如 <code>em-&gt;px、red-&gt;#ff0000、bold-&gt;700</code> 等；</p> <h3 id="_6-2-2-3、计算每个节点的具体样式"><a href="#_6-2-2-3、计算每个节点的具体样式" class="header-anchor">#</a> 6-2-2-3、计算每个节点的具体样式</h3> <p>CSS 样式被 <u>格式化</u> 和 <u>标准化</u> 后，便可计算每个节点的具体样式信息；计算遵从两个规则：<strong>继承</strong>、<strong>层叠</strong>；</p> <ul><li>继承规则：每个子节点均默认继承父节点样式属性，若父节点中没有找到，则采用浏览器默认样式 <code>UserAgent样式</code>；</li> <li>层叠规则：<u>CSS 最大特点在于它的层叠性，也即最终样式取决于各个属性共同作用的效果</u>；</li> <li>注意：在计算完样式之后，所有样式值会被挂在到 <code>window.getComputedStyle</code> 当中，故可通过 JS 来获取计算后的样式；</li></ul> <h3 id="_6-2-3、生成布局树"><a href="#_6-2-3、生成布局树" class="header-anchor">#</a> 6-2-3、生成布局树</h3> <p>布局过程即：利用前面的 <strong><u>DOM 树</u></strong> 和 <strong><u>DOM 样式</u></strong> ，排除 <code>script、meta</code> 等功能化、非视觉节点，排除 <code>display: none</code> 的节点，并通过浏览器的布局系统 <u>计算元素位置信息</u>、<u>确定元素位置</u>，构建一棵只包含可见元素的 <strong><u>布局树(Layout Tree)</u></strong>；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001824.png" align="" style="zoom:50%;"> <ul><li>遍历生成的 <strong><u>DOM 树</u></strong> 节点，并将它们添加到 <strong><u>布局树</u></strong> 中；</li> <li>计算 <strong><u>布局树</u></strong> 节点的坐标位置；</li> <li>注意：<strong><u>布局树</u></strong>  包含可见元素，设置<code>display: none</code>的元素和 <code>head</code> 等功能标签，将不会被放入其中；</li> <li>注意：现在 Chrome 团队已经做了大量重构，已经没有生成 <strong><u>渲染树(Render Tree)</u></strong> 的过程(布局树的信息已非常完善，完全拥有 Render Tree 的功能)；</li> <li>补充：<a href="https://www.rrfed.com/2017/02/26/chrome-layout/" target="_blank" rel="noopener noreferrer">从Chrome源码看浏览器如何layout布局<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001825.png" align="" style="zoom:50%;"> <h2 id="_6-3、渲染相关"><a href="#_6-3、渲染相关" class="header-anchor">#</a> 6-3、渲染相关</h2> <p>渲染分为几个步骤：</p> <ul><li><strong><u>建立 图层树(Layer Tree)</u></strong></li> <li><strong><u>生成 绘制列表</u></strong></li> <li><strong><u>生成 图块 并 栅格化(生成位图)</u></strong></li> <li><strong><u>显示器显示内容</u></strong></li></ul> <h3 id="_6-3-1、建图层树-分层树-layer-tree"><a href="#_6-3-1、建图层树-分层树-layer-tree" class="header-anchor">#</a> 6-3-1、建图层树/分层树(Layer Tree)</h3> <p>​	解析阶段得到 DOM节点、样式、位置信息，但还不足以开始绘制页面，因还需考虑页面中的复杂效果与场景，比如复杂 3D 动画变换效果、页面滚动、元素含层叠上下文时的显示与隐藏、使用 z-indexing 做 z 轴排序等；而为更加方便地实现这些效果，在浏览器在构建完 <strong><u>布局树</u></strong> 后(解析阶段最后一步)，渲染引擎还需为特定的节点生成专用图层，构建一棵 <strong><u>图层树(Layer Tree)</u></strong>；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001826.png" style="zoom:50%;"> <p>​	图层树通过显示隐式合成构建，一般情况下，节点的图层会默认属于父节点的图层(<strong>亦称合成层</strong>)，某些条件会触发将 <strong><u>多个合成层</u></strong> 提升为 <strong><u>单独合成层</u></strong>，可分两种情况讨论：<strong>显式合成</strong>、<strong>隐式合成</strong></p> <h3 id="_6-3-1-1、显式合成"><a href="#_6-3-1-1、显式合成" class="header-anchor">#</a> 6-3-1-1、显式合成</h3> <ul><li><p>拥有 <u>层叠上下文</u> 属性的元素会单独提升为单独一层：层叠上下文是 HTML 元素的三维概念，这些 HTML 元素在一条假想的、相对于面向视窗或用户的 z 轴上延伸，HTML 元素依据其自身属性，按照优先级顺序占用层叠上下文空间；</p> <ul><li><strong>根元素(HTML)</strong> 本身就具有层叠上下文；</li> <li>元素的 <strong>filter</strong> 值不为 none；</li> <li>元素的 <strong>clip-path</strong> 值不为 none；</li> <li>元素的 <strong>transform</strong> 值不为 none；</li> <li>元素的 <strong>perspective</strong> 值不为 none；</li> <li>元素的 <strong>mix-blend-mode</strong> 值不为 normal；</li> <li>元素的 <strong>z-index</strong> 值不为 auto，且为 flex 子项；</li> <li>元素的 <strong>z-index</strong> 值不为 auto，且为 grid 子项；</li> <li>元素的 <strong>z-index</strong> 值不为 auto，且为绝对/相对定位元素；</li> <li>元素的 <strong>mask</strong>、<strong>mask-image</strong>、<strong>mask-border</strong> 不为 none；</li> <li>元素的 <strong>isolation</strong> 值是 isolate；</li> <li>元素的 <strong>-webkit-overflow-scrolling</strong> 值是 touch；</li> <li>元素的 <strong>contain</strong> 值是 layout、paint、strict、content；</li> <li>元素的 <strong>opacity</strong> 值是小于 1；(the specification for opacity)</li> <li>元素的 **will-change ** 值是指定的任意属性；(<a href="https://dev.opera.com/articles/css-will-change-property/" target="_blank" rel="noopener noreferrer">详看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> )</li></ul></li> <li><p>需要 <u>剪裁</u> 的地方也会被创建为图层：</p> <ul><li>比如某个存放巨量文字的 100 * 100 像素大小的 DIV，超出的文字部分就需要被剪裁；若出现滚动条，则滚动条会被单独提升为一个图层；</li></ul></li></ul> <h3 id="_6-3-1-2、隐式合成"><a href="#_6-3-1-2、隐式合成" class="header-anchor">#</a> 6-3-1-2、隐式合成</h3> <p><u>层叠等级低</u> 的节点被提升为单独图层后，则 <u>所有层叠等级比它高</u> 的节点 **都会 **成为一个单独的图层；</p> <ul><li>注意：隐式合成隐藏巨大风险：若在一个大型应用中，当某个<code>z-index</code> 比较低的元素，被提升为单独图层后，层叠在它上面的元素统统都会被提升为单独的图层，此时瞬间可能会增加上千个图层，大大增加内存压力，甚至直接让页面崩溃；此乃 <strong><u>层爆炸</u></strong> 原理，<a href="https://segmentfault.com/a/1190000014520786" target="_blank" rel="noopener noreferrer">例子在此<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；</li> <li>注意：但当需要 <code>repaint</code> 时，只需 <code>repaint</code> 本身，而不会影响到其他的层；</li></ul> <h3 id="_6-3-2、生成绘制列表"><a href="#_6-3-2、生成绘制列表" class="header-anchor">#</a> 6-3-2、生成绘制列表</h3> <p>然后渲染引擎会将图层的绘制拆分成一个个绘制指令；比如先画背景、再描绘边框等，然后将这些指令按顺序组合成一个 <strong><u>待绘制列表</u></strong>，相当于制作一份绘制操作任务清单，可在 Chrome 开发者工具中的<code>Layers</code>面板观察绘制列表:</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001827.png" style="zoom:50%;"> <h3 id="_6-3-3、生成图块并栅格化-生成位图"><a href="#_6-3-3、生成图块并栅格化-生成位图" class="header-anchor">#</a> 6-3-3、生成图块并栅格化(生成位图)</h3> <p>实际上在渲染进程中，绘制操作由专门的线程—<strong><u>合成线程</u></strong> 来完成：</p> <ul><li>首先，当绘制列表准备好后，<strong><u>渲染进程的主线程</u></strong> 会给 <strong><u>合成线程</u></strong> 发送 <code>commit</code> 消息，将 <strong><u>绘制列表</u></strong> 提交给 <strong><u>合成线程</u></strong>；</li> <li>然后，为避免：<u>在有限视口内一次性绘制所有页面</u> 而造成的性能浪费，<strong><u>合成线程</u></strong> 需要先将图层 <strong>分块</strong>；
<ul><li>注意：分块大小规格一般为 256 * 256 或 512 * 512 ，以加速页面首屏展示；</li> <li>注意：图块数据要进入 GPU 内存，而将数据从浏览器内存上传到 GPU 内存的操作较慢(即使绘制一部分图块也可能会耗费大量时间)，为解决此问题，Chrome 采用如下策略：首次合成图块时只采用一个 <u>低分辨率的图片</u> ，故首屏展示时只是展示此图片，继续进行合成操作，当正常图块内容绘制完毕后，才将当前低分辨率的图块内容替换；此亦 Chrome 底层优化首屏加载速度的一个手段；</li></ul></li> <li>然后，<strong><u>合成线程</u></strong> 会选择视口附近的 <strong>图块</strong>，优先将其交给 <strong><u>栅格化线程池</u></strong> 来生成位图；
<ul><li>注意：渲染进程中专门维护一个 <strong><u>栅格化线程池</u></strong>，负责将 <strong>图块</strong> 转换为 <strong>位图数据</strong>；</li> <li>注意：生成位图的过程实际上都会使用 GPU 进行加速，生成的位图最后发送给 <strong><u>合成线程</u></strong>；</li></ul></li></ul> <h3 id="_6-3-4、显示器显示内容"><a href="#_6-3-4、显示器显示内容" class="header-anchor">#</a> 6-3-4、显示器显示内容</h3> <p>生成图块并栅格化操作完成后，<strong><u>合成线程</u></strong> 会生成一个绘制命令—<code>DrawQuad</code>，并发送给浏览器进程的 <strong><u>viz组件</u></strong>，组件根据这个命令，将页面内容绘制到内存(缓冲)，然后把这部分内存数据发送给显卡；所以，当某个动画大量占用内存时，浏览器生成图像的速度变慢，图像传送显卡数据不及时，而显示器还是以不变频率刷新，因此会出现卡顿，出现明显的掉帧现象；</p> <ul><li>注意：无论是 PC 显示器还是手机屏幕，都有一个固定的刷新频率，一般是 60 HZ(60 帧、每秒更新60张图，停留 16.7 ms/图)，而每次更新的图片均来自于显卡的 <strong><u>前缓冲区</u></strong>；当显卡接收到浏览器进程传来的新的页面后，会合成相应的新图像，并将新图像保存到  <u><strong>后缓冲区</strong></u>；然后系统自动将 <strong><u>前缓冲区</u></strong> 和  <strong><u>后缓冲区</u></strong> 对换位置，如此循环更新；</li></ul> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001828.png" style="zoom:50%;"> <h2 id="_6-4、重排、重绘、合成"><a href="#_6-4、重排、重绘、合成" class="header-anchor">#</a> 6-4、重排、重绘、合成</h2> <p>回顾渲染流水线：</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001829.png" align="" style="zoom:50%;"> <ul><li>重绘是：当节点需要更改外观而不会影响布局的，比如改变 <code>color</code> 就叫称为重绘；</li> <li>回流是：布局或几何属性需要改变就称为回流；</li></ul> <h3 id="_6-4-1、重排-回流"><a href="#_6-4-1、重排-回流" class="header-anchor">#</a> 6-4-1、重排/回流</h3> <p>对 DOM 修改导致元素的尺寸或位置发生变化时，浏览器需要重新计算渲染树，触发重排/回流；</p> <ul><li>触发条件：对 DOM 结构的修改引发 DOM 几何尺寸变化时，会导致 <strong><u>重排(reflow)</u></strong>；
<ul><li>页面初次渲染；</li> <li>元素字体大小变化；</li> <li>浏览器窗口大小改变；</li> <li>激活 CSS 伪类；比如 :hover；</li> <li>DOM 元素的几何属性变化，常见的比如：<code>width</code>、<code>height</code>、<code>padding</code>、<code>margin</code>、<code>left</code>、<code>top</code>、<code>border</code> 等；</li> <li>元素尺寸、位置、内容发生改变；</li> <li>使 DOM 节点发生 <code>增减</code> 或 <code>移动</code>；</li> <li>读写 <code>offset</code> 族、<code>scroll</code>族、<code>client</code> 族属性时，浏览器为获取这些值，需要进行回流操作；</li> <li>查询某些属性或调用某些方法
<ul><li>clientWidth、clientHeight、clientTop、clientLeft</li> <li>offsetWidth、offsetHeight、offsetTop、offsetLeft</li> <li>scrollWidth、scrollHeight、scrollTop、scrollLeft</li> <li>getComputedStyle()</li> <li>getBoundingClientRect()</li> <li>scrollTo()</li></ul></li></ul></li> <li>回流过程：依照下面的渲染流水线，触发重排/回流时，若 DOM 结构发生改变，则重新渲染 DOM 树，然后将后续流程(含主线程外的任务)全部走一遍；相当于将解析和合成的过程重新又走了一篇，开销巨大；</li></ul> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001830.png" align="" style="zoom:50%;"> <h3 id="_6-4-2、重绘"><a href="#_6-4-2、重绘" class="header-anchor">#</a> 6-4-2、重绘</h3> <p>DOM 修改导致样式发生变化，但无影响其几何属性，触发重绘，而不触发回流；而由于 DOM 位置信息无需更新，省去布局过程，性能上优于回流；</p> <ul><li><p>触发条件：当 DOM 的修改导致样式变化，且没有影响几何属性时，会导致 <strong><u>重绘(repaint)</u></strong>；</p></li> <li><p>重绘过程：由于没有导致 DOM 几何属性变化，故元素的位置信息无需更新，从而省去布局与建图层树过程，然后继续进行分块、生成位图等后面系列操作；</p></li></ul> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001831.png" align="" style="zoom:50%;"> <ul><li>注意：重绘跳过了 <u>生成布局树</u> 和 <u>建图层树</u> 阶段，直接生成绘制列表，然后继续进行分块、生成位图等后面一系列操作；</li> <li>注意：重绘不一定导致重排，但重排一定发生了重绘；</li> <li>注意：<strong><u><em>重排比重绘的代价要更高</em></u></strong>；有时即使仅仅重排一个单一的元素，其父元素及任何跟随它的元素也会产生重排；为避免频繁重排导致的性能问题，现代浏览器会对频繁的重排或重绘操作进行**<u><em>优化</em></u><strong>：浏览器会维护一个 flush 队列，以存放触发重排与重绘的任务，若队列中任务数量或时间间隔达到一个阈值时，浏览器就会将此队列任务一次性出队清空，进行一次批处理，如此可将多次重排和重绘变成一次；</strong><u><em>但当</em></u>**访问一些即使属性时，为获得此时此刻的、最准确的属性值，浏览器会提前将 flush 队列的任务出队：clientwidth、clientHeight、clientTop、clientLeftoffsetwidth、offsetHeight、offsetTop、offsetLeftscrollwidth、scrollHeight、scrollTop、scrollLeftwidth、heightgetComputedStyle()、getBoundingClientRect()</li></ul> <h3 id="_6-4-3、合成"><a href="#_6-4-3、合成" class="header-anchor">#</a> 6-4-3、合成</h3> <p>直接合成，比如利用 CSS3 的 <code>transform</code>、<code>opacity</code>、<code>filter</code> 等属性可实现合成效果，即  <strong><u>GPU加速</u></strong>；</p> <p>补充：GPU加速即：在使用<code>CSS3</code>中的<code>transform</code>、<code>opacity</code>、<code>filter</code>属性时，跳过布局和绘制流程，直接进入非主线处理的部分，即交给合成线程；</p> <ul><li>GPU 加速原因：在合成的情况下，会直接跳过布局和绘制流程，直接进入<code>非主线程</code>处理的部分，即直接交给 <strong><u>合成线程</u></strong> 处理：
<ul><li>充分发挥 GPU 优势：<strong><u>合成线程</u></strong> 生成位图的过程中：会调用线程池，并在其中使用 GPU 进行加速生成，而 GPU 是擅长处理位图数据；</li> <li><strong><u><em>无占用主线程资源</em></u></strong>：即使主线程卡住，但效果依然能够流畅地展示；</li></ul></li> <li>GPU 使用注意：GPU 渲染字体会导致字体模糊，过多 GPU 处理会导致内存问题；</li></ul> <h3 id="_6-4-4、注意事项"><a href="#_6-4-4、注意事项" class="header-anchor">#</a> 6-4-4、注意事项</h3> <p><strong>回流必定触发重绘，重绘不一定触发回流；重绘的开销较小，回流的代价较高</strong>；改变父节点里的子节点很可能会导致父节点的一系列回流；</p> <h3 id="_6-4-4-1、最佳实践"><a href="#_6-4-4-1、最佳实践" class="header-anchor">#</a> 6-4-4-1、最佳实践</h3> <p>CSS：</p> <ul><li>避免使用多层内联样式；</li> <li>避免使用 CSS 表达式，比如 <code>clac()</code>；</li> <li>CSS 选择符 <u>从右往左</u> 匹配查找，避免节点层级过多；</li> <li>使用 <code>visibility</code> 替换 <code>display: none</code>，前者只引起重绘，后者则触发回流；</li> <li>避免使用 <code>table</code> 布局，可能很小的一个小改动会造成整个 <code>table</code> 的重新布局；</li> <li>使用 <code>transform</code> 替代 <code>top</code>，<code>transform</code> 和 <code>opacity</code> 效果，不会触发 <code>layout</code> 和 <code>repaint;</code></li> <li>动画效果/动画元素，可使用绝对定位使其脱离文档流；减少频繁地触发回流重绘；
<ul><li>比如：将动画效果应用到 <code>position</code>  属性为 <code>absolute</code> 或 <code>fixed</code> 元素上；</li></ul></li></ul> <p>JavaScript：</p> <ul><li><p>避免频繁操作样式，可汇总后统一 <u>一次修改</u>；</p></li> <li><p>避免频繁使用 <code>style</code>，而采用修改 <code>class</code> 方式；</p></li> <li><p>极限优化时，修改样式可将其 <code>display: none</code> 后修改；</p></li> <li><p>使用 <code>resize</code>、<code>scroll</code>  时进行防抖和节流处理，减少回流次数；</p></li> <li><p>避免频繁读取会引发回流重绘的属性，若需多次使用则可考虑缓存；</p></li> <li><p>避免频繁操作 DOM，减少 <code>dom</code>的增删次数，可使用 <u>字符串</u> 或 <code>documentFragment</code> 一次性插入；</p> <ul><li>比如：使用 <code>createDocumentFragment</code> 进行批量 DOM 操作，修改完毕后，再放入文档流；</li> <li>比如：先使用 <code>display:none</code> 避开回流重绘，操作结束后再显示；</li></ul></li> <li><p>避免多次触发上面提到的那些会触发回流的方法，可使用变量将查询结果缓存，避免多次查询；</p></li> <li><p>动画实现的速度的选择，动画速度越快，回流次数越多，也可选择使用 <code>requestAnimationFrame;</code></p></li> <li><p>将频繁重绘或者回流的节点提升为合成层，图层能够阻止该节点的渲染行为影响别的节点；比如对于 <code>video</code> 标签来说，浏览器会自动将该节点变为图层；</p> <ul><li>设置节点为图层的方式有很多，我们可以通过以下几个常用属性可以生成新图层：</li> <li><code>will-change</code></li> <li><code>video</code>、<code>iframe</code> 标签</li></ul></li> <li><p>添加 <code>will-change: tranform</code>：让渲染引擎为节点单独实现一图层；在变换发生时，仅利用 <strong><u>合成线程</u></strong> 去处理这些变换而不牵扯主线程，提高渲染效率；</p> <ul><li><p>注意：值并非限制 tranform，任何可实现合成效果的 CSS 属性均可使用 <code>will-change</code> 来声明；<a href="https://juejin.im/post/5da52531518825094e373372" target="_blank" rel="noopener noreferrer">使用例子<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；</p></li> <li><p>注意：通俗说即利用 CSS3 的<code>transform</code>、<code>opacity</code>、<code>filter</code> 这些属性，以实现合成的效果，即<code>GPU</code>加速；</p></li> <li><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">#divId</span> <span class="token punctuation">{</span>
  <span class="token property">will-change</span><span class="token punctuation">:</span> transform<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h3 id="_6-4-4-2、优化检测"><a href="#_6-4-4-2、优化检测" class="header-anchor">#</a> 6-4-4-2、优化检测</h3> <p>当发生 <code>DOMContentLoaded</code> 事件后，就会生成渲染树，生成渲染树就可以进行渲染了，这一过程更大程度上和硬件有关系：</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200908001832.png" style="zoom:50%;"> <h3 id="_6-4-5、与eventloop关系"><a href="#_6-4-5、与eventloop关系" class="header-anchor">#</a> 6-4-5、与EventLoop关系</h3> <ul><li>首先，当 Eventloop 执行完 Microtasks 后，会判断 <code>document</code> 是否需要更新，因为浏览器是 60Hz 的刷新率，每 16.6ms 才会更新一次；</li> <li>然后，判断是否有 <code>resize</code> 或者 <code>scroll</code> 事件，有则触发，所以 <code>resize</code> 和 <code>scroll</code> 事件也是至少 16ms 才会触发一次，并且自带节流功能；</li> <li>然后，判断是否触发了 media query；</li> <li>然后，更新动画并且发送事件；</li> <li>然后，判断是否有全屏操作事件；</li> <li>然后，执行 <code>requestAnimationFrame</code> 回调；</li> <li>然后，执行 <code>IntersectionObserver</code> 回调，该方法用于判断元素是否可见，可用于懒加载，但兼容性不好；</li> <li>最后，更新界面；</li> <li>注意：以上是一帧中可能会做的事情；若在一帧中有空闲时间，就会去执行 <code>requestIdleCallback</code> 回调；<a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop-processing-model" target="_blank" rel="noopener noreferrer">详看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_6-x、实际问题"><a href="#_6-x、实际问题" class="header-anchor">#</a> 6-X、实际问题</h2> <h3 id="_6-x-1、dom-操作性能问题"><a href="#_6-x-1、dom-操作性能问题" class="header-anchor">#</a> 6-X-1、DOM 操作性能问题</h3> <p>原因：因为 DOM 是属于渲染引擎中的东西，而 JS 又是 JS 引擎中的东西；通过 JS 操作 DOM 时，涉及到两个线程间的通信，势必会带来一些性能上的损耗。操作 DOM 次数一多，也就等同于一直在进行线程间的通信，且操作 DOM 可能还会带来重绘回流的情况，所以也就导致了性能上的问题；改进：</p> <ul><li><code>requestAnimationFrame</code>  方式去循环的插入 DOM；</li> <li>虚拟滚动 (virtualized scroller)：只渲染可视区域内的内容，非可见区域的完全不渲染，当用户在滚动的时就实时去替换渲染的内容  <a href="https://github.com/bvaughn/react-virtualized" target="_blank" rel="noopener noreferrer">react-virtualized<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；</li></ul> <h3 id="_6-x-2、渲染阻塞问题"><a href="#_6-x-2、渲染阻塞问题" class="header-anchor">#</a> 6-X-2、渲染阻塞问题</h3> <ul><li>首先，渲染的前提是生成渲染树，故 HTML 和 CSS 势必会阻塞渲染；
<ul><li>优化：若想渲染快，可降低初始所需的渲染的文件 大小，并且扁平层级，优化选择器；</li> <li>注意：CSS 由单独的下载线程异步下载，由于 DOM 树的解析和构建此步与 css 并无关系，故并不会影响 DOM 解析，但最终布局树需要 DOM 树和 DOM 样式的，因此 CSS 会阻塞布局树的建立；</li></ul></li> <li>然后，当浏览器在解析到  <code>script</code> 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始(即 script 会阻塞页面渲染)；
<ul><li>因为：JS属于单线程，在加载 <code>script</code> 标签内容时，渲染线程会被暂停，因 <code>script</code>标签中内容可能会操作<code>DOM</code>，若加载<code>script</code>标签的同时渲染页面就会产生冲突，渲染线程(<code>GUI</code>)和 JS 引擎线程是互斥的；</li> <li>优化：若想首屏渲染快，一般而言不应在首屏时就加载 JS 文件，而将 <code>script</code> 标签放在 <code>body</code> 标签底部；</li> <li>优化：若想首屏渲染快，亦可给 <code>script</code> 标签添加 <code>defer</code> 或 <code>async</code> 属性：
<ul><li><code>defer</code> 属性表示该 JS 文件会并行下载，但会放到 HTML 解析完成后顺序执行，此时的 <code>script</code> 标签可放在任意位置；</li> <li>对于没有任何依赖的 JS 文件可以加上 <code>async</code> 属性，表示 JS 文件下载和解析不会阻塞渲染；</li> <li>注意：一般脚本与 DOM 元素和其它脚本间的依赖关系不强时会选用 async；当脚本依赖于 DOM 元素和其它脚本的执行结果时会选用 defer；</li></ul></li></ul></li></ul> <h3 id="_6-x-2-1、script-引入方式"><a href="#_6-x-2-1、script-引入方式" class="header-anchor">#</a> 6-X-2-1、script 引入方式</h3> <ul><li><p>JS 动态插入 <code>&lt;script&gt;</code></p></li> <li><p>HTML 静态引入 <code>&lt;script&gt;</code></p> <ul><li><code>&lt;script defer&gt;</code>：延迟加载，元素解析完成后执行；</li> <li><code>&lt;script async&gt;</code>：异步加载，但执行时会阻塞元素渲染；</li></ul></li></ul> <h3 id="_6-x-3、关键渲染路径问题"><a href="#_6-x-3、关键渲染路径问题" class="header-anchor">#</a> 6-X-3、关键渲染路径问题</h3> <p>不考虑缓存和优化网络协议，只考虑可以通过哪些方式来最快的渲染页面：</p> <ul><li>从文件大小：前略；</li> <li>从 <code>script</code> 标签使用：前略；</li> <li>从 CSS、HTML 的代码书写：前略；</li> <li>从需要下载的内容是否需要在首屏使用：前略；</li></ul></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">最后更新: </span> <span class="time">9/19/2020, 7:31:44 PM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.58d463af.js" defer></script><script src="/assets/js/3.5b6bd7ce.js" defer></script><script src="/assets/js/1.53e5735b.js" defer></script><script src="/assets/js/171.01628965.js" defer></script>
  </body>
</html>

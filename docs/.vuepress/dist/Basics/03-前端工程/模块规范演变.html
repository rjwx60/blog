<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、模块规范演变 | Leibnize 个人学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="素材整理自网络，仅供个人学习记录之用">
    <link rel="preload" href="/assets/css/0.styles.4c1fe16c.css" as="style"><link rel="preload" href="/assets/js/app.58d463af.js" as="script"><link rel="preload" href="/assets/js/3.5b6bd7ce.js" as="script"><link rel="preload" href="/assets/js/1.53e5735b.js" as="script"><link rel="preload" href="/assets/js/98.4524a102.js" as="script"><link rel="prefetch" href="/assets/js/10.47a34be1.js"><link rel="prefetch" href="/assets/js/100.2f7c82fb.js"><link rel="prefetch" href="/assets/js/101.57a81617.js"><link rel="prefetch" href="/assets/js/102.8befc7fd.js"><link rel="prefetch" href="/assets/js/103.c690f409.js"><link rel="prefetch" href="/assets/js/104.c8b86b63.js"><link rel="prefetch" href="/assets/js/105.9bac0b69.js"><link rel="prefetch" href="/assets/js/106.77dcd9f8.js"><link rel="prefetch" href="/assets/js/107.305a0cd6.js"><link rel="prefetch" href="/assets/js/108.197f379c.js"><link rel="prefetch" href="/assets/js/109.ed1f6dd8.js"><link rel="prefetch" href="/assets/js/11.d67029e2.js"><link rel="prefetch" href="/assets/js/110.b10adffc.js"><link rel="prefetch" href="/assets/js/111.27cb5e44.js"><link rel="prefetch" href="/assets/js/112.598f5429.js"><link rel="prefetch" href="/assets/js/113.b7f9fe99.js"><link rel="prefetch" href="/assets/js/114.cb9df12d.js"><link rel="prefetch" href="/assets/js/115.4d812f2c.js"><link rel="prefetch" href="/assets/js/116.3a4f5195.js"><link rel="prefetch" href="/assets/js/117.be29161e.js"><link rel="prefetch" href="/assets/js/118.eb6b99b9.js"><link rel="prefetch" href="/assets/js/119.b3f342d7.js"><link rel="prefetch" href="/assets/js/12.f13f81de.js"><link rel="prefetch" href="/assets/js/120.f343ff14.js"><link rel="prefetch" href="/assets/js/121.5983ebbd.js"><link rel="prefetch" href="/assets/js/122.8dd46465.js"><link rel="prefetch" href="/assets/js/123.71ffc4a2.js"><link rel="prefetch" href="/assets/js/124.4e568dbe.js"><link rel="prefetch" href="/assets/js/125.43b22375.js"><link rel="prefetch" href="/assets/js/126.6522a7eb.js"><link rel="prefetch" href="/assets/js/127.8308b909.js"><link rel="prefetch" href="/assets/js/128.1fd06c87.js"><link rel="prefetch" href="/assets/js/129.91e28eff.js"><link rel="prefetch" href="/assets/js/13.ac76083d.js"><link rel="prefetch" href="/assets/js/130.5027f9f0.js"><link rel="prefetch" href="/assets/js/131.4554c2f2.js"><link rel="prefetch" href="/assets/js/132.c643aed4.js"><link rel="prefetch" href="/assets/js/133.5e499634.js"><link rel="prefetch" href="/assets/js/134.59b1b330.js"><link rel="prefetch" href="/assets/js/135.da46fa8a.js"><link rel="prefetch" href="/assets/js/136.3a67d738.js"><link rel="prefetch" href="/assets/js/137.4d5f5f5e.js"><link rel="prefetch" href="/assets/js/138.1fe93dba.js"><link rel="prefetch" href="/assets/js/139.d7f54242.js"><link rel="prefetch" href="/assets/js/14.8e5c3120.js"><link rel="prefetch" href="/assets/js/140.82be0f82.js"><link rel="prefetch" href="/assets/js/141.979c5a91.js"><link rel="prefetch" href="/assets/js/142.658ae82d.js"><link rel="prefetch" href="/assets/js/143.17532399.js"><link rel="prefetch" href="/assets/js/144.dc947607.js"><link rel="prefetch" href="/assets/js/145.fc89bd8c.js"><link rel="prefetch" href="/assets/js/146.a5e1b7eb.js"><link rel="prefetch" href="/assets/js/147.0f8384fc.js"><link rel="prefetch" href="/assets/js/148.fccbb459.js"><link rel="prefetch" href="/assets/js/149.d2d32bbc.js"><link rel="prefetch" href="/assets/js/15.e17af96c.js"><link rel="prefetch" href="/assets/js/150.73f88a17.js"><link rel="prefetch" href="/assets/js/151.dd85d521.js"><link rel="prefetch" href="/assets/js/152.ca632725.js"><link rel="prefetch" href="/assets/js/153.02b859a6.js"><link rel="prefetch" href="/assets/js/154.268e5dd0.js"><link rel="prefetch" href="/assets/js/155.0df9a80c.js"><link rel="prefetch" href="/assets/js/156.0e786e96.js"><link rel="prefetch" href="/assets/js/157.79cdcd86.js"><link rel="prefetch" href="/assets/js/158.8a131380.js"><link rel="prefetch" href="/assets/js/159.7aed0b17.js"><link rel="prefetch" href="/assets/js/16.472bfca7.js"><link rel="prefetch" href="/assets/js/160.31daa77a.js"><link rel="prefetch" href="/assets/js/161.a44e6bf4.js"><link rel="prefetch" href="/assets/js/162.86180287.js"><link rel="prefetch" href="/assets/js/163.c9fd632a.js"><link rel="prefetch" href="/assets/js/164.15e04e68.js"><link rel="prefetch" href="/assets/js/165.69bcb02b.js"><link rel="prefetch" href="/assets/js/166.084ab8e2.js"><link rel="prefetch" href="/assets/js/167.0f42977a.js"><link rel="prefetch" href="/assets/js/168.a4474b7b.js"><link rel="prefetch" href="/assets/js/169.3d05b3ba.js"><link rel="prefetch" href="/assets/js/17.f9d21c6e.js"><link rel="prefetch" href="/assets/js/170.484ffe30.js"><link rel="prefetch" href="/assets/js/171.01628965.js"><link rel="prefetch" href="/assets/js/172.2dc6c763.js"><link rel="prefetch" href="/assets/js/173.4fa13f79.js"><link rel="prefetch" href="/assets/js/174.5da03623.js"><link rel="prefetch" href="/assets/js/175.7c3cae2a.js"><link rel="prefetch" href="/assets/js/176.3df0d63b.js"><link rel="prefetch" href="/assets/js/177.3aa8d705.js"><link rel="prefetch" href="/assets/js/178.5b48450e.js"><link rel="prefetch" href="/assets/js/179.3a963dce.js"><link rel="prefetch" href="/assets/js/18.8314222e.js"><link rel="prefetch" href="/assets/js/180.d67c14c9.js"><link rel="prefetch" href="/assets/js/181.c7bf4046.js"><link rel="prefetch" href="/assets/js/182.4a4705fd.js"><link rel="prefetch" href="/assets/js/183.9183a7da.js"><link rel="prefetch" href="/assets/js/184.290760c3.js"><link rel="prefetch" href="/assets/js/185.64cd4609.js"><link rel="prefetch" href="/assets/js/186.2940410e.js"><link rel="prefetch" href="/assets/js/187.12b14c61.js"><link rel="prefetch" href="/assets/js/188.1fea2b8b.js"><link rel="prefetch" href="/assets/js/189.04b7d343.js"><link rel="prefetch" href="/assets/js/19.ed77427b.js"><link rel="prefetch" href="/assets/js/190.a7d6ec94.js"><link rel="prefetch" href="/assets/js/191.8ad7d925.js"><link rel="prefetch" href="/assets/js/192.2fd0c8f8.js"><link rel="prefetch" href="/assets/js/193.4f8a87cd.js"><link rel="prefetch" href="/assets/js/194.9e2e73ca.js"><link rel="prefetch" href="/assets/js/195.c6292340.js"><link rel="prefetch" href="/assets/js/196.b7ff135e.js"><link rel="prefetch" href="/assets/js/197.83a7d260.js"><link rel="prefetch" href="/assets/js/198.530f7c9c.js"><link rel="prefetch" href="/assets/js/199.c5048869.js"><link rel="prefetch" href="/assets/js/20.09503993.js"><link rel="prefetch" href="/assets/js/200.3435c341.js"><link rel="prefetch" href="/assets/js/201.1e492eea.js"><link rel="prefetch" href="/assets/js/202.f7b55746.js"><link rel="prefetch" href="/assets/js/203.08e404b6.js"><link rel="prefetch" href="/assets/js/204.1bc4bdd8.js"><link rel="prefetch" href="/assets/js/21.38c15b75.js"><link rel="prefetch" href="/assets/js/22.ae59de53.js"><link rel="prefetch" href="/assets/js/23.1c6d3160.js"><link rel="prefetch" href="/assets/js/24.28c7c43e.js"><link rel="prefetch" href="/assets/js/25.e53d1234.js"><link rel="prefetch" href="/assets/js/26.6fe14a49.js"><link rel="prefetch" href="/assets/js/27.910bdd9c.js"><link rel="prefetch" href="/assets/js/28.9d9cd019.js"><link rel="prefetch" href="/assets/js/29.525906aa.js"><link rel="prefetch" href="/assets/js/30.8a1a47c0.js"><link rel="prefetch" href="/assets/js/31.750a297b.js"><link rel="prefetch" href="/assets/js/32.290c8619.js"><link rel="prefetch" href="/assets/js/33.885855c1.js"><link rel="prefetch" href="/assets/js/34.fb5b3f84.js"><link rel="prefetch" href="/assets/js/35.22021291.js"><link rel="prefetch" href="/assets/js/36.6736dcbf.js"><link rel="prefetch" href="/assets/js/37.50fc071e.js"><link rel="prefetch" href="/assets/js/38.a6f00886.js"><link rel="prefetch" href="/assets/js/39.e5f0c600.js"><link rel="prefetch" href="/assets/js/4.4c62e10b.js"><link rel="prefetch" href="/assets/js/40.7eaf6de1.js"><link rel="prefetch" href="/assets/js/41.c55fd828.js"><link rel="prefetch" href="/assets/js/42.2c5aaafc.js"><link rel="prefetch" href="/assets/js/43.6c939d74.js"><link rel="prefetch" href="/assets/js/44.22ccc866.js"><link rel="prefetch" href="/assets/js/45.56a056b8.js"><link rel="prefetch" href="/assets/js/46.6901927f.js"><link rel="prefetch" href="/assets/js/47.78460423.js"><link rel="prefetch" href="/assets/js/48.12fddaae.js"><link rel="prefetch" href="/assets/js/49.55f5515e.js"><link rel="prefetch" href="/assets/js/5.97a7c0dc.js"><link rel="prefetch" href="/assets/js/50.5c665644.js"><link rel="prefetch" href="/assets/js/51.9fbd3941.js"><link rel="prefetch" href="/assets/js/52.f3a93332.js"><link rel="prefetch" href="/assets/js/53.f7c91d71.js"><link rel="prefetch" href="/assets/js/54.035bd227.js"><link rel="prefetch" href="/assets/js/55.9d4300de.js"><link rel="prefetch" href="/assets/js/56.1fa21a7d.js"><link rel="prefetch" href="/assets/js/57.c6af5e20.js"><link rel="prefetch" href="/assets/js/58.8c0baaa7.js"><link rel="prefetch" href="/assets/js/59.63f1befc.js"><link rel="prefetch" href="/assets/js/6.8e992509.js"><link rel="prefetch" href="/assets/js/60.35539f20.js"><link rel="prefetch" href="/assets/js/61.0872b63b.js"><link rel="prefetch" href="/assets/js/62.6749d184.js"><link rel="prefetch" href="/assets/js/63.0a8a07d3.js"><link rel="prefetch" href="/assets/js/64.a2eeb6f7.js"><link rel="prefetch" href="/assets/js/65.d78ecb46.js"><link rel="prefetch" href="/assets/js/66.1e1a87a2.js"><link rel="prefetch" href="/assets/js/67.b550d647.js"><link rel="prefetch" href="/assets/js/68.68258f2e.js"><link rel="prefetch" href="/assets/js/69.9f502a69.js"><link rel="prefetch" href="/assets/js/7.159745e4.js"><link rel="prefetch" href="/assets/js/70.c9b2fe76.js"><link rel="prefetch" href="/assets/js/71.b7b04483.js"><link rel="prefetch" href="/assets/js/72.edb7dfe5.js"><link rel="prefetch" href="/assets/js/73.869de1e4.js"><link rel="prefetch" href="/assets/js/74.7816f275.js"><link rel="prefetch" href="/assets/js/75.0457b07c.js"><link rel="prefetch" href="/assets/js/76.79a2eaee.js"><link rel="prefetch" href="/assets/js/77.66cfa995.js"><link rel="prefetch" href="/assets/js/78.9dd75caf.js"><link rel="prefetch" href="/assets/js/79.f6111e69.js"><link rel="prefetch" href="/assets/js/8.b79c23ae.js"><link rel="prefetch" href="/assets/js/80.fff0a469.js"><link rel="prefetch" href="/assets/js/81.42c5ebec.js"><link rel="prefetch" href="/assets/js/82.ca2f7f18.js"><link rel="prefetch" href="/assets/js/83.ed547319.js"><link rel="prefetch" href="/assets/js/84.377155d9.js"><link rel="prefetch" href="/assets/js/85.e5aab871.js"><link rel="prefetch" href="/assets/js/86.14705636.js"><link rel="prefetch" href="/assets/js/87.502cb8e9.js"><link rel="prefetch" href="/assets/js/88.d8f271ec.js"><link rel="prefetch" href="/assets/js/89.3e9deca1.js"><link rel="prefetch" href="/assets/js/9.23c0899b.js"><link rel="prefetch" href="/assets/js/90.4de4929c.js"><link rel="prefetch" href="/assets/js/91.307ce9fd.js"><link rel="prefetch" href="/assets/js/92.47e69683.js"><link rel="prefetch" href="/assets/js/93.34abda4c.js"><link rel="prefetch" href="/assets/js/94.00078270.js"><link rel="prefetch" href="/assets/js/95.4c9ca2ce.js"><link rel="prefetch" href="/assets/js/96.9121392c.js"><link rel="prefetch" href="/assets/js/97.41f6bdb8.js"><link rel="prefetch" href="/assets/js/99.7d313788.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4c1fe16c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Leibnize 个人学习笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Leibnize 个人学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Basics/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  基本
</a></div><div class="nav-item"><a href="/NetWork/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></div><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><!----> <h3 class="name" data-v-ca798c94>
    Leibnize 个人学习笔记
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/Basics/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  基本
</a></div><div class="nav-item"><a href="/NetWork/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></div><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端专题</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/01-前端基础" class="sidebar-heading clickable"><span>01-前端基本</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/02-前端性能" class="sidebar-heading clickable"><span>02-前端性能</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/03-前端工程" class="sidebar-heading clickable open"><span>03-前端工程</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Basics/03-前端工程/模块规范演变.html" class="active sidebar-link">一、模块规范演变</a></li><li><a href="/Basics/03-前端工程/模块构建工具.html" class="sidebar-link">二、模块构建工具</a></li><li><a href="/Basics/03-前端工程/webpack配置.html" class="sidebar-link">三、webpack 配置</a></li><li><a href="/Basics/03-前端工程/webpack原理.html" class="sidebar-link">四、webpack 原理</a></li><li><a href="/Basics/03-前端工程/webpackLoader.html" class="sidebar-link">五、webpack loader</a></li><li><a href="/Basics/03-前端工程/webpackPlugin.html" class="sidebar-link">六、webpack plugin</a></li><li><a href="/Basics/03-前端工程/前端开发流程.html" class="sidebar-link">七、前端开发流程</a></li><li><a href="/Basics/03-前端工程/Summary.html" class="sidebar-link">八、Summary</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/04-前端异步" class="sidebar-heading clickable"><span>04-前端异步</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/05-前端设计" class="sidebar-heading clickable"><span>05-前端设计</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/06-前端数据" class="sidebar-heading clickable"><span>06-前端数据</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/07-前端安全" class="sidebar-heading clickable"><span>07-前端安全</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/08-前端概念" class="sidebar-heading clickable"><span>08-前端概念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/09-前端实现" class="sidebar-heading clickable"><span>09-前端实现</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/10-前端新标" class="sidebar-heading clickable"><span>10-前端新标</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/11-前端会话" class="sidebar-heading clickable"><span>11-前端会话</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/12-前端框架" class="sidebar-heading clickable"><span>12-前端框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/14-浏览器相关" class="sidebar-heading clickable"><span>14-浏览器相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/15-前端核心" class="sidebar-heading clickable"><span>15-前端核心</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/16-前端Node" class="sidebar-heading clickable"><span>16-前端Node</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>一、模块规范演变</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Leibnize 个人学习笔记</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="一、模块规范演变"><a href="#一、模块规范演变" class="header-anchor">#</a> 一、模块规范演变</h1> <p>1999 - <strong><u><em>直接定义依赖</em></u></strong>：通过全局方法定义、引用模块；</p> <ul><li>此方式神似 CMJS，但 CMJS 以文件作为模块，可在任何文件中定义模块，模块不与文件关联；</li></ul> <p>2003 - <strong><u><em>闭包模块化模式</em></u></strong>：通过闭包内返回模块对象，只需对外暴露一个全局变量；</p> <ul><li>此方式解决了变量污染问题；</li></ul> <p>2006 - 模版依赖定义：通过后端模板语法聚合 JS 文件，从而实现依赖加载；</p> <ul><li>此方式存在严重的可维护性问题；</li></ul> <p>2006 - 注释依赖定义：通过 lazyjs 加载文件，同时读取文件注释，继续递归加载剩下的文件；</p> <ul><li>此方式与 1999 年方案不同的，不仅仅是模块定义方式，而是终于以文件为单位定义模块了；</li></ul> <p>2007 - 外部依赖定义：将依赖抽出单独文件定义；</p> <ul><li>此方式在 Cocos2d-js 开发中普遍使用，但不利于项目管理；</li></ul> <p>2009 - Sandbox 模式：将所有模块塞到一个 sanbox 变量中；</p> <ul><li>此方式无法解决冲突问题，毕竟都塞到一个 sandbox 对象里，而 Sandbox 对象也需要定义在全局，存在被覆盖的风险；</li></ul> <p>2009 - <strong><u><em>依赖注入</em></u></strong>：即 Angular1.0；</p> <ul><li>此思想现在已广泛运用在 react、vue 等流行框架中；</li></ul> <p>2009 - <strong><u><em>CMJS</em></u></strong>：真正解决模块化问题，从 Node 端逐渐发力到前端，前端需要使用构建工具模拟；</p> <p>2009 - <strong><u><em>AMD</em></u></strong>：解决前端动态加载依赖，相比 commonJs，体积更小，按需加载；</p> <p>2011 - <strong><u><em>UMD</em></u></strong>：兼容了 CMJS 与 AMD，核心思想：</p> <ul><li>若在 CMJS 环境（存在 module.exports，不存在 define），将函数执行结果交给 module.exports 实现 CMJS；</li> <li>其余环境则用 Amd 环境的 define，实现 Amd；</li></ul> <p>2012 - Labeled Modules：生不逢时；</p> <ul><li>与 CMJS 很像，无硬伤，被人遗忘；</li></ul> <p>2013 - YModules：使用 provide 取代 return；</p> <ul><li>可控制模块结束时机，处理异步结果；</li> <li>拿到第二个参数 module，可修改其他模块的定义，有一定拓展意义，但也有污染意味；</li></ul> <p>2015 - <strong><u><em>ES2015 Modules</em></u></strong>：现在模块化方案，还没有被浏览器实现，大部分项目已通过 babel 或 typescript 提前体验；</p> <h2 id="_1-1、过去"><a href="#_1-1、过去" class="header-anchor">#</a> 1-1、过去</h2> <ul><li><p>问题：命名空间冲突(代码合并后的冲突、变量覆盖等问题)、文件依赖关系处理(重复加载、重复引用、引入不全、依赖关系复杂难以修改等问题)、其他等问题(函数群的落后注释分割、使用有限的功能但引入了整一个库文件)；</p></li> <li><p>背景：网站规模越来越大、项目代码越来越复杂：</p> <ul><li>传统网页开发正在转变成 Web Apps 开发；</li> <li>代码复杂度逐步增高，随着 Web 能力增强，越来越多业务逻辑和交互均可放在 Web 层实现；</li></ul></li> <li><p>需求：前端模块化愈发迫切；</p> <ul><li>分离的 JS 文件/模块，可提高后续代码的维护性；</li> <li>模块化能在部署时将代码优化成几个 HTTP 请求；</li> <li>其他开发、版本迭代等等原因；</li></ul></li></ul> <h2 id="_1-2、演变"><a href="#_1-2、演变" class="header-anchor">#</a> 1-2、演变</h2> <ul><li>发展：语言在发展，在社区中学习，参考诸多优秀实现，逐步优化；</li> <li>比如：代码分离(或文件或chunk)、代码可组合、依赖需管理、解决一致性问题；</li></ul> <h3 id="_1-2-1、阶段一-直接定义"><a href="#_1-2-1、阶段一-直接定义" class="header-anchor">#</a> 1-2-1、阶段一 直接定义</h3> <p><strong><u><em>阶段一：内嵌脚本 / script 标签/直接定义依赖-1999：</em></u></strong></p> <p>问题：缺乏代码可重用性、全局变量污染、产生命名冲突、缺乏依赖解析；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>补充：直接定义依赖：简单粗暴，通过全局方法定义、引用模块；</p> <p>比如：Dojo，使用 dojo.provide 定义一个模块， dojo.require 来调用在其它地方定义的模块；</p> <p>区别：类似 CMJS，但前者可以在任何文件中定义模块，模块不和文件进行关联</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181202.png" align="" style="zoom:50%;"> <h3 id="_1-2-2、阶段二-namespace"><a href="#_1-2-2、阶段二-namespace" class="header-anchor">#</a> 1-2-2、阶段二 NameSpace</h3> <p><strong><u><em>阶段二：NameSpace 模式 / 对象字面量模式-2002</em></u></strong></p> <p>意义：减轻全局变量污染情况(阶段一问题)、易于理解 &amp; 实现；</p> <p>问题：缺乏依赖解析、可随意读写内部变量、(方法调用长度随嵌套程度增加而增加)、无法解决代码和数据隔离问题；</p> <p>问题：并非真正私有、只适合小型封装，否则命名空间会很长；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">MODULE</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'TLP'</span><span class="token punctuation">,</span>
	<span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token constant">MODULE</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-3、阶段三-iife"><a href="#_1-2-3、阶段三-iife" class="header-anchor">#</a> 1-2-3、阶段三 IIFE</h3> <p><strong><u><em>阶段三：IIFE模式-2003</em></u></strong></p> <p>意义：不可随意读写内部变量、代码隔离、早期较为常用；</p> <p>问题：缺乏依赖解析、所需依赖需提前提供、(闭包使用过多导致内存泄露)；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> _private <span class="token operator">=</span> <span class="token string">'...'</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">_pFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    fn1<span class="token operator">:</span> mod1<span class="token punctuation">.</span>fn<span class="token punctuation">,</span>
    fn2<span class="token operator">:</span> mod2<span class="token punctuation">.</span>fn<span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Module<span class="token punctuation">.</span><span class="token function">fn1</span><span class="token punctuation">(</span>mod1<span class="token punctuation">,</span> mod2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong><u><em>阶段三又一(1/2)：模板依赖定义-2006</em></u></strong></p> <p>意义：用于解决模块化问题的方案，需配合后端模板语法共同使用，通过后端语法聚合 JS 文件，从而实现依赖加载 (如 Prototype1.4)；</p> <p>实现：某 JS 文件若其依赖其它 JS 文件，则可在此文件头部，加上特殊标签语法指定，随后通过后端模板引擎 (比如 erb、jinjia、smarty) 解析和特殊构建工具识别(如 borshik )；</p> <p>局限：只能作用于预编译阶段；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181203.png" align="" style="zoom:50%;"> <p><strong><u><em>阶段三又二(1/2)：注释定义依赖-2006</em></u></strong></p> <p>意义：类似于1999 的直接定义依赖，但注释定义依赖是以文件为单位去定义模块，模块间的依赖关系通过注释语法进行定义；</p> <p>实现：通过预编译方式，或运行期动态解析下载下载的代码；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181204.png" align="" style="zoom:50%;"> <h3 id="_1-2-4、阶段四-dependency-inject"><a href="#_1-2-4、阶段四-dependency-inject" class="header-anchor">#</a> 1-2-4、阶段四 Dependency Inject</h3> <p><strong><u><em>阶段四：IIFE + 依赖注入-Dependency Inject - 2009</em></u></strong></p> <p>源远：2004 年，Martin Fowler 为描述 Java 中组件间的通信问题，提出了依赖注入概念；5 年后，前 Sun 和 Adobe 员工 Miško Hevery 开始为他的创业公司设计一 JS 框架，此框架主要使用依赖注入思想去解决组件间的通信问题，后被谷歌收购；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181205.png" align="" style="zoom:50%;"> <p>意义：放开部分限制，可在内部使用其他工具库、实现装饰器模式、解耦代码与供给对象，为后来模块化发展以启示 (<strong><u><em>现代模块实现基石</em></u></strong>)</p> <p>问题：缺乏依赖解析、引入依赖数目有限；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// so can use jQuery</span>
  <span class="token keyword">var</span> _$body <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// Revelation Pattern</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    foo<span class="token operator">:</span> foo
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>

Module<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong><u><em>阶段四又X：密集发展阶段</em></u></strong></p> <p>问题：上述阶段对代码的封装有了很好的实践，但无解决代码依赖问题 (请求过多、依赖关系模糊、难以维护、性能问题)：</p> <div class="language-html extra-class"><pre class="language-html"><code>// 伪码 - html
body
	script(src=&quot;zepto.js&quot;)
	script(src=&quot;jhash.js&quot;)
	script(src=&quot;fastClick.js&quot;)
	script(src=&quot;iScroll.js&quot;)
	script(src=&quot;underscore.js&quot;)
	script(src=&quot;handlebar.js&quot;)
	script(src=&quot;datacenter.js&quot;)
	script(src=&quot;deferred.js&quot;)
	script(src=&quot;util/wxbridge.js&quot;)
	script(src=&quot;util/login.js&quot;)
	script(src=&quot;util/base.js&quot;)
	script(src=&quot;util/city.js&quot;)
	// ...
</code></pre></div><p>发展1：LAB.js - 基于文件的依赖管理—Dependency Management，<a href="http://www.ruanyifeng.com/blog/2011/10/javascript_loading.html" target="_blank" rel="noopener noreferrer">可看<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&quot;LAB.js&quot;</span> async<span class="token punctuation">)</span>
<span class="token comment">// First-come, First-served (when execution order is not important)</span>
$<span class="token constant">LAB</span><span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token string">&quot;framework.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token string">&quot;plugin.framework.js&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token string">&quot;myplugin.framework.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token string">&quot;init.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// wait for all scripts to execut first</span>
$<span class="token constant">LAB</span><span class="token punctuation">.</span><span class="token function">script</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;s1.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;s2.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;s3.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">s1Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">s2Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">s3Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>发展2：YUI3 - 基于模块的依赖管理 - 2009，准备迈入阶段5 (<strong><u><em>模块化架构雏形</em></u></strong>)，[可看]([https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;tn=baidu&amp;wd=YUI%20%E6%A8%A1%E5%9D%97%E5%8C%96&amp;oq=YUI%2520%25E5%2589%258D%25E7%25AB%25AF&amp;rsv_pq=bc03ac140007472a&amp;rsv_t=55428Gr%2FSFfpgrWkpfSht8tdITGrATfw3YgUBAsEfi8w%2F1WJ%2FriV8exMgJg&amp;rqlang=cn&amp;rsv_enter=1&amp;rsv_dl=tb&amp;inputT=6343&amp;rsv_sug3=112&amp;rsv_sug1=47&amp;rsv_sug7=100&amp;rsv_sug2=0&amp;rsv_sug4=6713](https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=1&amp;tn=baidu&amp;wd=YUI 模块化&amp;oq=YUI%20%E5%89%8D%E7%AB%AF&amp;rsv_pq=bc03ac140007472a&amp;rsv_t=55428Gr%2FSFfpgrWkpfSht8tdITGrATfw3YgUBAsEfi8w%2F1WJ%2FriV8exMgJg&amp;rqlang=cn&amp;rsv_enter=1&amp;rsv_dl=tb&amp;inputT=6343&amp;rsv_sug3=112&amp;rsv_sug1=47&amp;rsv_sug7=100&amp;rsv_sug2=0&amp;rsv_sug4=6713))：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hello.js</span>
<span class="token constant">YUI</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">Y</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token constant">DOM</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">'innerHTML'</span><span class="token punctuation">,</span> <span class="token string">'Hello!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'3.0.0'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> requires<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'dom'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// main.js</span>
<span class="token constant">YUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">Y</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'Hi TLP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>YUI 实际上是一个强沙箱，所有依赖模块通过 attach 方式被注入沙盒；</p> <ul><li>attach：在当前 YUI 实例上执行模块的初始化代码，使模块在当前实例上可用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Sandbox Implementation</span>
<span class="token keyword">function</span> <span class="token function">Sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// initialize the required modules</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Sandbox<span class="token punctuation">.</span>modules<span class="token punctuation">[</span>modules<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Use</span>
<span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&quot;/path/to/yui-mini.js&quot;</span><span class="token punctuation">)</span>		<span class="token comment">// YUI seed</span>
<span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&quot;/path/to/my/module1.js&quot;</span><span class="token punctuation">)</span>	<span class="token comment">// add('module1')</span>
<span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&quot;/path/to/my/module2.js&quot;</span><span class="token punctuation">)</span> 	<span class="token comment">// add('module2')</span>
<span class="token function">script</span><span class="token punctuation">(</span>src<span class="token operator">=</span><span class="token string">&quot;/path/to/my/module3.js&quot;</span><span class="token punctuation">)</span>	<span class="token comment">// add('module3')</span>

<span class="token comment">// ...</span>

<span class="token constant">YUI</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'module1'</span><span class="token punctuation">,</span> <span class="token string">'module2'</span><span class="token punctuation">,</span> <span class="token string">'module3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">Y</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// you can use all this module now</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>YUI 改进：YUI Combo，解决过多请求问题</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181206.png" align="" style="zoom:50%;"> <h3 id="_1-2-5、阶段五-commonjs"><a href="#_1-2-5、阶段五-commonjs" class="header-anchor">#</a> 1-2-5、阶段五 CommonJs</h3> <p><strong><u><em>阶段五：CommonJs - API标准 &amp; Node - Modules/1.0-2009</em></u></strong></p> <p>2009年，Node 诞生，JS 迈入服务器端；</p> <p>2009年，CommonJS 规范推出，并最后在 Node 中被实现；</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181207.png" align="" style="zoom:50%;"> <p>注意：在将 Node.js 中的模块发送给 V8 前，会通过下面的函数进行包裹：</p> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181208.png" align="" style="zoom:50%;"> <p>目的：让浏览器之外的 JS (比如服务器端 / 桌面端) 能通过模块化方式来开发 &amp; 协作：</p> <p>基本：<a href="https://en.wikipedia.org/wiki/CommonJS" target="_blank" rel="noopener noreferrer">CommonJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 规范中，每 JS 文件均为独立的模块上下文 (module context)，除非是 global 顶层对象属性，否则不能访问内部定义变量 (不污染全局作用域)；</p> <p>意义：变量作用域限制在内部，彻底解决代码封装问题，模块依赖关系变得清晰、影响 ES6 的模块语法设计；</p> <p>问题：阻塞加载，require 调用须在代码执行前执行(预编译、无法懒加载)，异步环境使用受限(浏览器环境)</p> <p>附加：<a href="http://www.ruanyifeng.com/blog/2015/05/commonjs-in-browser.html" target="_blank" rel="noopener noreferrer">CommonJS 在浏览器的实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1、模块的定义与引用</span>
<span class="token comment">// CommonJS 规范中，使用 module.exports 输出模块变量，以建立模块外部 &amp; 内部通信的桥梁，使用 require 加载模块；</span>
<span class="token comment">// math.js</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// main.js</span>
<span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ./math in node</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">// 2、同步/阻塞式加载 - Synchronously</span>
<span class="token comment">// 注意: 同步加载对服务器/本地环境并不是问题，见下图</span>
<span class="token comment">// timeout.js</span>
<span class="token keyword">var</span> <span class="token constant">EXE_TIME</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">second</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  	<span class="token keyword">var</span> start <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token keyword">while</span><span class="token punctuation">(</span>start <span class="token operator">+</span> second <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token constant">EXE_TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2000ms executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// main.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./timeoutt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sync load</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181209.png" align="" style="zoom:50%;"> <p>CommonJS 的同步模式不适用于浏览器环境的异步模式；</p> <ul><li>同步加载阻塞渲染，如下；</li> <li>依赖性最大文件须最后加载，但当依赖关系变复杂时，编写与维护难度变大；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// CommonJs Syntax</span>
<span class="token keyword">var</span> Employee <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;types/Employee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Programmer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span>
<span class="token class-name">Programmer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 问题: 若 require 异步，则铁定 error</span>
</code></pre></div><p><strong><u><em>为将服务器端中使用的模块语法供浏览器使用，又避免上述问题，出现两类解决方案：RequireJS &amp; SeaJS，并逐渐形成规范</em></u></strong>：</p> <ul><li><strong><u><em>AMD</em></u></strong>：RequireJS 在推广过程中，对模块定义的规范化的产出 - 2011 - JS file &amp; modules loader - in-browser use；</li> <li><strong><u><em>CMD</em></u></strong>：SeaJS 在推广过程中，对模块定义的规范化产出 - 2011 - Extremely simple experience of modular development；</li></ul> <h3 id="_1-2-6、阶段六-acumd"><a href="#_1-2-6、阶段六-acumd" class="header-anchor">#</a> 1-2-6、阶段六 ACUMD</h3> <p><strong><u><em>阶段六：AMD/CMD/UMD - Modules/Async or Modules/Wrappings or Modules/Transport (浏览器环境模块化方案) - 2009</em></u></strong></p> <h3 id="_1-2-6-1、amd"><a href="#_1-2-6-1、amd" class="header-anchor">#</a> 1-2-6-1、AMD</h3> <p>定义：模块使用 define 定义、使用 require 调用、模块异步加载，依赖先执行；补充：采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，回调函数才会运行；</p> <p>意义：解决 Web 应用的动态加载依赖，适用于浏览器开发；</p> <p>优点：依赖前置，异步加载，所有 require 均提前下载并执行(类似提升)，故须起初就写好依赖，加载完后，执行回调函数；</p> <p>缺点：高开发成本，代码阅读和书写较困难、不符合通用模块思维方式，是一种妥协实现；</p> <p>实现：<a href="https://requirejs.org/docs/download.html" target="_blank" rel="noopener noreferrer">requirejs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、curl 、Dojo 、Nodules；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1、定义与暴露模块</span>
<span class="token function">define</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// define(函数(关键字), 将要依赖的项的列表, 回调函数);</span>
<span class="token comment">// id: 一个字符串，表示模块的名称，参数可选</span>
<span class="token comment">// dependencies: 一个数组，当前定义的模块要依赖于哪些模块，数组中的每一项表示的是要依赖模块的相对路径，参数可选</span>
<span class="token comment">// factory: 工厂方法，一个函数，具体的模块内容</span>
<span class="token comment">// factory-require：引入某个模块</span>
<span class="token comment">// factory-exports：当前模块的 exports，也就是 module.exports 的简写</span>
<span class="token comment">// factory-module：当前这个模块</span>
<span class="token comment">// 注意: 回调函数的参数顺序  数组中的依赖顺序，此相当于导入模块，而回调函数返回的值即你导出的值；</span>
       
<span class="token comment">// Ex1</span>
<span class="token comment">// 注意模块依赖必须一开始就写好</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;./a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./b&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token operator">...</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Ex2</span>
<span class="token comment">// 创建了一个名为 alpha 的模块，使用了 require、exports、beta 模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&quot;alpha&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;require&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exports&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;beta&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> beta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  exports<span class="token punctuation">.</span><span class="token function-variable function">verb</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> beta<span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// or</span>
    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;beta&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Ex3</span>
<span class="token comment">// 依赖、回调</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;type/Employee&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Employee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注意：回调会在所有依赖都被加载后才执行</span>
  <span class="token keyword">function</span> <span class="token function">Programmer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Programmer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Programmer<span class="token punctuation">;</span> <span class="token comment">// return Constructor</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 2、使用</span>
<span class="token comment">// 开头加载模块</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;../xxx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xxx<span class="token punctuation">,</span> xxx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181210.png" align="" style="zoom:50%;"> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 注意：新建项目，并安装：npm i requirejs 才可使用 define</span>

<span class="token comment">// Ex1 - 引用模块展示</span>
<span class="token comment">// math.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    add<span class="token operator">:</span> add
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// m1.js</span>
<span class="token comment">// 注意：须引入 requirejs 模块中的方法，而非直接使用 require，此 require 非彼 require</span>
<span class="token keyword">var</span> requirejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;requirejs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 加载 math 模块，并在加载完成后调用 math.add 方法</span>
<span class="token function">requirejs</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">math</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3</span>



<span class="token comment">// Ex2 - 多重依赖</span>
<span class="token comment">// m1.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'m1 here'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'TLP'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// m2.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'m1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">m1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'m2 here'</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> <span class="token function-variable function">showName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> m1<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    showName<span class="token operator">:</span> showName
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// test.js</span>
<span class="token keyword">var</span> requirejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;requirejs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">requirejs</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'m2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">math</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test here'</span><span class="token punctuation">)</span>
  m2<span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test first'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">else</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// test first</span>
<span class="token comment">// m1 here</span>
<span class="token comment">// m2 here</span>
<span class="token comment">// test here</span>
<span class="token comment">// TLP</span>
</code></pre></div><h3 id="_1-2-6-2、cmd"><a href="#_1-2-6-2、cmd" class="header-anchor">#</a> 1-2-6-2、CMD</h3> <p>定义：模块使用 define 定义 &amp; 调用、依赖就近(require)，延迟执行，懒加载</p> <ul><li>注意：依赖就近，延迟执行、很容易在 node 中运行、但依赖 SPM 打包，模块的加载逻辑偏重</li></ul> <p>实现：seaJS；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span> <span class="token comment">// 与 AMD 定义一致</span>
<span class="token comment">// define(函数(关键字), 将要依赖的项的列表, 回调函数);</span>
<span class="token comment">// id: 一个字符串，表示模块的名称，参数可选</span>
<span class="token comment">// dependencies: 一个数组，当前定义的模块要依赖于哪些模块，数组中的每一项表示的是要依赖模块的相对路径，参数可选</span>
<span class="token comment">// factory: 工厂方法，一个函数，具体的模块内容</span>
<span class="token comment">// factory-require：引入某个模块</span>
<span class="token comment">// factory-exports：当前模块的 exports，也就是 module.exports 的简写</span>
<span class="token comment">// factory-module：当前这个模块</span>
       

<span class="token comment">// 1、定义与暴露模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'xxx'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">xxx<span class="token punctuation">,</span> xxx<span class="token punctuation">,</span> xxx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2、使用 - 加载模块</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 依赖可就近书写</span>
	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 3、完整例子：所有模块都通过 define 来定义</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过 require 引入依赖</span>
  <span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> Spinning <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./spinning'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 通过 exports 对外提供接口</span>
  exports<span class="token punctuation">.</span>doSomething <span class="token operator">=</span> <span class="token operator">...</span>
  <span class="token comment">// 或通过 module.exports 提供整个接口</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-6-3、umd"><a href="#_1-2-6-3、umd" class="header-anchor">#</a> 1-2-6-3、UMD</h3> <p>是一个包装，通过判断、识别当前环境对各个规范的支持程度，以选择采用何种规范 (AMD-&gt;CommonJS-&gt;Window)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// AMD</span>
    <span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;jquery&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// CommonJs</span>
    <span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 均不是则使用浏览器全局定义</span>
    root<span class="token punctuation">.</span>testModule <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>jQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// do something</span>
  <span class="token comment">// 真正的函数体</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-2-6-4、a-cmd-对比"><a href="#_1-2-6-4、a-cmd-对比" class="header-anchor">#</a> 1-2-6-4、A &amp; CMD 对比</h3> <p>二者均为异步模块定义—Asynchronuous Modulee Definition 的一个实现；</p> <p>二者均为 CommonJs 的一种规范的实现定义，RequireJs 和 SeaJs 是其对应的实践；</p> <ul><li><p>前者定义模块时需指定依赖模块，并以形参方式引入 factory 中；</p></li> <li><p>后者定义模块时无需立即指定依赖模块，在需要时 require 即可，属于按需引入；</p></li></ul> <p>AMD、CMD最大的区别是：对依赖模块的执行时机处理不同，注意不是加载的时机或者方式不同，二者皆为异步加载模块；</p> <p>两者的 <code>define()</code> 方法的参数都相同，但是:</p> <ul><li><code>AMD</code>，会将当前模块的依赖模块，放到 <code>dependencies</code> 中加载，并在 <code>factory</code> 回调中拿到加载成功的依赖；</li> <li><code>CMD</code>，一般不在 <code>dependencies</code> 中加载，而是写在 <code>factory</code> 中，使用 <code>require</code> 加载某个依赖模块；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Ex - 1</span>
<span class="token comment">// AMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dep1'</span><span class="token punctuation">,</span> <span class="token string">'dep2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dep1<span class="token punctuation">,</span> dep2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 内部只能使用指定模块</span>
	<span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// CMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 若需某依赖时，可才再引入</span>
	<span class="token keyword">var</span> xx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'XXX'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>



<span class="token comment">// Ex - 2</span>
<span class="token comment">// AMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'m1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">m1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test here'</span><span class="token punctuation">)</span>
	<span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
		<span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// CMD</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test here'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'m1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// ...</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// AMD，先加载 m1，执行 m1，再输出 test here</span>
<span class="token comment">// CMD，先输出 test here，再加载 m1</span>

<span class="token comment">// 总结</span>
<span class="token comment">// AMD，依赖前置，在定义模块的时候就要声明其依赖的模块，定义依赖即调用</span>
<span class="token comment">// CMD，就近依赖，只有在用到某个模块的时候再去 require，使用才调用</span>
</code></pre></div><ul><li><p><strong><u><em>AMD 依赖前置 &amp; CMD 依赖就近 更具体对比</em></u></strong></p></li> <li><img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181211.png" align="" style="zoom:50%;"></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 测试下述模块在 CMD-SeaJs 与 AMD-RequireJs 情况下的输出情况 </span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'require module: main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> mod1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./mod1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mod1<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'hello mod1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> mod2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./mod2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mod2<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'hello mod2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
<span class="token function-variable function">        hello</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// CMD-SeaJs-就近依赖 结果</span>
<span class="token comment">// require module: main</span>
<span class="token comment">// require module: mod1</span>
<span class="token comment">// hello mod1</span>
<span class="token comment">// require module: mod2</span>
<span class="token comment">// hello mod2</span>
<span class="token comment">// hello main</span>

<span class="token comment">// AMD-RequireJs-依赖前置 结果</span>
<span class="token comment">// require module: mod1</span>
<span class="token comment">// require module: mod2</span>
<span class="token comment">// require module: main</span>
<span class="token comment">// hello mod1</span>
<span class="token comment">// hello mod2</span>
<span class="token comment">// hello main</span>

<span class="token comment">// 总结:</span>
<span class="token comment">// CMD - SeaJS 只会在真正需要使用(依赖)模块时才执行该模块</span>
<span class="token comment">// 虽 CMD 是异步加载模块形式, 但执行模块的顺序也是严格按照模块在代码中出现(require)的顺序</span>
<span class="token comment">// 而 AMD - RequireJS 会先尽早地执行(依赖)模块, 相当于所有的 require 都被提前, 且模块执行的顺序也不一定 100% 按顺序执行</span>
</code></pre></div></li></ul> <h3 id="_1-2-7、阶段七-esmodule"><a href="#_1-2-7、阶段七-esmodule" class="header-anchor">#</a> 1-2-7、阶段七 EsModule</h3> <p>问题：前述阶段均未得到 JS 标准原生支持，均通过 JS函数模拟；并陆续有系列问题：</p> <ul><li>多个文件、管理混乱；
<ul><li>解决途径：拆分-require-commonJS；</li></ul></li> <li>浏览器异步，无法支持；
<ul><li>解决途径：AMD/CMD/UMD，最后有了ES6，这些是模块拆分，依赖管理，加载；</li></ul></li> <li>格式语法检查麻烦，转移麻烦、无法自动化测试、压缩麻烦，请求过多；
<ul><li>解决途径：模块打包，browserify、gulp、webpack；</li></ul></li></ul> <p>解决：ES6 新增模块系统，用 import、export 关键字来导入导出模块；模块加载与打包区别：</p> <ul><li><p>模块加载：更偏向于开发，解决变量管理、依赖管理问题；</p> <ul><li>如此可在浏览器端实现模块化开发(仍存问题：发起的 HTTP 请求随之增多、性能问题凸显)；</li></ul></li> <li><p>模块打包：更偏向于生产、测试、自动化等末端问题；</p> <ul><li>指在模块化加载器处理的基础上，将入口文件打包，在打包过程中，让它去加载对应的依赖模块，最终生成的那份文件就是包含依赖模块的文件，以减少解析时加载依赖模块而增加的 http 请求；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// es module 已在 node9+ 支持，未支持的可通过 babel 或 typescript 使用</span>
<span class="token comment">// lib/greeting.js</span>
<span class="token keyword">const</span> helloTLP <span class="token operator">=</span> <span class="token punctuation">{</span>
	test<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>
	again<span class="token operator">:</span> <span class="token string">&quot;TLP&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> greeting <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token function">helloTLP</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// hello.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> greeting <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lib/greeting'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> phrase <span class="token operator">=</span> greeting<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">'again'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>phrase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-2-7-1、commonjs-与-esmodule-对比"><a href="#_1-2-7-1、commonjs-与-esmodule-对比" class="header-anchor">#</a> 1-2-7-1、CommonJs 与 EsModule 对比</h3> <ul><li>前者模块是运行时加载，后者编译时输出接口；
<ul><li>前者加载的是一个对象(即<code>module.exports</code>属性)，该对象只有在脚本运行完才会生成；</li> <li>后者模块不是对象，其对外接口只是一种静态定义，在代码静态解析阶段就会生成；</li></ul></li> <li>前者输出是值的拷贝；后者输出的是值的引用，被输出模块的内部的改变会影响引用的改变；</li> <li>前者导入的模块路径可以是表达式/字符串，因其使用的是<code>require()</code>方法；而后者只能是字符串；</li> <li>前者 <code>this</code>指向当前模块，后者 <code>this</code> 指向 <code>undefined</code>；</li> <li>前者包含顶层变量<code>arguments</code>、<code>require</code>、<code>module</code>、<code>exports</code>、<code>__filename</code>、<code>__dirname</code>，而后者没有；</li></ul> <h2 id="_1-3、总结"><a href="#_1-3、总结" class="header-anchor">#</a> 1-3、总结</h2> <img src="https://i.loli.net/2020/09/07/DBU8udxgrjcPIXG.png" align="" style="zoom:50%;"> <img src="https://i.loli.net/2020/09/07/GHBd3cUkiR9nJhx.png" align="" style="zoom:50%;"> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181212.png" align="" style="zoom:50%;"> <h3 id="_1-3-1、commonjs"><a href="#_1-3-1、commonjs" class="header-anchor">#</a> 1-3-1、Commonjs</h3> <h3 id="_1-3-1-1、实现"><a href="#_1-3-1-1、实现" class="header-anchor">#</a> 1-3-1-1、实现</h3> <ul><li>服务端：Node</li> <li>浏览器：webpack、browserfy</li></ul> <h3 id="_1-3-1-2、说明"><a href="#_1-3-1-2、说明" class="header-anchor">#</a> 1-3-1-2、说明</h3> <ul><li><p><u>采用同步方式加载模块，资源加载完再执行，用于服务端(硬盘读取速度快)；</u></p> <ul><li><p>服务端：模块加载时运行时同步加载；</p></li> <li><p>浏览器：模块加载时提前编译打包处理；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// cmjs.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cmjs-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3s later...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    error<span class="token operator">:</span> <span class="token string">'cmjs module output'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// test.js</span>
<span class="token keyword">var</span> cmjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./cmjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cmjs<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// cmjs-module</span>
<span class="token comment">// here</span>
<span class="token comment">// undefined</span>
<span class="token comment">// 3s later...</span>
</code></pre></div></li></ul></li> <li><p>代码均在模块作用域运行，不污染全局作用域；</p></li> <li><p>模块在首次执行后就会缓存，再次加载只返回缓存结果，若想再次执行，可先清除缓存；</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// cmjs.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'TLP'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// test.js</span>
<span class="token keyword">var</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./0-cmjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
m1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'TSL'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'m1: '</span><span class="token punctuation">,</span> m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> m2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./0-cmjs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'m2: '</span><span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// m1:  { name: 'TSL' }</span>
<span class="token comment">// m2:  { name: 'TSL' }</span>
</code></pre></div></li></ul></li> <li><p>输出是值的拷贝(即<code>require</code>返回的值，是被输出的值的拷贝(引用类型值会有影响，可利用作为闭包属性)，模块内部的变化也不会影响此输出值)；</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// cmjs.js</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'TLP'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">,</span>
  array
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">'TLS'</span><span class="token punctuation">;</span>
  array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token comment">// test.js</span>
<span class="token keyword">var</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./0-cmjs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m1: &quot;</span><span class="token punctuation">,</span> m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2000s later m1: &quot;</span><span class="token punctuation">,</span> m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// m1:  { name: 'TLP', array: [ 1, 2, 3 ] }</span>
<span class="token comment">// 2000s later m1:  { name: 'TLP', array: [ 1, 2, 3, 4 ] }</span>


<span class="token comment">// 闭包用途</span>
<span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">incCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> counter
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  incCounter<span class="token operator">:</span> incCounter<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h3 id="_1-3-1-3、基本语法"><a href="#_1-3-1-3、基本语法" class="header-anchor">#</a> 1-3-1-3、基本语法</h3> <h3 id="_1-3-1-3-1、引入"><a href="#_1-3-1-3-1、引入" class="header-anchor">#</a> 1-3-1-3-1、引入</h3> <ul><li>第三方引入：<code>var fs = require('fs')</code>;</li> <li>自动定义模块：<code>require('./xx.jpg')</code>；</li> <li>读入并执行一个 JS 文件，然后返回该模块的 exports 对象；若无发现指定模块则报错；</li> <li>注意：<code>require()</code> 是 <code>Node.js</code>中的一个全局方法，window 环境并不存在，也并非 CommonJS 特有，CommonJS 只是众多规范中的其中一种；</li></ul> <h3 id="_1-3-1-3-2、定义-暴露模块"><a href="#_1-3-1-3-2、定义-暴露模块" class="header-anchor">#</a> 1-3-1-3-2、定义 &amp; 暴露模块</h3> <ul><li><code>module.exports = { name: xxx, age: yyy, ... } - 有效，但注意不等于 exports = { ... } // 无效</code>；</li> <li><code>exports.name = value 等同于 module.exports.name = value</code>；</li> <li><code>module</code> 变量代表当前模块，此变量为一对象，其 <code>exports</code> 属性是对外接口，即 exports 须与 module 搭配使用；</li></ul> <h3 id="_1-3-1-3-3、其他-模块标识符"><a href="#_1-3-1-3-3、其他-模块标识符" class="header-anchor">#</a> 1-3-1-3-3、其他：模块标识符</h3> <p>模块标识符即在引入模块时调用 <code>require()</code> 函数的参数；</p> <div class="language- extra-class"><pre class="language-text"><code>// 直接导入
const path = require('path');
// 相对路径
const TLP = require('./TLP.js');
// 直接导入
const underscore = require('underscore');
</code></pre></div><p><strong><u>模块有不同分类和与之相对应的查找方式：</u></strong></p> <ul><li><p>核心模块(<code>Node.js</code>自带的模块，已二进制封装源码)：直接跳过路径分析和文件定位；</p></li> <li><p>路径模块(寻找相对或绝对定位开始的模块)：直接得出相对路径；</p></li> <li><p>自定义模块(寻找<code>node_modules</code>里的模块)：先在当前目录的 <code>node_modules</code> 里寻找模块，若无则往上一级目录查找，查找上一级的<code>node_modules</code>，依次往上直到根目录，若还是没有则抛出错误；</p></li> <li><p>注意：<strong><u><em>路径分析</em></u></strong>，即自定义模块的查找过程：可通过 module.paths 打印由当前目录到最上层目录的路径树：</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code>node <span class="token number">0</span><span class="token operator">-</span>cache<span class="token punctuation">.</span>js <span class="token comment">// console.log(module.paths)</span>
<span class="token punctuation">[</span> <span class="token string">'/Users/rjwx60/Documents/FE/Cache/node_modules'</span><span class="token punctuation">,</span>
  <span class="token string">'/Users/rjwx60/Documents/FE/node_modules'</span><span class="token punctuation">,</span>
  <span class="token string">'/Users/rjwx60/Documents/node_modules'</span><span class="token punctuation">,</span>
  <span class="token string">'/Users/rjwx60/node_modules'</span><span class="token punctuation">,</span>
  <span class="token string">'/Users/node_modules'</span><span class="token punctuation">,</span>
  <span class="token string">'/node_modules'</span> <span class="token punctuation">]</span>
</code></pre></div></li></ul></li> <li><p>注意：<strong><u><em>文件定位</em></u></strong>，即导入的模块它的后缀(扩展名)可省略，Node 中省略了扩展名的文件，会自动依次补充上 .js, .node, .json 来尝试, 若传入的是一个目录，则 Node 会将其作为一个包来看待，并采用以下方式确定文件名：</p> <ul><li>首先，找出目录下的 package.json，用 JSON.parse()  解析出 main 字段；
<ul><li>若 main 字段指定的文件同样省略了扩展，则依次补充 .js, .node, .json 扩展名尝试；</li> <li>若 main 字段制定的文件不存在，或根本就不存在 package.json，则默认依次尝试加载此目录下的 index.js, index.node, index.json文件；</li></ul></li></ul></li></ul> <h3 id="_1-3-2、amd"><a href="#_1-3-2、amd" class="header-anchor">#</a> 1-3-2、AMD</h3> <h3 id="_1-3-2-1、实现"><a href="#_1-3-2-1、实现" class="header-anchor">#</a> 1-3-2-1、实现</h3> <ul><li>浏览器：require.js</li></ul> <h3 id="_1-3-2-2、说明"><a href="#_1-3-2-2、说明" class="header-anchor">#</a> 1-3-2-2、说明</h3> <ul><li><u>采用异步方式加载模块，指定回调函数，用于浏览器(网络延迟决定异步方式)；</u></li> <li>依赖必须提前声明好；</li></ul> <h3 id="_1-3-2-3、基本语法"><a href="#_1-3-2-3、基本语法" class="header-anchor">#</a> 1-3-2-3、基本语法</h3> <h3 id="_1-3-2-3-1、引入"><a href="#_1-3-2-3-1、引入" class="header-anchor">#</a> 1-3-2-3-1、引入</h3> <p><code>require(['module1', 'module2'], function(m1, m2) { use m1 &amp; m2} )</code>；</p> <h3 id="_1-3-2-3-2、定义-暴露模块"><a href="#_1-3-2-3-2、定义-暴露模块" class="header-anchor">#</a> 1-3-2-3-2、定义 &amp; 暴露模块</h3> <ul><li>无依赖：<code>define(function() { return module })</code>；</li> <li>有依赖：<code>define(['module1', 'module2'], function(m1, m2) { return module })</code></li></ul> <h3 id="_1-3-3、cmd"><a href="#_1-3-3、cmd" class="header-anchor">#</a> 1-3-3、CMD</h3> <h3 id="_1-3-3-1、实现"><a href="#_1-3-3-1、实现" class="header-anchor">#</a> 1-3-3-1、实现</h3> <ul><li>浏览器：sea.js</li></ul> <h3 id="_1-3-3-2、说明"><a href="#_1-3-3-2、说明" class="header-anchor">#</a> 1-3-3-2、说明</h3> <ul><li><u>模块加载异步，模块使用时才会加载执行</u>；</li> <li>模块使用时再声明；</li> <li>整合 commonJs 与 AMD 特点；</li></ul> <h3 id="_1-3-3-3、基本语法"><a href="#_1-3-3-3、基本语法" class="header-anchor">#</a> 1-3-3-3、基本语法</h3> <h3 id="_1-3-3-3-1、引入"><a href="#_1-3-3-3-1、引入" class="header-anchor">#</a> 1-3-3-3-1、引入</h3> <ul><li>同步：<code>var fs = require('fs')</code>；</li> <li>异步：<code>require.async('./module3', function(m3){ //... })</code>；</li></ul> <h3 id="_1-3-3-3-2、定义-暴露模块"><a href="#_1-3-3-3-2、定义-暴露模块" class="header-anchor">#</a> 1-3-3-3-2、定义 &amp; 暴露模块</h3> <ul><li><p>无依赖：</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  exports<span class="token punctuation">.</span>xxx <span class="token operator">=</span> value<span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>有依赖：</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 引入依赖模块(同步)</span>
  <span class="token keyword">var</span> module2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./module2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 引入依赖模块(异步)</span>
  require<span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token string">'./module3'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 暴露</span>
  exports<span class="token punctuation">.</span>xxx <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <h3 id="_1-3-4、esmodule"><a href="#_1-3-4、esmodule" class="header-anchor">#</a> 1-3-4、EsModule</h3> <h3 id="_1-3-4-1、实现"><a href="#_1-3-4-1、实现" class="header-anchor">#</a> 1-3-4-1、实现</h3> <ul><li>服务端与浏览器端通用；</li> <li>浏览器端：目前需要使用 Babel 将 ES6 转译 ES5 或利用 Browserify 编译；</li></ul> <h3 id="_1-3-4-2、说明"><a href="#_1-3-4-2、说明" class="header-anchor">#</a> 1-3-4-2、说明</h3> <ul><li>输出使用<code>export</code>、输入使用<code>import</code></li> <li>可使用 <code>export...from...</code> 写法来达到一个 <code>&quot;中转&quot;</code> 的效果；</li> <li>输入的模块变量是不可重新赋值，它只是个可读引用，但可改写属性；</li> <li><code>import</code> 命令具有提升效果，会提升到整个模块的头部，首先执行；</li> <li><code>export</code> 和 <code>import</code> 命令可出现在模块的任何位置，只要处于模块顶层就可以；但若处于块级作用域内就会报错，因处于条件代码块中无法做静态优化，违背了ES6模块的设计初衷；</li></ul> <h3 id="_1-3-4-3、基本语法"><a href="#_1-3-4-3、基本语法" class="header-anchor">#</a> 1-3-4-3、基本语法</h3> <h3 id="_1-3-4-3-1、引入"><a href="#_1-3-4-3-1、引入" class="header-anchor">#</a> 1-3-4-3-1、引入</h3> <p>import 有两种模块导入方式：</p> <ul><li><p>命名式导入(名称导入)</p></li> <li><p>默认导入(定义式导入)</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 某个模块的导出 moudule.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// 模块导入</span>
<span class="token comment">// 1. 这里的a得和被加载的模块输出的接口名对应</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./module'</span>

<span class="token comment">// 2. 使用 as 换名</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> a <span class="token keyword">as</span> myA <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./module'</span>

<span class="token comment">// 3. 若是只想要运行被加载的模块可以这样写，但是即使加载2次也只是运行一次</span>
<span class="token keyword">import</span> <span class="token string">'./module'</span>

<span class="token comment">// 4. 整体加载</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module <span class="token keyword">from</span> <span class="token string">'./module'</span>

<span class="token comment">// 5. default接口和具名接口</span>
<span class="token keyword">import</span> module<span class="token punctuation">,</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./module'</span>
</code></pre></div></li></ul> <h3 id="_1-3-4-3-2、定义-暴露模块"><a href="#_1-3-4-3-2、定义-暴露模块" class="header-anchor">#</a> 1-3-4-3-2、定义 &amp; 暴露模块</h3> <p>export 有两种模块导出方式：</p> <ul><li><p>命名式导出(名称导出)：<code>export Module</code>；</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 以下两种为错误</span>
<span class="token comment">// 1.</span>
<span class="token keyword">export</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 2.</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> a<span class="token punctuation">;</span>

<span class="token comment">// 以下为正确</span>
<span class="token comment">// 3.</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 接口名与模块内部变量之间，建立了一一对应的关系</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// 5. 接口名与模块内部变量之间，建立了一一对应的关系</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// 或者用 as 来命名</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token keyword">as</span> outA <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token keyword">as</span> outA<span class="token punctuation">,</span> b <span class="token keyword">as</span> outB <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>默认导出(自定义导出)：<code>export default Module</code></p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1.</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> a<span class="token punctuation">;</span>

<span class="token comment">// 2.</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span> a <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 3.</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 可以导出一个函数</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 也可以出一个类</span>

<span class="token comment">// 4.</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> defalut a<span class="token punctuation">;</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h3 id="_1-3-5、es6-与-commonjs-对比"><a href="#_1-3-5、es6-与-commonjs-对比" class="header-anchor">#</a> 1-3-5、ES6 与 Commonjs 对比</h3> <p>输出值：</p> <ul><li>ES6 输出的是值引用：
<ul><li>ES6 模块是动态引用，且不会缓存值，模块中的变量绑定其所在的模块；</li></ul></li> <li>Commonjs 输出的是值拷贝；
<ul><li>模块可多次加载，但只在首次加载时运行一次，并缓存运行结果；后续加载时则直接读取缓存值，若要让模块再次运行，则须清除缓存；</li></ul></li></ul> <p>加载方式：</p> <ul><li>ES6 编译时输出接口：
<ul><li>ES6 模块不是对象，其对外接口只是一种静态定义，在的代码静态解析阶段即生成；</li></ul></li> <li>Commonjs 运行时加载：
<ul><li>因 Commonjs 加载的是一个对象(即 module.exports 属性)，该对象只有在脚本运行时才会生成；</li></ul></li></ul> <h3 id="_1-3-6、require-与-import-对比"><a href="#_1-3-6、require-与-import-对比" class="header-anchor">#</a> 1-3-6、require 与 import 对比</h3> <ul><li><p>前者 <u>支持动态导入</u>，后者不支持，正在提案 (babel 下可支持)；</p></li> <li><p>前者 属于 <u>同步导入</u>，后者属于 <u>异步导入</u>；</p></li> <li><p>前者是 <u>值拷贝</u>，导出值变化不会影响导入值；后者 <u>引用拷贝</u>，指向内存，导入值会随导出值而变化；</p></li> <li><p>注意：export/import 在 Babel 下的转换使用，正因 Babel 这种转换，才可以将 <code>exports</code> 和 <code>import</code> 结合起来用；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1、Babel 编译结果</span>
<span class="token comment">// Output</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// Input</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./m1.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>

<span class="token comment">// Babel Output</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>count <span class="token operator">=</span> count<span class="token punctuation">;</span>

<span class="token comment">// Babel Iutput</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> _m <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./m1.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_m<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token comment">// 2、因为 Babel 的存在，所以可以风格迥异的使用: exports 和 import</span>
<span class="token comment">// OutPut</span>
exports<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// Input</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./m1.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
</code></pre></div></li></ul> <h3 id="_1-3-7、cjs-的-exports-module-exports"><a href="#_1-3-7、cjs-的-exports-module-exports" class="header-anchor">#</a> 1-3-7、CJS 的 exports &amp; module.exports</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// export 来源</span>
<span class="token comment">// exports 是 module.exports 的引用: exports = module.exports</span>
<span class="token comment">// module.exports = this.exports</span>
<span class="token comment">// https://github.com/nodejs/node/blob/master/lib/internal/modules/cjs/loader.js#L1252</span>
<span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> require <span class="token operator">=</span> <span class="token function">makeRequireFunction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> redirects<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result<span class="token punctuation">;</span>
<span class="token comment">// 从这里可以看出来 exports 的实质</span>
<span class="token keyword">const</span> exports <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token keyword">const</span> thisValue <span class="token operator">=</span> exports<span class="token punctuation">;</span>
<span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>requireDepth <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> statCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>inspectorWrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  result <span class="token operator">=</span> <span class="token function">inspectorWrapper</span><span class="token punctuation">(</span>compiledWrapper<span class="token punctuation">,</span> thisValue<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里是模块包装函数</span>
  result <span class="token operator">=</span> <span class="token function">compiledWrapper</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>thisValue<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 打包结果被封装</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-3-8、综合对比"><a href="#_1-3-8、综合对比" class="header-anchor">#</a> 1-3-8、综合对比</h3> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918181213.png" align="" style="zoom:45%;"> <ul><li>CJS：require / module.exports / exports
<ul><li>CJS 用同步的方式加载模块，在服务端，模块文件都存在本地磁盘，读取速度非常快；但浏览器，受限于网络原因，适合使用异步加载 AMD/CMD；</li> <li>Node 是 CJS 规范主要践行者，有四个重要的环境变量为模块化的实现提供支持：module、exports、require、global；</li> <li>实际使用时，推荐使用 module.exports 定义当前模块对外输出的接口，用 require 加载模块；</li></ul></li> <li>AMD：require / defined
<ul><li>AMD 采用异步方式加载模块，模块加载不影响后面语句运行；故依赖这个模块的语句，都定义在一个回调函数中，等加载完成后，回调才会执行；</li> <li>require.js 是实现 AMD 规范的方式：用 require.config() 指定引用路径等，用 define() 定义模块，用 require() 加载模块；</li></ul></li> <li>CMD：
<ul><li>CMD 是另一种 JS 模块化方案，与 AMD 类似，不同点在于：AMD 推崇依赖前置、提前执行，CMD 推崇依赖就近、延迟执行；</li> <li>sea.js 在声明依赖的模块时，会第一时间加载并执行模块内的代码；</li></ul></li> <li>ESM：import / export
<ul><li>ES6 在语言标准的层面上，实现了模块功能，旨在成为浏览器和服务器通用的模块解决方案；</li> <li>其模块解决方案主要有两个命令构成：export 和 import；</li> <li>使用 import 命令的时候，用户需要知道所要加载的变量名和函数名。另外 ES6 还提供了默认导出 export default 命令，为模块指定默认输出；</li> <li>ES6 的模块不是对象，import 命令会被 JS 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以无法实现条件加载；也正因如此，使得静态分析成为可能；目前最新的 ES2020 已经实现 ES Module 的动态加载 import()；</li></ul></li></ul> <h2 id="_1-4、未来"><a href="#_1-4、未来" class="header-anchor">#</a> 1-4、未来</h2> <p>观点1：随复杂而变化；</p> <p>09年前，前端模块化探索都是基于语言层面的优化，09年后，随着 CommonJS 的引入，前端才开始采用服务端的解决方案，大量使用预编译，为何模块化方案如此晚成型，是因为前期应用复杂度在后端，但随着 Ajax 的火起，webApp 的流行，前端复杂度呈指数级上升；</p> <p>观点2：原生支持的模块化，解决 html 与 css 模块化问题正是以后的方向；</p> <p>未来 css 模块化，将是运行时的，比如不依赖预编译的方式是 <code>styled-component</code>；</p> <p>未来 html 模块化，将会得到浏览器，编辑器的模块化支持，还可能会取代 jsx 成为最强大的模块化、模板语言；</p> <p>未来 js 模块化，将会是 <code>&lt;script type=&quot;module&quot;&gt;</code> 的形式，并配合 HTTP2.0 完美抛开预编译枷锁；</p> <p>观点3：模块化标准推进进度缓慢；</p> <p>ES2015 Modules 解决了开发的问题，由于浏览器的特殊性，还是要经过繁琐打包的过程，只有当 Import，Export 和 HTTP 2.0 被主流浏览器支持，才是彻底的模块化；而 HTTP2.0 后，也会不断地有新技术出现，仍需使用配套工具将问题解决方案推向极致；</p> <p>观点4：模块化后还存在一个模块间耦合问题，若模块间耦合度大也会降低代码的可重用性或者说复用性；</p> <p>所以也出现了降低耦合的观察者模式或者发布/订阅模式；这对于提升代码重用，复用性和避免单点故障等都很重要；</p> <p>响应式编程（RxJS），核心概念就是 observable，也就是 Rx 中的流（stream），其可以被 subscribe，其实也就是观察者设计模式；</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">最后更新: </span> <span class="time">10/12/2020, 5:14:41 PM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.58d463af.js" defer></script><script src="/assets/js/3.5b6bd7ce.js" defer></script><script src="/assets/js/1.53e5735b.js" defer></script><script src="/assets/js/98.4524a102.js" defer></script>
  </body>
</html>

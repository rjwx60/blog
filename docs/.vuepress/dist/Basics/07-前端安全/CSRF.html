<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>二、CSRF | Leibnize 个人学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="整理自网络">
    <link rel="preload" href="/assets/css/0.styles.a3549ad8.css" as="style"><link rel="preload" href="/assets/js/app.f95d0077.js" as="script"><link rel="preload" href="/assets/js/3.49babee5.js" as="script"><link rel="preload" href="/assets/js/1.269e4bda.js" as="script"><link rel="preload" href="/assets/js/97.73aba549.js" as="script"><link rel="prefetch" href="/assets/js/10.6aa86c9d.js"><link rel="prefetch" href="/assets/js/100.2d552503.js"><link rel="prefetch" href="/assets/js/101.380eba67.js"><link rel="prefetch" href="/assets/js/102.4bd44e2f.js"><link rel="prefetch" href="/assets/js/103.c3ba7b95.js"><link rel="prefetch" href="/assets/js/104.93048938.js"><link rel="prefetch" href="/assets/js/105.640b5e1a.js"><link rel="prefetch" href="/assets/js/106.703adc14.js"><link rel="prefetch" href="/assets/js/107.991cb147.js"><link rel="prefetch" href="/assets/js/108.f2bd0aec.js"><link rel="prefetch" href="/assets/js/109.1d937267.js"><link rel="prefetch" href="/assets/js/11.a1d51055.js"><link rel="prefetch" href="/assets/js/110.332390f4.js"><link rel="prefetch" href="/assets/js/111.71635c45.js"><link rel="prefetch" href="/assets/js/112.2ac200df.js"><link rel="prefetch" href="/assets/js/113.46405151.js"><link rel="prefetch" href="/assets/js/114.58fa21b5.js"><link rel="prefetch" href="/assets/js/115.fa6a329a.js"><link rel="prefetch" href="/assets/js/116.37141fb0.js"><link rel="prefetch" href="/assets/js/117.d001fc73.js"><link rel="prefetch" href="/assets/js/118.217b3c9e.js"><link rel="prefetch" href="/assets/js/119.c8e2d03c.js"><link rel="prefetch" href="/assets/js/12.a5c78b74.js"><link rel="prefetch" href="/assets/js/120.f21f9f6d.js"><link rel="prefetch" href="/assets/js/121.610858f8.js"><link rel="prefetch" href="/assets/js/122.5e106cb5.js"><link rel="prefetch" href="/assets/js/123.83e9e543.js"><link rel="prefetch" href="/assets/js/124.fe964328.js"><link rel="prefetch" href="/assets/js/125.48103cb8.js"><link rel="prefetch" href="/assets/js/126.9f3a9a43.js"><link rel="prefetch" href="/assets/js/127.53393403.js"><link rel="prefetch" href="/assets/js/128.718bab74.js"><link rel="prefetch" href="/assets/js/129.94bb906d.js"><link rel="prefetch" href="/assets/js/13.6b06e1eb.js"><link rel="prefetch" href="/assets/js/130.f3cb1be6.js"><link rel="prefetch" href="/assets/js/131.b4e741b6.js"><link rel="prefetch" href="/assets/js/132.dbf75e28.js"><link rel="prefetch" href="/assets/js/133.0f2404ed.js"><link rel="prefetch" href="/assets/js/134.d17dc9c2.js"><link rel="prefetch" href="/assets/js/135.a7c3e822.js"><link rel="prefetch" href="/assets/js/136.2401894d.js"><link rel="prefetch" href="/assets/js/137.6b5d51b3.js"><link rel="prefetch" href="/assets/js/138.46e98d9d.js"><link rel="prefetch" href="/assets/js/139.080c5130.js"><link rel="prefetch" href="/assets/js/14.1f5e418e.js"><link rel="prefetch" href="/assets/js/140.d7deb0d2.js"><link rel="prefetch" href="/assets/js/141.21a0a960.js"><link rel="prefetch" href="/assets/js/142.fe31183f.js"><link rel="prefetch" href="/assets/js/143.8adbd910.js"><link rel="prefetch" href="/assets/js/144.2ad689e4.js"><link rel="prefetch" href="/assets/js/145.95a4a1d7.js"><link rel="prefetch" href="/assets/js/146.45bec800.js"><link rel="prefetch" href="/assets/js/147.93101868.js"><link rel="prefetch" href="/assets/js/148.b534d0a2.js"><link rel="prefetch" href="/assets/js/149.b1d993db.js"><link rel="prefetch" href="/assets/js/15.f2f6dc7a.js"><link rel="prefetch" href="/assets/js/150.e7147d10.js"><link rel="prefetch" href="/assets/js/151.4ef25d94.js"><link rel="prefetch" href="/assets/js/152.e5d9d094.js"><link rel="prefetch" href="/assets/js/153.6b6e0642.js"><link rel="prefetch" href="/assets/js/154.25250e56.js"><link rel="prefetch" href="/assets/js/155.34ae60ca.js"><link rel="prefetch" href="/assets/js/156.26b776db.js"><link rel="prefetch" href="/assets/js/157.ac214951.js"><link rel="prefetch" href="/assets/js/158.8160576b.js"><link rel="prefetch" href="/assets/js/159.87970e93.js"><link rel="prefetch" href="/assets/js/16.f38d5aa1.js"><link rel="prefetch" href="/assets/js/160.cb31f27b.js"><link rel="prefetch" href="/assets/js/161.63da7c1d.js"><link rel="prefetch" href="/assets/js/162.d6265c5a.js"><link rel="prefetch" href="/assets/js/163.00e98ea9.js"><link rel="prefetch" href="/assets/js/164.489d3ece.js"><link rel="prefetch" href="/assets/js/165.14a0ac69.js"><link rel="prefetch" href="/assets/js/17.47f92d25.js"><link rel="prefetch" href="/assets/js/18.939679b9.js"><link rel="prefetch" href="/assets/js/19.4b5e11ca.js"><link rel="prefetch" href="/assets/js/20.e4c5a5c1.js"><link rel="prefetch" href="/assets/js/21.886994a9.js"><link rel="prefetch" href="/assets/js/22.6848ca70.js"><link rel="prefetch" href="/assets/js/23.6685f31e.js"><link rel="prefetch" href="/assets/js/24.6ffcbee7.js"><link rel="prefetch" href="/assets/js/25.b468ab2a.js"><link rel="prefetch" href="/assets/js/26.ae4ec095.js"><link rel="prefetch" href="/assets/js/27.d68ba8c4.js"><link rel="prefetch" href="/assets/js/28.77526965.js"><link rel="prefetch" href="/assets/js/29.b51bc369.js"><link rel="prefetch" href="/assets/js/30.f34ad8ea.js"><link rel="prefetch" href="/assets/js/31.ea5d0968.js"><link rel="prefetch" href="/assets/js/32.266fe651.js"><link rel="prefetch" href="/assets/js/33.9f3a4b59.js"><link rel="prefetch" href="/assets/js/34.92302c41.js"><link rel="prefetch" href="/assets/js/35.258e2870.js"><link rel="prefetch" href="/assets/js/36.7b3f62cb.js"><link rel="prefetch" href="/assets/js/37.91e68fdc.js"><link rel="prefetch" href="/assets/js/38.35c7427c.js"><link rel="prefetch" href="/assets/js/39.565f94d6.js"><link rel="prefetch" href="/assets/js/4.ea3b0bd5.js"><link rel="prefetch" href="/assets/js/40.1df5e2f3.js"><link rel="prefetch" href="/assets/js/41.5b364c9b.js"><link rel="prefetch" href="/assets/js/42.bc29f49d.js"><link rel="prefetch" href="/assets/js/43.2c830543.js"><link rel="prefetch" href="/assets/js/44.db617450.js"><link rel="prefetch" href="/assets/js/45.6d82cbe7.js"><link rel="prefetch" href="/assets/js/46.f36ad277.js"><link rel="prefetch" href="/assets/js/47.11cd07e6.js"><link rel="prefetch" href="/assets/js/48.e03a4e77.js"><link rel="prefetch" href="/assets/js/49.b08b0835.js"><link rel="prefetch" href="/assets/js/5.97a7c0dc.js"><link rel="prefetch" href="/assets/js/50.c4648d27.js"><link rel="prefetch" href="/assets/js/51.e983cd13.js"><link rel="prefetch" href="/assets/js/52.16e738d5.js"><link rel="prefetch" href="/assets/js/53.bd8c1968.js"><link rel="prefetch" href="/assets/js/54.3e19ee76.js"><link rel="prefetch" href="/assets/js/55.b8ad26cd.js"><link rel="prefetch" href="/assets/js/56.311bfbe6.js"><link rel="prefetch" href="/assets/js/57.0f045ba5.js"><link rel="prefetch" href="/assets/js/58.239e8404.js"><link rel="prefetch" href="/assets/js/59.7b687abb.js"><link rel="prefetch" href="/assets/js/6.8e992509.js"><link rel="prefetch" href="/assets/js/60.4e343674.js"><link rel="prefetch" href="/assets/js/61.db6e32e6.js"><link rel="prefetch" href="/assets/js/62.fc3fc01f.js"><link rel="prefetch" href="/assets/js/63.fa9e1bd1.js"><link rel="prefetch" href="/assets/js/64.994d7527.js"><link rel="prefetch" href="/assets/js/65.267b048d.js"><link rel="prefetch" href="/assets/js/66.8c5f0b3d.js"><link rel="prefetch" href="/assets/js/67.74a9ded5.js"><link rel="prefetch" href="/assets/js/68.dd40f558.js"><link rel="prefetch" href="/assets/js/69.00fccbea.js"><link rel="prefetch" href="/assets/js/7.159745e4.js"><link rel="prefetch" href="/assets/js/70.ef8c338c.js"><link rel="prefetch" href="/assets/js/71.25a9bd58.js"><link rel="prefetch" href="/assets/js/72.0959ee8f.js"><link rel="prefetch" href="/assets/js/73.e154307b.js"><link rel="prefetch" href="/assets/js/74.76863de9.js"><link rel="prefetch" href="/assets/js/75.6978bd97.js"><link rel="prefetch" href="/assets/js/76.4a2f4182.js"><link rel="prefetch" href="/assets/js/77.0f06f3c0.js"><link rel="prefetch" href="/assets/js/78.66c253a1.js"><link rel="prefetch" href="/assets/js/79.6c37b127.js"><link rel="prefetch" href="/assets/js/8.eaef2fb9.js"><link rel="prefetch" href="/assets/js/80.2dda282c.js"><link rel="prefetch" href="/assets/js/81.cd9437e7.js"><link rel="prefetch" href="/assets/js/82.c5a84712.js"><link rel="prefetch" href="/assets/js/83.b8a2f734.js"><link rel="prefetch" href="/assets/js/84.ede1cd7a.js"><link rel="prefetch" href="/assets/js/85.e649a4e5.js"><link rel="prefetch" href="/assets/js/86.38274fa9.js"><link rel="prefetch" href="/assets/js/87.472635cc.js"><link rel="prefetch" href="/assets/js/88.cf02af57.js"><link rel="prefetch" href="/assets/js/89.03ef81d7.js"><link rel="prefetch" href="/assets/js/9.ee3f327d.js"><link rel="prefetch" href="/assets/js/90.4a497f88.js"><link rel="prefetch" href="/assets/js/91.7271b82b.js"><link rel="prefetch" href="/assets/js/92.cd04960f.js"><link rel="prefetch" href="/assets/js/93.342921b6.js"><link rel="prefetch" href="/assets/js/94.f5d3d498.js"><link rel="prefetch" href="/assets/js/95.940fefe6.js"><link rel="prefetch" href="/assets/js/96.fdbcc350.js"><link rel="prefetch" href="/assets/js/98.937f6a6d.js"><link rel="prefetch" href="/assets/js/99.bcd70353.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a3549ad8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Leibnize 个人学习笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Leibnize 个人学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><!----> <h3 class="name" data-v-ca798c94>
    Leibnize 个人学习笔记
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>0</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/Basics/" class="sidebar-heading clickable router-link-active open"><span>前端专题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/01-前端基础" class="sidebar-heading clickable"><span>01-前端基本</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/02-前端性能" class="sidebar-heading clickable"><span>02-前端性能</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/03-前端工程" class="sidebar-heading clickable"><span>03-前端工程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/04-前端异步" class="sidebar-heading clickable"><span>04-前端异步</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/05-前端设计" class="sidebar-heading clickable"><span>05-前端设计</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/06-前端数据" class="sidebar-heading clickable"><span>06-前端数据</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/07-前端安全" class="sidebar-heading clickable open"><span>07-前端安全</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Basics/07-前端安全/XSS.html" class="sidebar-link">一、XSS</a></li><li><a href="/Basics/07-前端安全/CSRF.html" class="active sidebar-link">二、CSRF</a></li><li><a href="/Basics/07-前端安全/劫持.html" class="sidebar-link">三、劫持</a></li><li><a href="/Basics/07-前端安全/其他安全问题.html" class="sidebar-link">四、其他安全问题</a></li><li><a href="/Basics/07-前端安全/Summary.html" class="sidebar-link">五、Summary</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/08-前端概念" class="sidebar-heading clickable"><span>08-前端概念</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/09-前端实现" class="sidebar-heading clickable"><span>09-前端实现</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/10-前端新标" class="sidebar-heading clickable"><span>10-前端新标</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/11-前端会话" class="sidebar-heading clickable"><span>11-前端会话</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/12-前端框架" class="sidebar-heading clickable"><span>12-前端框架</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/14-浏览器相关" class="sidebar-heading clickable"><span>14-浏览器相关</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/15-前端核心" class="sidebar-heading clickable"><span>15-前端核心</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Basics/16-前端Node" class="sidebar-heading clickable"><span>16-前端Node</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/NetWork/" class="sidebar-heading clickable"><span>网络专题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/NetWork/20-前端网络" class="sidebar-heading clickable open"><span>20-前端网络</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/NetWork/20-前端网络/base.html" class="sidebar-link">一、基本</a></li><li><a href="/NetWork/20-前端网络/ip.html" class="sidebar-link">二、IP</a></li><li><a href="/NetWork/20-前端网络/tcp.html" class="sidebar-link">三、TCP</a></li><li><a href="/NetWork/20-前端网络/dns.html" class="sidebar-link">四、DNS</a></li><li><a href="/NetWork/20-前端网络/http.html" class="sidebar-link">五、HTTP</a></li><li><a href="/NetWork/20-前端网络/websocket.html" class="sidebar-link">六、Websocket</a></li><li><a href="/NetWork/20-前端网络/Summary.html" class="sidebar-link">七、Summary</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/Algorithm/" class="sidebar-heading clickable"><span>算法专题</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Algorithm/30-前端算法" class="sidebar-heading clickable open"><span>30-前端算法</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Algorithm/30-前端算法/排序.html" class="sidebar-link">X、排序</a></li><li><a href="/Algorithm/30-前端算法/Summary.html" class="sidebar-link">X、Summary</a></li></ul></section></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Leibnize 个人学习笔记</span>
            
          <!---->
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>二、CSRF</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Leibnize 个人学习笔记</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="二、csrf"><a href="#二、csrf" class="header-anchor">#</a> 二、CSRF</h1> <h2 id="_2-1、定义"><a href="#_2-1、定义" class="header-anchor">#</a> 2-1、定义</h2> <p><strong><u>跨站点请求伪造 - Cross-Site Request Forgeries (或 One-click attack、Session riding)</u></strong>：指的是黑客诱导用户点击链接，打开黑客的网站，然后黑客利用用户 <strong><u>目前的登录状态</u></strong> 发起跨站请求；比如：攻击者诱导受害者进入第三方网站A，利用受害者在被攻击网站B已获取的注册凭证绕过后台用户验证，由此向被攻击网站B发起跨站请求，以达到冒充用户、对被攻击网站B执行非法操作的目的；(即黑客引诱用户打开黑客的网站，利用用户的登陆状态发起跨站请求);</p> <ul><li>注意：CSRF 并非均需 Cookie 才能发送攻击，某些无需认证的操作亦可实现；</li> <li>注意：CSRF 并非只能通过 Get 请求实现，还可通过 POST 请求实现(构造表单)；</li></ul> <img src="https://leibnize-picbed.oss-cn-shenzhen.aliyuncs.com/img/20200918162423.png" style="zoom:50%;"> <h2 id="_2-2、本质与案例"><a href="#_2-2、本质与案例" class="header-anchor">#</a> 2-2、本质与案例</h2> <p>本质是 HTTP 问题；案例如下：</p> <ul><li>示例：转账操作：A -&gt; Bank 转账、发起银行请求并得到 Bank 网派发的 cookie、A 访问 C 伪造的网站、C 利用 A 本地 cookie 并加以利用；</li> <li>示例：邮件窃取：A登录邮箱网 -&gt; 打开奇怪邮件中的链接，跳转到空白页面，然后 C 利用 A cookie 进行 A 邮箱的过滤器器配置，使得可将所有邮件发往 C；</li> <li>详看：https://juejin.im/post/5bc009996fb9a05d0a055192#heading-30</li> <li>详看：<a href="https://www.davidairey.com/google-gmail-security-hijack/" target="_blank" rel="noopener noreferrer">www.davidairey.com/google-Gmai…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>详看：<a href="https://github.com/YvetteLau/Blog/tree/master/Security" target="_blank" rel="noopener noreferrer">github.com/YvetteLau/B…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="_2-4、区别"><a href="#_2-4、区别" class="header-anchor">#</a> 2-4、区别</h2> <ul><li>XSS 需要注入恶意代码以实施攻击；
<ul><li>CSRF 无需将恶意代码注入用户页面，仅利用服务器漏洞和用户登录状态来实施攻击；</li></ul></li> <li>XSS 是获取信息，无需提前获知其他用户页面的代码和数据包；
<ul><li>CSRF 是代替用户完成指定的动作，需要获知其他用户页面的代码和数据包；</li></ul></li> <li>XSS 是用户过分相信网站、认为服务器返回内容总是正确、将攻击者的输入当代码执行；
<ul><li>CSRF 是网站过分相信用户、认为发起请求总是真实用户；</li></ul></li> <li>CSRF 攻击方式更加多样， 只要可以发起请求就能实施相应的攻击；</li> <li>CSRF 发生在第三方域名，而非被攻击网，被攻击网站无法阻止攻击这一行为的发生；</li> <li>CSRF 攻击成本比 XSS 低，因用户每天都要访问大量网页，且无法确认每一网页安全性；</li> <li>CSRF 是由 XSS 实现的，CSRF 也可称为 XSRF；但其本质，XSS 是代码注入问题，CSRF 是 HTTP 问题；</li> <li>CSRF 攻击利用受害者在被攻击网的登录凭证，冒充受害者提交操作；而非直接窃取数据，只是使用数据；</li> <li>CSRF 通常是跨域操作，因外域更容易被攻击者所控制，但若本域下有容易被利用的功能，比如可发图和链接的论坛，则可直接在本域进行且此类型更危险；</li> <li>CSRF 攻击并不需要将恶意代码注入用户当前页面的<code>html</code>文档中，而是跳转到新的页面，利用服务器的 <strong><u>验证漏洞</u></strong> 和 <strong><u>用户先前登录状态</u></strong> 来模拟用户进行操作；</li></ul> <h2 id="_2-5、分类"><a href="#_2-5、分类" class="header-anchor">#</a> 2-5、分类</h2> <p>受害者访问诱导页后可能会发生三种事：</p> <ul><li><p>GET 类型的 CSRF：自动发送 GET 请求，比如：</p> <ul><li><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://xxx.com/info?user=hhh&amp;count=100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>此时，请求会自动携带此网站的 Cookie 信息，若服务端无相应验证，就会允许操作；</p></li></ul></li> <li><p>POST 类型的 CSRF：自动发送 POST 请求，提交表单，比如：</p> <ul><li><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>hacker-form<span class="token punctuation">'</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://xxx.com/info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hhh<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'hacker-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li> <li><p>链接类型的 CSRF：诱导点击发送 GET 请求：</p> <ul><li><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://xxx/info?user=hhh&amp;count=100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">taget</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击进入修仙世界<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul></li></ul> <h2 id="_2-6、攻击方式"><a href="#_2-6、攻击方式" class="header-anchor">#</a> 2-6、攻击方式</h2> <ul><li>通过在黑客网站中，构造隐藏表单来自动发起 Post 请求；</li> <li>通过引诱链接诱惑用户点击触发请求，利用 a 标签的 href；</li> <li>通过 form 表单、img 图片加载、img的 src 属性来自动发起请求；</li> <li>通过ajax请求， 跨域调用可以加上 withCredentials，用于带上被攻击站点的 cookie</li></ul> <h2 id="_2-7、防御方式"><a href="#_2-7、防御方式" class="header-anchor">#</a> 2-7、防御方式</h2> <p>基本：服务端防止被攻击是不可能的，但可提升防护能力：</p> <p>因为 CSRF 通常从第三方网站发起，被攻击网站无法防止攻击发生，只能通过增强自己网站针对CSRF的防护能力来提升安全性；</p> <p>方式：根据 CSRF 特点制定防护策略：</p> <ul><li><p>CSRF 通常发生在第三方域名 ====&gt; 阻止不明外域的访问：同源检测、Samesite Cookie 等；</p></li> <li><p>CSRF 攻击者只是使用而不能获取到Cookie等信息 ====&gt; 提交时要求附加本域才能获取的信息：CSRF Token、双重Cookie验证；</p> <ul><li>注意：服务端应防止被黑客利用，成为攻击源头：
<ul><li>严格管理所有的上传接口，防止任何预期之外的上传内容 (比如 HTML)；</li> <li>添加 <code>Header X-Content-Type-Options: nosniff</code> 防止黑客上传 HTML 内容的资源(比如图片)被解析为网页；</li> <li>对于用户上传的图片，进行转存或校验，不直接使用用户填写的图片链接；</li> <li>当前用户打开其他用户填写的链接时需告知风险 (这也是很多论坛不允许直接在内容中发布外链的原因之一，不全是为用户留存度，更有安全考虑)；</li></ul></li> <li>注意：客户端应提升防护能力：
<ul><li>避免打开可疑链接，非要打开时，先清空本地记录和 cookie 信息或使用不常用的浏览器，比如IE；</li> <li>使用网页版浏览邮件或新闻也会带来额外风险，因查看邮件或者新闻消息有可能导致恶意代码攻击；</li></ul></li></ul></li></ul> <h3 id="_2-7-1、阻止不明外域访问"><a href="#_2-7-1、阻止不明外域访问" class="header-anchor">#</a> 2-7-1、阻止不明外域访问</h3> <p>即利用 CSRF 通常发生在第三方域名；</p> <h3 id="_2-7-1-1、同源检测"><a href="#_2-7-1-1、同源检测" class="header-anchor">#</a> 2-7-1-1、同源检测</h3> <p>原理：服务器通过解析<u>请求头字段</u> <strong><u>Origin</u></strong>、<strong><u>Referer</u></strong> 确定来源域，且字段在浏览器发起请求时自动携带(大多数情况)，前端无法自定义；</p> <p>作用：通过请求头字段的验证，可获悉发起请求的来源域名 (本域/子域名/有授权三方域/不可信未知域)，阻止无法确认来源域名或黑名单域名；</p> <p>缺点：两者均可伪造，通过 Ajax 中自定义请求头即可，安全性略差；</p> <ul><li>注意：当以页面请求而来源又是搜索引擎的链接，则亦会被当做 CSRF 攻击，故需判断并过滤；</li> <li>注意：此类页面请求就暴露在了 CSRF 的攻击范围中，比如：<code>GET https://example.com/addComment?comment=XXX&amp;dest=orderId；</code></li> <li>注意：CSRF 大多时候来自三方域名，但并不能排除本域发起，若攻击者有权限在本域发布评论(含链接、图片等统称UGC)，则其可直接在本域发起攻击，此时同源策略无法达到防护作用；</li></ul> <h3 id="_2-7-1-1-1、请求头-origin-字段"><a href="#_2-7-1-1-1、请求头-origin-字段" class="header-anchor">#</a> 2-7-1-1-1、请求头 Origin 字段</h3> <p>字段包含请求的域名；注意：若存在此字段，则进行域名判断；若不存在字段，则分2种情况处理：</p> <ul><li><p>IE11同源策略：</p> <ul><li>IE 11 不会在跨站 CORS 请求上添加 Origin 标头，Referer 头仍将是唯一标识，根本原因是 IE 11 对同源的定义与其他浏览器不同；</li> <li>详看：https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#IE_Exceptions</li></ul></li> <li><p>302 重定向：</p> <ul><li>302 重定向后的 Origin 不包含在重定向请求中，因 Origin 可能会被认为是其他来源的敏感信息；</li> <li>措施：302 重定向的情况，基本是重定向到新服务器上的URL，因此浏览器不想将 Origin 泄漏到新服务器上；</li></ul></li></ul> <h3 id="_2-7-1-1-2、请求头-referer-字段"><a href="#_2-7-1-1-2、请求头-referer-字段" class="header-anchor">#</a> 2-7-1-1-2、请求头 Referer 字段</h3> <p>字段记录请求来源地址 (URL)；</p> <ul><li>注意：对于 Ajax 请求/图片/script 等资源请求，Referer 为发起请求的页面地址；对于页面跳转，Referer 则为打开页面历史记录的前一页地址；</li> <li>问题A：浏览器对于 Referer 具体实现有所差别，无法保证浏览器自身无安全漏洞，且使用验证 Referer 方法，将安全性转为依赖于浏览器保障，此外某些情况下，攻击者可隐藏甚至修改请求 Referer；</li> <li>解决A：2014 年 W3C 发布 Referrer Policy 草案和规定，规定5种设置策略，如下图；</li></ul> <img src="https://i.loli.net/2020/09/06/BseNGqtAZcdYIyE.png" align="" style="zoom:50%;"> <img src="https://i.loli.net/2020/09/06/kLE9smfv5VuKtRb.png" align="" style="zoom:50%;"> <ul><li><p>使用：若想实现 Referer 字段确定域名的功能，则需配置 Referrer Policy 策略为 same-origin，此后对于同源链接和引用会发送 Referer，此时的 Referer 值为 Host 且不带 Path，而当跨域访问时则不会携带 Referer；</p> <ul><li>设置 Referrer Policy 方法：
<ul><li>方法1：在CSP设置</li> <li>方法2：页面头部增加 meta 标签</li> <li>方法3：a标签增加 referrerpolicy 属性</li></ul></li></ul></li></ul> <p>问题B：攻击者仍可控制攻击不携带 Referer，比如：</p> <div class="language-http extra-class"><pre class="language-http"><code>&lt;img src=&quot;http://bank.example/withdraw?amount=10000&amp;for=hacker&quot; referrer-policy=&quot;no-referrer&quot;&gt;
</code></pre></div><p>问题C：其他没有 Referer 情况甚至 Referer 不可信的情况；</p> <ul><li>IE6、7下使用 window.location.href=url 进行界面的跳转，会缺失 Referer；</li> <li>IE6、7下使用 window.open，也会缺失 Referer；</li> <li>HTTPS 页面跳转到 HTTP 页面，所有浏览器 Referer 都丢失；</li> <li>点击 Flash 上到达另外一个网站时，Referer 的情况则较杂乱，不太可信；</li></ul> <p>总结：同源验证是相对简单的防范方法，能够防范绝大多数的CSRF  攻击，但不适用于对于安全性要求较高，或有较多用户输入内容情况(问题多多)；</p> <h3 id="_2-7-1-2、samesite-cookie"><a href="#_2-7-1-2、samesite-cookie" class="header-anchor">#</a> 2-7-1-2、Samesite Cookie</h3> <p>原理：CSRF 攻击关键点在于自动发送目标站点下的 Cookie 信息，而恰恰是这个 Cookie 导致服务端误认为是用户本身，因此防范重点在于限制 Cookie 行为；服务端可通过在响应头字段 Set-Cookie 增加 <strong><u>Samesite</u></strong> 属性，以对请求时 Cookie 的自动携带行为作限制：</p> <ul><li><p>Strict 模式：严格模式，浏览器完全禁止第三方请求携带 Cookie，请求只能发起对本站当前域的请求；</p></li> <li><p>Lax 模式：宽松模式，只能在 <u>GET 方法提交表单</u>、或  <u>a 标签发送 GET 请求</u> 才可携带 Cookie；</p></li> <li><p>None 模式：默认模式，请求会自动携带 Cookie；</p></li> <li><p>使用：Strict 和 Lax</p> <ul><li><p>严格模式-Strict：</p> <ul><li><p>含义：表明此 Cookie 在任何情况下都不能作为三方 Cookie，绝无例外；</p></li> <li><p>比如：从百度搜索页面甚至天猫页面的链接点击进入淘宝后，淘宝都不会是登录状态，因为淘宝的服务器不会接受 foo cookie；</p></li> <li><p>比如：B站设置了如下 Cookie，当在A站下发起对B站请求时，Cookie foo 不会被包含在 Cookie 请求头中，但 bar 会；</p></li> <li><div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> foo=1; Samesite=Strict、Set-Cookie: bar=2; Samesite=Lax、Set-Cookie: baz=3；
</code></pre></div></li></ul></li> <li><p>宽松模式-Lax：</p> <ul><li><p>含义：允许当发送安全 HTTP 方法时携带 Cookie，比如 <code>Get</code> 、<code>OPTIONS</code> 、<code>HEAD</code> 请求，否则不能，比如： <code>POST</code>、 <code>PUT</code>、 <code>DELETE</code> ；</p></li> <li><p>比如：请求是GET请求，且请求(改变了当前页面或打开了新页面)，则此 Cookie 可作为三方 Cookie；</p></li> <li><p>比如：B站设置如下 Cookie，当A站点击链接进入B站时，Cookie foo 不会被包含在 Cookie 请求头中，但 bar 和 baz 会，即用户在不同网站之间通过链接跳转不受影响，因为 cookie 可利用；但若A站发起的对B站的异步请求，或通过表单 Post 提交的(不合条件请求)，则 bar 也不会发送；</p></li> <li><div class="language-http extra-class"><pre class="language-http"><code><span class="token header-name keyword">Set-Cookie:</span> foo=1; Samesite=Strict、Set-Cookie: bar=2; Samesite=Lax、Set-Cookie: baz=3；
</code></pre></div></li></ul></li></ul></li> <li><p>缺点：</p> <ul><li>宽松模式下，其他网站可通过页面跳转过来时可使用Cookie，但安全性降低；</li> <li>严格模式下，跳转子域名或新标签重新打开、刚登陆的网站，之前的 Cookie 都将不复存在，影响用户体验；</li> <li>无论何种模式，均不支持子域：比如：种在子域 topic.a.com下的 Cookie，并不能使用其主域下种植的 SamesiteCookie，当网站有多个子域名时，不能使用 SamesiteCookie 在主域名存储用户登录信息；</li></ul></li> <li><p>总结：可替代同源验证的方案，但目前尚未成熟，其应用场景有待观望；</p></li></ul> <h3 id="_2-7-2、请求要求附加本域信息"><a href="#_2-7-2、请求要求附加本域信息" class="header-anchor">#</a> 2-7-2、请求要求附加本域信息</h3> <p>即利用 CSRF 攻击者只是使用而不能获取到  Cookie 等信息；</p> <h3 id="_2-7-2-1、csrf-token-主流"><a href="#_2-7-2-1、csrf-token-主流" class="header-anchor">#</a> 2-7-2-1、CSRF Token(主流)</h3> <p>原理：CSRF 攻击者无法直接窃取用户信息 (Cookie/Header/网站内容..)，而 CSRF 攻击之所以能成功，是因服务器误将攻击者发送请求当成用户的请求，综合此两点，可要求所有用户请求时均需携带 CSRF 攻击者无法获取到的 Token，服务器通过校验请求是否携带合法 Token，来区分正常与攻击请求，从而实现 CSRF 攻击防御 (与验证码机制、再次输入密码类似，均可极好遏制 CSRF，只是此处的 Token 方式用户无感知，后者则适用安全性要求严格的场景)；比如：浏览器向服务器发送请求时，服务器生成一个字符串，将其植入到返回的页面中；然后浏览器如果要发送请求，就必须带上这个字符串，然后服务器来验证是否合法，若不合法则不予响应，此字符串也就是 <strong><u>CSRF Token</u></strong>，通常第三方站点无法拿到此 Token，因此也就是被服务器给拒绝；</p> <p>作用：较之前的同源检测 (Referer 检查或 Origin 验证)安全；</p> <ul><li><p>使用(简明)：</p> <ul><li>服务端给用户生成一个 token，加密后返回给用户；</li> <li>用户在发送请求时，均需携带此 token；</li> <li>服务端验证 token 是否正确，正确则返回相应信息；</li></ul></li> <li><p>使用(详细)：</p> <ul><li><p>首先，将 CSRF Token 输出到页面中；</p> <ul><li>注意：用户打开页面时，服务器为其生成通过加密算法加密的 Token，然后将 Token 保存在 Session 中，并在页面所有 a 和 form 标签中加入；</li> <li>注意：上述方法适用于服务器返回前端展示的静态页面，若页面加载后动态生成的 HTML，则需前端手动加入 Token；</li></ul></li> <li><p>然后，页面发送请求携带这个Token；</p> <ul><li>注意：对于 GET 请求，Token 附在请求地址后，比如：<code>http://url?csrftoken=tokenvalue</code></li> <li>注意：对于 POST 请求，则在 form 上加入，比如：<code>&lt;input type=&quot;hidden&quot; name=&quot;csrftoken&quot; value=&quot;tokenvalue&quot;/&gt;</code></li></ul></li> <li><p>最后，服务器验证 Token  是否正确；</p> <ul><li>注意：判断过程需先解密，然后对比加密字符串和时间戳，校验通过即可；</li> <li>注意：若在请求中找不到 Token，或提供值与会话中值不匹配，则应 中止请求，并重置 Token、并将事件记录为正在进行的潜在CSRF攻击；</li></ul></li></ul></li> <li><p>问题1-1：大型网站中使用 Session 存储 CSRF Token 给服务器带来负担，且 Session 机制会在分布式环境下失效；</p></li> <li><p>解决1-1：分布式集群， 在 Redis 存储 CSRF Token；</p></li> <li><p>问题1-2：使用 Session 存储、读取和验证 CSRF Token 会产生较大的复杂度和性能问题；</p></li> <li><p>解决1-2：采用 Encrypted Token Pattern 方式，此方式中的 Token 是一计算结果(使用 UserID、时间戳、随机数加密生成)，而非随机字符串，故校验时无需再去读取存储 Token，只需再次计算即可，保证分布式服务下 Token 一致性，又保证不易被破解；计算通过后，再去校验时间戳并做其他校验处理；</p></li> <li><p>总结：只要页面没有 XSS 漏洞，泄露 Token，则接口的 CSRF 攻击就无法成功；缺点是实现较复杂，后端需给每个页面写入 Token，或前端每个Form/Ajax 请求都携带 Token，而后端则需对每一个接口都进行校验，并保证页面 Token 及请求 Token 一致；工作量较大(鸡蛋里挑骨头)；</p></li></ul> <h3 id="_2-7-2-2、双重-cookie-主流加强"><a href="#_2-7-2-2、双重-cookie-主流加强" class="header-anchor">#</a> 2-7-2-2、双重 Cookie(主流加强)</h3> <p>原理：利用 CSRF 攻击不能获取用户数据特点，可要求 Ajax 和表单请求携带一个 Cookie 中的值；</p> <p>作用：较 CSRF Token 简单方便，可直接通过前后端拦截方式自动化实现，后端校验方便，只需进行请求中字段的对比，无需再进行查询和存储Token；</p> <p>使用：</p> <ul><li>首先，在用户访问网站页面时，(服务端) 向请求域名注入 Cookie，内容为随机字符串(比如 <code>csrfcookie=v8g9e4ksfhw</code>)；</li> <li>然后，在前端向后端发起请求时，取出(上述) Cookie，并添加到 URL 参数中 (接上例 <code>POST https://www.a.com/comment?csrfcookie=v8g9e4ksfhw</code>)；</li> <li>最后，后端接口验证 Cookie 中的字段与URL参数中的字段是否一致，不一致则拒绝；</li></ul> <p>问题：</p> <ul><li>安全性不高：在大型网站上的安全性不如 CSRF Token 高，不适合大规模应用；</li> <li>跨域访问失效：若用户访问网站为 <code>www.a.com</code>，而后端的 api 域名为 <code>api.a.com</code>，则在<code>www.a.com</code>下，前端拿不到 <code>api.a.com</code> 的Cookie(无法跨域获取)，也即无法完成双重 Cookie 认证；除非认证 Cookie 必须被种在 <code>a.com</code> 下，如此实现访问；</li> <li>XSS 漏洞失效：某个子域名存在漏洞被 XSS 攻击，攻击者则可修改主域 a.com下的Cookie (比如延长过期时间)或使用自己配置的 cookie 进行攻击；</li></ul> <p>优点：</p> <ul><li>无需使用 Session，适用面更广、易于实施；</li> <li>Token 储存于客户端中，不会给服务器带来压力；</li> <li>相对于 CSRF Token，实施成本更低，可在前后端统一拦截校验，而不需要一个个接口和页面添加；</li></ul> <p>缺点：</p> <ul><li>Cookie 中增加了额外的字段；</li> <li>若有其他漏洞(比如 XSS)，攻击者可以注入 Cookie，那么该防御方式失效；</li> <li>难以做到子域名的隔离；</li> <li>为了确保 Cookie 传输安全，采用这种防御方式的最好确保用整站 HTTPS 的方式，如果还没切 HTTPS 的使用这种方式也会有风险；</li></ul> <h3 id="_2-7-2-3、anti-csrf-token"><a href="#_2-7-2-3、anti-csrf-token" class="header-anchor">#</a> 2-7-2-3、Anti CSRF Token</h3> <ul><li>优势：防御 CSRF 公认最合适方案、token 存放用户页面表单和 Session/Cookie 中，提交请求时，服务端验证两者是否一致；</li> <li>注意：确保 Token 的 URL 保密性、尽可能地使用 Post 请求 ;</li> <li>注意：可考虑生成多个有效 Token，避免多页共存场景；</li></ul> <h3 id="_2-7-2-4、短信验证、双重验证"><a href="#_2-7-2-4、短信验证、双重验证" class="header-anchor">#</a> 2-7-2-4、短信验证、双重验证</h3> <h3 id="_2-7-3、其他防御方式"><a href="#_2-7-3、其他防御方式" class="header-anchor">#</a> 2-7-3、其他防御方式</h3> <h3 id="_2-7-3-1、csrf-监控"><a href="#_2-7-3-1、csrf-监控" class="header-anchor">#</a> 2-7-3-1、CSRF 监控</h3> <img src="https://i.loli.net/2020/09/06/WkMfBnl2wFQ6u3P.png" align="" style="zoom:50%;"> <h3 id="_2-7-3-2、随机值法"><a href="#_2-7-3-2、随机值法" class="header-anchor">#</a> 2-7-3-2、随机值法</h3> <img src="https://i.loli.net/2020/09/07/AQWRcnzsCE47DxB.png" align="" style="zoom:50%;"> <h2 id="_2-8、检查漏洞"><a href="#_2-8、检查漏洞" class="header-anchor">#</a> 2-8、检查漏洞</h2> <ul><li>是否有验证码；</li> <li>是否判断 Referer；</li> <li>目标表单是否带有 Token 验证；</li> <li>Allow-access 相关参数设置是否有漏洞；</li> <li>目标 jsonp 数据是否可以自定义 callback；</li> <li>CSRF Tester</li></ul> <img src="https://i.loli.net/2020/09/06/qp3yEzljvQYHhdD.png" align="" style="zoom:50%;"> <h2 id="_2-9、总结"><a href="#_2-9、总结" class="header-anchor">#</a> 2-9、总结</h2> <ul><li>CSRF自动防御策略：同源检测 (Origin 和 Referer 验证)(请求头易伪造)；</li> <li>CSRF主动防御措施：Token 验证 或者 双重 Cookie 验证 以及配合 Samesite Cookie(兼容性)；</li> <li>保证页面的幂等性，后端接口不要在 GET 页面中做用户操作；</li></ul></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/24/2020, 7:55:12 AM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.f95d0077.js" defer></script><script src="/assets/js/3.49babee5.js" defer></script><script src="/assets/js/1.269e4bda.js" defer></script><script src="/assets/js/97.73aba549.js" defer></script>
  </body>
</html>

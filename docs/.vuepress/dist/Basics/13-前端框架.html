<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、总结 | Leibnize 个人学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="整理自网络">
    <link rel="preload" href="/docs/assets/css/0.styles.2f643d57.css" as="style"><link rel="preload" href="/docs/assets/js/app.cda475f7.js" as="script"><link rel="preload" href="/docs/assets/js/2.c902c426.js" as="script"><link rel="preload" href="/docs/assets/js/57.cd784d78.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.418fecbd.js"><link rel="prefetch" href="/docs/assets/js/11.e2c998bf.js"><link rel="prefetch" href="/docs/assets/js/12.b627468b.js"><link rel="prefetch" href="/docs/assets/js/13.682b9b92.js"><link rel="prefetch" href="/docs/assets/js/14.0880e743.js"><link rel="prefetch" href="/docs/assets/js/15.4a6c4027.js"><link rel="prefetch" href="/docs/assets/js/16.200e0299.js"><link rel="prefetch" href="/docs/assets/js/17.1c6394bc.js"><link rel="prefetch" href="/docs/assets/js/18.c0560a2b.js"><link rel="prefetch" href="/docs/assets/js/19.f63607cc.js"><link rel="prefetch" href="/docs/assets/js/20.d56d802e.js"><link rel="prefetch" href="/docs/assets/js/21.52c3ae8e.js"><link rel="prefetch" href="/docs/assets/js/22.b47add39.js"><link rel="prefetch" href="/docs/assets/js/23.a8a40e53.js"><link rel="prefetch" href="/docs/assets/js/24.a0e2af55.js"><link rel="prefetch" href="/docs/assets/js/25.1fb24116.js"><link rel="prefetch" href="/docs/assets/js/26.068130b1.js"><link rel="prefetch" href="/docs/assets/js/27.6cb72d75.js"><link rel="prefetch" href="/docs/assets/js/28.d99e5701.js"><link rel="prefetch" href="/docs/assets/js/29.4848d9ba.js"><link rel="prefetch" href="/docs/assets/js/3.be11a00a.js"><link rel="prefetch" href="/docs/assets/js/30.92ed4a03.js"><link rel="prefetch" href="/docs/assets/js/31.de402b39.js"><link rel="prefetch" href="/docs/assets/js/32.b5ca6564.js"><link rel="prefetch" href="/docs/assets/js/33.c3d91abd.js"><link rel="prefetch" href="/docs/assets/js/34.b868c98b.js"><link rel="prefetch" href="/docs/assets/js/35.4128bd9f.js"><link rel="prefetch" href="/docs/assets/js/36.8e4b22b8.js"><link rel="prefetch" href="/docs/assets/js/37.090897e6.js"><link rel="prefetch" href="/docs/assets/js/38.f8d5752b.js"><link rel="prefetch" href="/docs/assets/js/39.f949333a.js"><link rel="prefetch" href="/docs/assets/js/4.64176cb5.js"><link rel="prefetch" href="/docs/assets/js/40.39833f40.js"><link rel="prefetch" href="/docs/assets/js/41.a12c7b96.js"><link rel="prefetch" href="/docs/assets/js/42.a5e6d9e8.js"><link rel="prefetch" href="/docs/assets/js/43.28874788.js"><link rel="prefetch" href="/docs/assets/js/44.8d4042e3.js"><link rel="prefetch" href="/docs/assets/js/45.b148e845.js"><link rel="prefetch" href="/docs/assets/js/46.91062fd6.js"><link rel="prefetch" href="/docs/assets/js/47.2026c6cc.js"><link rel="prefetch" href="/docs/assets/js/48.b0f3d68f.js"><link rel="prefetch" href="/docs/assets/js/49.9d81175e.js"><link rel="prefetch" href="/docs/assets/js/5.1d876c62.js"><link rel="prefetch" href="/docs/assets/js/50.1a00f734.js"><link rel="prefetch" href="/docs/assets/js/51.b16e53d7.js"><link rel="prefetch" href="/docs/assets/js/52.831b9cca.js"><link rel="prefetch" href="/docs/assets/js/53.4ce4ac34.js"><link rel="prefetch" href="/docs/assets/js/54.6d7ca762.js"><link rel="prefetch" href="/docs/assets/js/55.2bb32bbd.js"><link rel="prefetch" href="/docs/assets/js/56.388173c5.js"><link rel="prefetch" href="/docs/assets/js/58.d994c1a9.js"><link rel="prefetch" href="/docs/assets/js/59.0665a00b.js"><link rel="prefetch" href="/docs/assets/js/6.bc091efc.js"><link rel="prefetch" href="/docs/assets/js/60.12f3479d.js"><link rel="prefetch" href="/docs/assets/js/61.679d1273.js"><link rel="prefetch" href="/docs/assets/js/62.04ef0d26.js"><link rel="prefetch" href="/docs/assets/js/63.70e8cd2b.js"><link rel="prefetch" href="/docs/assets/js/64.c7956833.js"><link rel="prefetch" href="/docs/assets/js/65.0304095c.js"><link rel="prefetch" href="/docs/assets/js/66.f16304a7.js"><link rel="prefetch" href="/docs/assets/js/67.d0a945f4.js"><link rel="prefetch" href="/docs/assets/js/68.26e1c58d.js"><link rel="prefetch" href="/docs/assets/js/69.ac162984.js"><link rel="prefetch" href="/docs/assets/js/7.255d7d5f.js"><link rel="prefetch" href="/docs/assets/js/70.5408bf05.js"><link rel="prefetch" href="/docs/assets/js/8.2117996a.js"><link rel="prefetch" href="/docs/assets/js/9.e855c324.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.2f643d57.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Leibnize 个人学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span></span> <span class="arrow down"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、总结"><a href="#一、总结" class="header-anchor">#</a> 一、总结</h2> <h3 id="_1-1、实现原理"><a href="#_1-1、实现原理" class="header-anchor">#</a> 1-1、实现原理</h3> <h4 id="_1-1-1、vue-实现原理-流程"><a href="#_1-1-1、vue-实现原理-流程" class="header-anchor">#</a> 1-1-1、Vue 实现原理/流程</h4> <img src="/Image/Frame/Vue/502.png" style="zoom:50%;"> <p>注意：此处描述的是 Vue 2.x 的运行机制 (并注意分析的是 Runtime + Compiler)</p> <p>补充：<strong><u><em>完整版</em></u></strong> = 运行时版 + Compiler (将字符串模板 template 编译为 render 函数)；若在运行时处理 template 则需要 compiler 编译，但 compiler 非必需，可通过在脚手架配置 vue-loader 插件辅助编译，不自带 Compiler 而将编译交给构建工具的即为 <strong><u><em>运行时版</em></u></strong>；</p> <ul><li>entry-runtime 没有包含 compiler，最后直接输出 Vue 实例，将其交由构建工具的编译器即可；使用运行时版，配置 vue-loader 便可实现，若使用 template 特性，又可在打包时减少 30% 的项目体积；</li> <li>entry-runtime-with-compiler 包含 compiler，挂载前需要做编译处理，所以其重写了 Vue.prototype.$mount 方法，并添加了 Vue.compile 全局API；使用完整版，允许在代码运行的时现场编译模板，在不配合构建工具的情况下可直接使用；</li> <li><u>意即：运行时版需要构建工具配合，但打包体积小；完整版无需构建工具配合，但打包体积大；</u></li></ul> <p><strong><u><em>初始化流程</em></u></strong>：</p> <ul><li>创建 Vue 实例对象</li> <li><code>init</code> 过程初始化生命周期、事件中心和渲染、执行 <code>beforeCreate</code> 周期函数、初始化 <code>data</code>、<code>props</code>、<code>computed</code>、<code>watcher</code>、执行 <code>created</code> 周期函数等
<ul><li>注意：此处的初始化阶段，并无详细描述数据的响应式过程，此流程见下方描述：</li> <li>注意：初始化阶段为 Vue 原型添加属性和方法，即实例属性和实例方法，并添加全局的API，也就是静态的方法和属性：
<ul><li>初始化原型链属性 sateMixin：<code>$data(只读属性)、$props(只读属性)、$set、$delete、$watch</code>；</li> <li>初始化原型链方法(事件) eventsMixin：<code>$on、$once、$off、$emit</code>；</li> <li>初始化原型链方法(生命周期) lifecycleMixin：<code>_update、$forceUpdate、$destory</code>；</li> <li>初始化(渲染函数) renderMixin：<code>installRenderHelpers、_render、nextTick</code>；</li> <li>在 Vue 构造函数上添加全局 API，类似整理 Vue.prototype 上的属性和方法：
<ul><li>比如：get(只读)、util(独立、非公共API)、set、util、set、delete、nextTick、options；</li> <li>比如：Vue.use Vue.component、Vue.directive、Vue.filter、Vue.mixin、Vue.extend；</li></ul></li> <li>并设置平台化的 Vue.config；
<ul><li>Vue.options：混合2个指令(directives)：model、show；</li> <li>Vue.options：混合2个组件(components)：Transition、TransitionGroup；</li> <li>Vue.prototype：2个方法：<code>__patch__</code>、$mount；</li></ul></li></ul></li></ul></li> <li>初始化后，调用 <code>$mount</code> 方法对 Vue 实例进行挂载(挂载的核心过程包括：<strong><u>模板编译、渲染、更新</u></strong>  三个过程)；</li> <li>注意：若无在 Vue 实例上定义 <code>render</code> 方法而定义了 <code>template</code>，则需要经历编译阶段：先将 <code>template字符串</code> 编译成 <code>render function</code>；编译步骤如下 ：
<ul><li>首先，<code>parse</code>正则解析 <code>template</code> 字符串形成 AST(抽象语法树，源代码的抽象语法结构的树状表现形式)</li> <li>然后，<code>optimize</code> 标记静态节点跳过 Diff 算法 (Diff 算法是逐层进行比对，只有同层级的节点进行比对，因此时间的复杂度只有 O(n)；</li> <li>最后，<code>generate</code> 将 AST 转化成 <code>render function</code> 字符串；</li></ul></li> <li>然后，编译成 <code>render function</code> 后，调用 <code>$mount</code> 的 <code>mountComponent</code>方法，先执行 <code>beforeMount</code> 钩子函数，然后核心是实例化一个 <code>渲染Watcher</code>，在它的回调函数(初始化时执行，及组件实例中监测到数据发生变化时执行)中调用 <code>updateComponent</code> 方法(此法调用 <code>render</code> 方法生成 <code>虚拟Node</code>，最终调用 <code>update</code> 方法更新 DOM，见下方)；</li> <li>调用 <code>render</code> 方法将 <code>render function</code> 渲染成 <code>虚拟Node</code> ，<code>render</code> 方法的第一个参数是 <code>createElement</code> (或说是 <code>h</code> 函数)；
<ul><li>注意：真实 DOM 元素非常庞大，因浏览器的标准就把 DOM 设计的非常复杂；倘若频繁做 DOM 更新，会产生一定的性能问题，而 <code>虚拟DOM</code> 就是用一原生 JS 对象去描述 DOM 节点，所以它比创建一个 DOM 的代价要小很多，而且修改属性也很轻松，并能实现跨平台兼容；</li></ul></li> <li>然后，生成 <code>虚拟DOM树</code> 后，需要将 <code>虚拟DOM树</code> 转化成 <code>真实DOM节点</code>，此时需要调用 <code>update</code> 方法，<code>update</code>方法又会调用 <code>pacth</code> 方法将 <code>虚拟DOM</code> 转换成 真正DOM 节点；(注意上图忽略了新建真实 DOM 的情况—若无旧的虚拟 Node，则可直接通过 <code>createElm</code> 创建真实 DOM 节点)，而此处重点分析在已有虚拟 Node 的情况下，会通过 <code>sameVnode</code> 判断当前需要更新的 Node节点，是否与旧的 Node 节点相同(比如若设置的 <code>key</code> 属性发生了变化，则节点显然不同—所以 key 作用在于节点的最大化复用)，若节点不同则利用新节点替换旧节点，若相同且存在子节点，则需调用 <code>patchVNode</code> 方法执行 Diff 算法更新 DOM，从而提升 DOM 操作的性能；</li></ul> <p><strong><u><em>响应式流程</em></u></strong>：</p> <ul><li><p>在 <code>Init</code> 初始化过程中会利用  <code>Object.defineProperty</code> 方法(不兼容 IE8)，以监听 Vue 实例的响应式数据的变化从而实现数据劫持能力 (利用了 JS 对象的访问器属性 <code>Get/Set</code>，而在 Vue3 中则使用了 ES6 的 <code>Proxy</code> 来优化响应式原理)；然后在初始化流程中的编译阶段，当 <code>render function</code> 被渲染时，会读取Vue 实例中和视图相关的响应式数据，此时便会触发 <code>getter</code>  函数进行 <strong><u>依赖收集</u></strong> (将观察者 <code>Watcher</code> 对象存放到当前闭包的订阅者 <code>Dep</code> 的 <code>subs</code> 中)，此时的数据劫持功能和观察者模式就实现了一个 MVVM 模式中的  <strong><u>Binder</u></strong>，之后就是正常的渲染和更新流程；</p></li> <li><p>然后，当数据发生变化或视图导致的数据发生了变化时，会触发数据劫持的 <code>setter</code> 函数，<code>setter</code> 会通知初始化 <strong><u>依赖收集</u></strong> 中的 <code>Dep</code> 中的与视图相应的<code>Watcher</code>，告知需要重新渲染视图，<code>Wather</code> 就会再次通过 <code>update</code> 方法来更新视图；</p></li> <li><p>注意：可发现只要视图中添加监听事件(Get/Set+处理函数)，自动变更对应的数据变化时，就可实现数据和视图的双向绑定；</p></li></ul> <h3 id="_1-2、数据绑定-更新机制"><a href="#_1-2、数据绑定-更新机制" class="header-anchor">#</a> 1-2、数据绑定/更新机制</h3> <h4 id="_1-2-1、vue-数据绑定机制"><a href="#_1-2-1、vue-数据绑定机制" class="header-anchor">#</a> 1-2-1、Vue 数据绑定机制</h4> <p><strong><u><em>一句话总结</em></u></strong>：Vue 采用数据劫持+发布订阅模式，通过 Object.defineproperty 劫持各个属性的 Set/Get，在数据变动时发布消息给订阅者，触发响应的监听回调；</p> <p><strong><u><em>双向数据绑定</em></u></strong>：指数据变化更新视图，视图变化更新数据；比如：</p> <ul><li>View =&gt; Data：输入框内容变化时，Data 数据同步变化；</li> <li>Data =&gt; View：Data 数据变化时，文本节点内容同步变化；</li></ul> <p><strong><u><em>Vue2.x 响应式数据原理</em></u></strong></p> <p>Vue 在初始化数据时，会使用 Object.defineProperty 重新定义 data 中的所有属性，当页面使用对应属性时，首先会进行依赖收集(收集当前组件
的 watcher )，如果属性发生变化，就会通知相关依赖进行更新操作(发布订阅)；</p> <ul><li><p>Object. property 方法使用：</p> <ul><li>object. property(参数1, 参数2, 参数3)；
<ul><li>参数1为该对象(obj)</li> <li>参数2为要定义或修改的对象的属性名</li> <li>参数3为属性描述符(对象，主要有两种形式：数据描述符和存取描述符)；</li></ul></li> <li>返回值：直接在一个对象上定义一个新属性或者修改对象上的现有属性，并返回该对象 obj；</li></ul></li> <li><p>Object.defineProperty 优势如下：</p> <ul><li>兼容性好，支持IE9，而 Proxy 的存在浏览器兼容性问题，且无法用 polfill 磨平；</li></ul></li> <li><p>Object.defineProperty 问题有三：</p> <ul><li>不能监听数组的变化；</li> <li>必须遍历对象的每个属性；</li> <li>必须深层遍历嵌套的对象；</li></ul></li></ul> <p><strong><u><em>Vue3.x 响应式数据原理</em></u></strong>
用 Proxy 替代 Object. defineProperty；因 Proxy 可直接监听对象和数组变化，并有多达13种拦截方法，作为新标准还受到浏览器厂商重点持续的性能优化；</p> <ul><li>注意：Proxy 只会代理对象第一层，但 Vue3 通过判断当前 Reflect. get 返回值是否为 Object，是则再通过 reactive 方法做代理，实现深度观测；</li> <li>注意：监测数组时可能触发多次 Get/Set，Vue3 通过判断 key 是否为当前被代理对象 target 自身属性，或判断旧值与新值是否相等，来执行 trigger；</li> <li>Proxy 在 ES2015 规范中被正式加入，特点如下：
<ul><li>可直接监听对象而非属性，针对整个对象，而非对象某个属性，无需对 keys 进行遍历；</li> <li>可直接监听数组的变化，无需像 Object.defineProperty 对数组的方法进行重载，省去了众多 hack，减少代码量，减少了维护成本；</li> <li>有多达13种拦截方法，不限于apply、 ownKeys、 deleteProperty、 has 等等，而这是 Object.defineProperty 所不具备的；</li> <li>返回的是一个新对象,我们可以只操作新的对象达到目的,而Object.defineProperty只能遍历对象属性直接修改；</li> <li>作为新标准受到浏览器厂商重点关注和性能优化；</li></ul></li></ul> <p><strong><u><em>Vue2 双绑实现要点：</em></u></strong></p> <ul><li>监听器 Observer：
<ul><li>对数据对象进行遍历，包括子属性对象的属性，利用 Object.defineProperty 对属性都加上 Get/Set，用于依赖收集和派发更新；</li></ul></li> <li>解析器 Compile：
<ul><li>解析 Vue 模板指令，将模板中的变量都替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添
加监听数据的订阅者，一旦数据有变动，收到通知，调用更新函数进行数据更新；</li></ul></li> <li>订阅者 Watcher：
<ul><li>Watcher 是前两者间的通信桥梁，主要负责：订阅 Observer 中的属性值变化消息，当收到属性值变化消息时，触发解析器 Compile 中对应的更新函数；实际上 Watcher 实例分为渲染 watcher (render watcher)、计算属性 watcher (computed watcher)、侦听器 watcher (user watcher)三种；</li></ul></li> <li>订阅器 Dep：
<ul><li>订阅器采用发布-订阅设计模式，用来收集订阅者 Watcher，以对监听器 Observer 和订阅者 Watcher 进行统一管理(每个响应式对象包括子对象，都拥有一个 Dep 实例(里面的 subs 是存放 Watcher 实例的数组)，当数据有变更时，会通过 dep.notify 通知各个 watcher)；</li> <li>上述两者关系：Watcher 中实例化了 dep 并向 dep.subs 中添加了订阅者 watcher，而 dep 通过 notify 遍历了 dep.subs 通知每个 watcher 更新；</li></ul></li></ul> <img src="/Image/Frame/Vue/500.png" style="zoom:50%;"> <img src="/Image/Frame/Vue/501.png" style="zoom:50%;"> <p><strong><u><em>依赖收集过程</em></u></strong>：</p> <ol><li>initState 时，对 computed 属性初始化时触发 computed watcher 依赖收集；</li> <li>initState 时，对侦听属性初始化时，触发user watcher 依赖收集；</li> <li>render 过程，触发render watcher 依赖收集；</li> <li>re-render 时，vm.render 再次执行，会移除所有 subs 中的 watcer 的订阅，重新赋值；</li></ol> <p><strong><u><em>触发更新</em></u></strong>：</p> <ol><li>组件中对响应的数据进行了修改，触发 setter 逻辑；</li> <li>调用 dep.notify，遍历所有的 subs (Watcher 实例)，最后调用每一个 watcher 的 update 方法；</li></ol> <p><strong><u><em>响应原理</em></u></strong>：
创建 Vue 实例时，Vue 会遍历 data 选项的属性，并利用 Object.defineProperty 为属性添加 Set/Get，以对数据读写进行监听 (Get 用来依赖收集，Setter
用来派发更新)，并且在内部追踪依赖，在属性被访问和修改时通知变化；
然后，每个组件实例会有相应的 watcher 实例，其会在组件渲染的过程中，记录依赖的所有数据属性(进行依赖收集还有 computed watcher,user watcher实例) ,之后依赖项被改动时，setter 方法会通知依赖与此 data 的 watcher 实例重新计算(派发更新)，从而使它关联的组件重新渲染；</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myapp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token punctuation">{</span>
    message<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> models <span class="token operator">=</span> myapp<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot; [v-mode l=message]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> models<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    models<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onkeyup</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      model<span class="token punctuation">[</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;v-model&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 观察者模式/钩子函数</span>
  <span class="token comment">// defineProperty 来定义一个对象的某个属性</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> binds <span class="token operator">=</span> myapp<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot; [v-bind=message]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> binds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        binds<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> models <span class="token operator">=</span> myapp<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot; [v-mode l=message]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> models<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        models<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_1-2-2、vue-数组与对象监听"><a href="#_1-2-2、vue-数组与对象监听" class="header-anchor">#</a> 1-2-2、Vue 数组与对象监听</h4> <p>Vue 通过遍历数组/对象(若数组/对象中包含着引用类型， 则会对其中的引用类型再次递归遍历)，从而实现对数组和对象内部属性数据进行监听；</p> <p>而对于数组的操作监听则通过劫持方式，重写数组方法：push、pop、shift、unshift、splice、sort、reverse；</p> <p>Vue 将 data 中的数组进行了原型链重写，使其指向自定义的数组原型方法；此后当调用上述数组方法时，便可通知依赖更新；</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> arrayProto <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> arrayMethods <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>arrayProto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;push&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;pop&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;shift&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;unshift&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;splice&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;sort&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;reverse&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/**
* Intercept mutating methods and emit events
*/</span>
methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// cache original method</span>
  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ob<span class="token punctuation">;</span>
    <span class="token keyword">let</span> inserted<span class="token punctuation">;</span>
    <span class="token keyword">switch</span>
    <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&quot;push&quot;</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">&quot;unshift&quot;</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">;</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&quot;splice&quot;</span><span class="token operator">:</span>
        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// notify change</span>
    ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
* Observe a list of Array item
*/</span>
Observer<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">observeArray</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">observeArray</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token comment">// Observe a list of Array items.</span>
<span class="token function">observeArray</span><span class="token punctuation">(</span>items<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>l <span class="token operator">=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// observe 功能为监测数据的变化</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对属性进行递归遍历</span>
<span class="token keyword">let</span> child0b <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// observe 功能为监测数据的变化</span>

<span class="token comment">// ...</span>
</code></pre></div><ul><li><p>注意：由于 JS 限制，Vue 不能检测到以下数组的变动：</p> <ul><li><p>当利用索引直接设置一个数组项时，比如：<code>vm. items[indexOfItem] = newValue</code></p></li> <li><p>当修改数组长度时，比如：<code>vm.items.length = newLength</code></p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 为解决第一个问题，Vue 提供了以下操作方法:</span>
<span class="token comment">// Vue. set</span>
Vue<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> index0fItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token comment">// vm. $set, Vue.setá)- ↑5I5</span>
vm<span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>items<span class="token punctuation">,</span> index0fItem<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
<span class="token comment">// Array. prototype.splice</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>indexOfItem<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>

<span class="token comment">//为解决第二个问题，Vue 提供了以下操作方法:</span>
<span class="token comment">// Array. prototype. splice</span>
vm<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>newlength<span class="token punctuation">)</span>
</code></pre></div></li></ul></li> <li><p>注意：之所以数组长度没有 Set/Get，是因为：如果知道数组长度，理论上可以预先给所有的索引设置 Set/Get，但实际场景中往往并不知道数组长度(且很多时候是不固定的)，且若是大数组，预先加 Set/Get 成本过大；可通过 Proxy 改进；</p></li></ul> <h4 id="_1-2-3、vue-set-vue-set-vm-set-实现原理"><a href="#_1-2-3、vue-set-vue-set-vm-set-实现原理" class="header-anchor">#</a> 1-2-3、<u>Vue.$set</u> (Vue.set == vm.$set 实现原理)</h4> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">|</span> Object<span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
  <span class="token comment">// 若 target 为数组</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改数组的长度，避免索引&gt;数组长度导致 splcie 执行有误</span>
    target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token comment">// 利用数组的 splice 变异方法触发响应式</span>
    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// 若 key 已存在，则直接修改属性值</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> object<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> va1
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__ob__
  <span class="token comment">// 若 target 非响应式数据，则直接赋值</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
    <span class="token keyword">return</span> val
  <span class="token punctuation">}</span>
  <span class="token comment">// 对属性进行响应式处理</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> val
<span class="token punctuation">}</span>
</code></pre></div><ol><li>若目标是数组，使用 vue 实现的数组重载方法 splice 实现响应式；</li> <li>若目标是对象，判断属性存在，若存在即为响应式，直接赋值；</li> <li>若 target 本身就不是响应式，则直接赋值；</li> <li>若属性非响应式，则调用 defineReactive 方法进行响应式处理；</li></ol> <h4 id="_1-2-4、vue-v-model-原理"><a href="#_1-2-4、vue-v-model-原理" class="header-anchor">#</a> 1-2-4、Vue v-model 原理</h4> <p>v-model 指令在表单 input、textarea、 select 等元素上创建双向数据绑定，v-model 本质是一个语法糖，可看成是 value + input 方法的语法糖；可通过 model 属性的 prop 和 event 属性来进行自定义；原生的 v-model，会根据标签的不同生成不同的事件和属性；</p> <ul><li>text、textarea元素使用 value 属性和 input 事件；</li> <li>checkbox、radio使用 checked 属性和 change 事件；</li> <li>select 字段将 value 作为 prop 并将 change 作为事件；</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>// 1、表单元素 input
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">*v-model*</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span> something<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
// 相当于
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">*v-bind:</span>*</span> <span class="token attr-name">*va*</span> <span class="token attr-name">*lue*</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>something<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">*v-on:</span>*</span> <span class="token attr-name">*input*</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>something = $event. target.value<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

// 2、自定义组件，v-model 默认会利用名为 value 的 prop 和 input 事件
// 父组件:
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>*ModelChild*</span> <span class="token attr-name">*v-mode*</span> <span class="token attr-name">*l*</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>*ModelChild*</span><span class="token punctuation">&gt;</span></span>
// 子组件:
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{value}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
props:{
	value: *String*
}
methods: {
	test1(){
	this. $emit('input', 'TLP')
},
</code></pre></div><h4 id="_1-2-x、angular-变更检测机制"><a href="#_1-2-x、angular-变更检测机制" class="header-anchor">#</a> 1-2-X、Angular 变更检测机制</h4> <p>通过 zone 触发检测机制，并通过深度优先遍历组件，与存储旧值比对实现更新，详看另一章的&quot;前端框架&quot;一文</p> <h4 id="_1-2-z、vue-angular-对比"><a href="#_1-2-z、vue-angular-对比" class="header-anchor">#</a> 1-2-Z、Vue &amp; Angular 对比</h4> <p>前者核心利用 Object.defineProperty 触发变化通知，然后 DOM Diff 负责值判断和视图刷新；</p> <p>后者利用 Zone 对异步事件进行劫持，捕获变化通知，触发变更检测，深度优先遍历，利用组件视图中存储的旧值进行比对，然后更新视图；</p> <h3 id="_1-3、生命周期"><a href="#_1-3、生命周期" class="header-anchor">#</a> 1-3、生命周期</h3> <h4 id="_1-3-1、vue-生命周期"><a href="#_1-3-1、vue-生命周期" class="header-anchor">#</a> 1-3-1、Vue 生命周期</h4> <p>Vue 实例有一个完整的生命周期，也即从开始创建、初始化数据、编译模版、挂载DOM-&gt;渲染、更新-&gt;渲染、卸载等一系列过程，称之为 Vue 的生命周期；</p> <p>vue 生命周期总共分为8个阶段：创建前/后，载入前/后， 更新前/后，销毁前/后：</p> <ul><li>创建前/后：
<ul><li>beforeCreate：vue 实例的挂载元素 <code>$el</code> 和数据对象 data 都是 undefined，尚未初始化；</li> <li>created：完成 data 数据初始化，但 <code>$el</code> 还未初始化；</li></ul></li> <li>载入前/后：
<ul><li>beforeMount：vue 实例的 <code>$el</code> 和 data 均已初始化，相关 render 函数首次被调用；实例已完成以下配置：编译模板，将 data里的数据和模板生成html；但注意此时还未挂载 html 到页面上；</li> <li>mounted：<code>el</code> 被新创建的 <code>vm.$el</code> 替换，并挂载到实例上后调用；实例已完成以下配置：用上面编译好的 html 内容替换 <code>el</code> 属性指向的 DOM 对象；完成将模板中的 html 渲染到 html 页面；此过程中进行 ajax 交互；</li></ul></li> <li>更新前/后：
<ul><li>beforeUpdate：在数据更新前调用，发生在虚拟 DOM 重新渲染和打补丁前；可在此钩子中进一步地更改状态，且不会触发额外的重渲染过程；</li> <li>updated：在由于数据更改导致的虚拟 DOM 重新渲染和打补丁后调用；调用时，组件 DOM 已更新，故可执行依赖于 DOM 的操作；但注意：大多数情况下，应避免在此期间更改状态，因可能会导致更新无限循环(使用 this.$nextTick 缓解)；该钩子在服务器端渲染期间不被调用；</li></ul></li> <li>销毁前/后：
<ul><li>beforeDestroy：在实例销毁前调用；实例仍然完全可用；</li> <li>destroyed：在实例销毁后调用；调用后所有的事件监听器会被移除，所有子实例也会被销毁；该钩子在服务器端渲染期间不被调用；</li></ul></li></ul> <table><thead><tr><th>生命周期</th> <th>描述</th></tr></thead> <tbody><tr><td>beforeCreate</td> <td>组件实例被创建之初，组件的属性生效前</td></tr> <tr><td>Reated</td> <td>组件实例已经完全创建，属性也绑定，但真实dom还没有生成，<code>$el</code> 还不可用</td></tr> <tr><td>beforeMount</td> <td>在挂载开始之前被调用：相关的 render 函数首次被调用</td></tr> <tr><td>mounted</td> <td>el 被新创建的 vm.$el 替换，并挂载到实例上，之后调用该钩子</td></tr> <tr><td>beforeUpdate</td> <td>组件数据更新之前调用，发生在虚拟 DOM 打补丁前</td></tr> <tr><td>update</td> <td>组件数据更新之后</td></tr> <tr><td>activited</td> <td>keep-alive 专属，组件被激活时调用</td></tr> <tr><td>deactivated</td> <td>keep-alive 专属，组件被销毁时调用</td></tr> <tr><td>beforeDestory</td> <td>组件销毁前调用</td></tr> <tr><td>destoryed</td> <td>组件销毁后调用</td></tr></tbody></table> <img src="/Image/Frame/Vue/503.png" style="zoom:50%;"> <ul><li>注意：发起异步请求和操作DOM时机
<ul><li><u>异步请求</u>：可在钩子函数 created、beforeMount、 mounted 中进行调用，这三个钩子中，data 已经创建，可将服务端端返回的数据进行赋值；而在 created 钩子中调用异步请求还有以下优点：
<ul><li>更快获取到服务端数据，减少页面 loading 时间；</li> <li>ssr不支持 beforeMount、mounted 钩子函数，放在 created 有助于确保一致性；</li></ul></li> <li><u>操作DOM</u>：在钩子函数 mounted 被调用前，Vue 已将编译好的模板挂载到页面上，故在 mounted 中即可访问操作 DOM；</li></ul></li></ul> <h4 id="_1-3-1、vue-父子组件生命周期执行顺序"><a href="#_1-3-1、vue-父子组件生命周期执行顺序" class="header-anchor">#</a> 1-3-1、Vue 父子组件生命周期执行顺序</h4> <p>Vue 父组件和子组件生命周期钩子函数执行顺序可为以下 4 部分：</p> <ul><li>加载渲染过程：父beforeCreate -&gt;父created -&gt;父beforeMount -&gt;子beforeCreate -&gt;子created -&gt;子beforeMount -&gt;子mounted -&gt;父mounted；</li> <li>子组件更新过程：父beforeUpdate -&gt;子beforeUpdate -&gt;子updated -&gt;父updated；</li> <li>父组件更新过程：父beforeUpdate -&gt;父updated；</li> <li>销毁过程：父beforeDestroy -&gt;子beforeDestroy -&gt;子destroyed -&gt;父destroyed</li></ul> <p>总结即：组件的调用顺序都是：先父后子，渲染完成顺序则是：先子后父；</p> <p>总结即：组件销毁顺序是：先父后子，销毁完成顺序是：先子后父；</p> <ul><li><p>注意：父组件监听子组件生命钩子调用方式：</p></li> <li><div class="language-html extra-class"><pre class="language-html"><code>// 方式1: 通过 $emit 触发父组件事件
// Parent.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">@mounted</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doSomething<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
// Child. vue
mounted() {
	this.$emit(&quot;mounted”); 
}

             
// 方式2: 在父组件引用子组件时, 通过 @hook 监听
// Parent. vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">@hook</span> <span class="token attr-name">:mounted</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>doSomething<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Child</span><span class="token punctuation">&gt;</span></span>
doSomething() {
	// ... B
}
// Child. vue
mounted(){
	// ... A
},
// 以上输出顺序为: A -&gt; B
// @hook 方法不仅可监听 mounted, 还可监听其它生命周期事件，比如 created, updated 等
</code></pre></div></li></ul> <h4 id="_1-3-x、angular-生命周期"><a href="#_1-3-x、angular-生命周期" class="header-anchor">#</a> 1-3-X、Angular 生命周期</h4> <ul><li><p><strong><u><em>constructor</em></u></strong>：是 ES6 中 class 中新增的属性，当 class 类实例化的时候调用 constructor，来初始化类；</p> <ul><li>Angular 组件的构造函数会在所有的生命周期钩子之前被调用，它主要用于依赖注入或执行简单的数据初始化操作；</li></ul></li> <li><p><strong><u><em>ngOnChanges</em></u></strong>：当数据绑定输入属性值发生变化时调用；首次调用一定会发生在 ngOnInit() 前(随后 ngOnInit 不调用(只调1次)，OnChanges 则继续调用)；</p> <ul><li>Angular 将会主动调用 ngOnChanges 方法；它会获得一个 SimpleChanges 对象，包含绑定属性的新值和旧值，它主要用于监测组件输入属性的变化；当 Angular(重新)设置数据绑定输入属性时响应；该方法接受当前和上一属性值的 SimpleChanges 对象；</li></ul></li> <li><p><strong><u><em>ngOnInit</em></u></strong>：在第一次 ngOnChanges 执行之后调用，且只被调用一次；主要用于执行组件的其它初始化操作或获取组件输入的属性值；</p> <ul><li>适用于在构造函数之后马上执行复杂的初始化逻辑、或在 Angular 设置完输入属性后，对该组件进行准备；</li></ul></li> <li><p>ngDoCheck：当组件的输入属性发生变化时，将会触发 ngDoCheck 方法；在每个 Angular 变更检测周期中调用；</p> <ul><li>多用于自定义检测逻辑，用于检测和处理值的改变；</li></ul></li> <li><p>ngAfterContentInit：在组件内容初始化之后调用；</p> <ul><li>当在组件使用 ng-content 指令的情况下，Angular 会在将外部内容放到视图后用；</li> <li>主要用于获取通过 @ContentChild 或 @ContentChildren 属性装饰器查询的内容视图元素；</li> <li>当把内容投影进组件之后调用。第一次ngDoCheck()之后调用，只调用一次；</li></ul></li> <li><p>ngAfterContentChecked：组件每次检查内容时调用；</p> <ul><li>在组件使用 ng-content 指令的情况下，Angular 会在检测到外部内容的绑定或者每次变化的时候调用；每次完成被投影组件内容的变更检测之后调用。ngAfterContentInit() 和每次 ngDoCheck() 后调用；</li></ul></li> <li><p>ngAfterViewInit：组件相应的视图初始化后调用；</p> <ul><li>主要用于获取通过 @ViewChild 或 @ViewChildren 属性装饰器查询的视图元素；</li> <li>初始化完组件视图及其子视图后调用；第一次ngAfterContentChecked()之后调用，只调用一次；</li> <li>与 AfterContent 相似，区别如下：
<ul><li>前者关心的是 ViewChildren，这些子组件的元素标签会出现在该组件的模板里面；</li> <li>后者关心的是 ContentChildren，这些子组件被Angular投影进该组件中；</li></ul></li></ul></li> <li><p>ngAfterViewChecked：组件每次检查视图时调用；</p> <ul><li>即每次做完组件视图和子视图的变更检测之后调用；ngAfterViewInit() 和每次 ngAfterContentChecked 后调用；</li></ul></li> <li><p><strong><u><em>ngOnDestroy</em></u></strong> - 指令销毁前调用；</p> <ul><li>主要用于执行一些清理操作，比如：移除事件监听、清除定时器、退订 Observable 等，以防内存泄漏</li></ul></li></ul> <h3 id="_1-4、组件通信方式"><a href="#_1-4、组件通信方式" class="header-anchor">#</a> 1-4、组件通信方式</h3> <h4 id="_1-4-1、vue-组件间通信方式"><a href="#_1-4-1、vue-组件间通信方式" class="header-anchor">#</a> 1-4-1、Vue 组件间通信方式</h4> <p>Vue组件间通信只要指以下3类通信：父子组件通信、隔代组件通信、兄弟组件通信；</p> <p><strong><u><em>父子组件通信</em></u></strong>：</p> <ul><li><p>父—&gt;子 <code>props</code>；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父子单向传值 data</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>date<span class="token operator">=</span><span class="token string">&quot;date&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      date<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 子组件接收传值 prop</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    date<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token comment">//校验类型</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>子—&gt;父一 <code>$on、$emit</code></p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用1</span>
<span class="token comment">// 子组件</span>
<span class="token comment">// 通过触自身的方法来触发 $emit 方法, 再触发父组件的方法, 通过回调传参的方式将修改的内容传递给父组件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeNum&quot;</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    date<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;changeNum&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 父组件</span>
<span class="token comment">// 接受回调params参数，即爸爸需要给儿子绑定了一个自定义的事件，$on(&quot;changeNum&quot;,params)</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>date<span class="token operator">=</span><span class="token string">&quot;date&quot;</span> @changeNum<span class="token operator">=</span><span class="token string">&quot;changeNum&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      date<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changeNum</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>date <span class="token operator">=</span> params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>



<span class="token comment">// 使用2 .sync</span>
<span class="token comment">// 子组件通过$emit(&quot;update:xxx&quot;)发射事件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeNum&quot;</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    date<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;update:date&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 父组件通过:xxx.sync=&quot;xxx&quot;接受参数</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>date<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>date<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">&quot;date&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      date<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>date<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">&quot;date&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
<span class="token comment">//这个写法是上面的替代品 默认组件内部触发 update:count 规定写法</span>
<span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>date<span class="token operator">=</span><span class="token string">&quot;date&quot;</span> @update<span class="token operator">:</span>date<span class="token operator">=</span><span class="token string">&quot;val=&gt;date=val&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>



<span class="token comment">// 使用3 v-model</span>
<span class="token comment">// 注意: v-model 局限只能传递一个属性 如果只有一个 可以使用v-model 多个依然需要使用.sync</span>
<span class="token comment">// 子组件触发的事件只能是input事件,接收props的属性名只能叫value</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;changeNum&quot;</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">changeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 父组件通过v-model接收参数</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Son1 <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span> @input<span class="token operator">=</span><span class="token string">&quot;val=&gt;value=val&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
<span class="token comment">//这个写法是上面的替代品 默认组件内部触发 input 规定写法</span>
<span class="token operator">&lt;</span>Son1 v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>

</code></pre></div></li> <li><p>获取父子组件实例 <code>$parent、 $children</code>、<code>ref &amp; $parent/$children</code></p> <ul><li><p><code>ref</code> 获取实例的方式调用组件的属性或方法；若在普通 DOM 元素上使用，引用指向即 DOM 元素；若在子组件上，引用则指向组件实例；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父级</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 ref<span class="token operator">=</span><span class="token string">&quot;son&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>son<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// 子级</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p><code>$parent | $children</code>：访问父/子实例；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 孙子想要给爷爷传递数据,孙子需要找到爷爷身上的事件去传递$parent.$emit</span>
<span class="token comment">// 孙级</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>孙子<span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;$parent.$emit('change',3)&quot;</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 子级</span>
<span class="token comment">// 儿子组件使用孙子组件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>grandson1 <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>grandson1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> grandson1 <span class="token keyword">from</span> <span class="token string">&quot;./grandson1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    grandson1<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 父级</span>
<span class="token comment">// 爸爸身上给孙子自定义change事件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 @change<span class="token operator">=</span><span class="token string">&quot;val=&gt;value=val&quot;</span> <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 注意: 如果层级很深那么就会出现$parent.$parent.....我们可以封装一个$dispatch方法向上进行派发</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">$dispatch</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 注意: 相同的道理，如果既然能够向上寻找父亲，就能向下寻找儿子，也可以封装一个向下派发的方法$broadcast</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$broadcast</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">$broadcast</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">broadcast</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      child<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>$children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">broadcast</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li></ul> <p><strong><u><em>兄弟组件通信</em></u></strong>：</p> <ul><li><p><code>EventBus</code> 实现跨组件通信 <code>Vue.prototype.$bus = new Vue</code> ；</p> <ul><li><p>通过一空 Vue 实例作为中央事件总线(事件中心)，用它来触发事件和监听事件，从而实现任何组件间通信，包括父子、隔代、兄弟组件；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发布者</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>孙子<span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// 订阅者</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li></ul></li></ul> <p><strong><u><em>跨级组件通信</em></u></strong>：</p> <ul><li><p><code>Vuex</code>；</p></li> <li><p><code>$attrs、$listeners</code>；</p> <ul><li><p><code>$attrs</code> ：包含父作用域中不被 prop 所识别且获取的特性绑定(class 和style除外)；</p> <ul><li><p><code>$attrs</code>批量向下传入属性；</p></li> <li><p>若一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定( class和style除外)，并可通过 <code>v-bind=&quot;$attrs&quot;</code> 传入内部组件；</p></li> <li><p>通常配合 inheritAttrs 选项一起使用；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父级</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 @change<span class="token operator">=</span><span class="token string">&quot;val=&gt;value=val&quot;</span> <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 子级</span>
<span class="token comment">// 在儿子组件中使用 $attrs 属性, 配合 v-bind 可将属性继续向下传递</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>$attrs<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>grandson1 v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$attrs&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>grandson1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> grandson1 <span class="token keyword">from</span> <span class="token string">&quot;./grandson1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    grandson1<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 注意：在使用 $attrs 时，如果组件中使用了 props 就会将属性从当前 attrs 移除掉</span>
<span class="token comment">// 在孙子组件中使用 $attrs属性,可以将属性继续向下传递</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>孙子<span class="token punctuation">{</span><span class="token punctuation">{</span>$attrs<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">//props: {</span>
  <span class="token comment">//  value: Number,</span>
  <span class="token comment">//},</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 如果爸爸传递给儿子元素, 儿子有三个属性用不到， 孙子传递给孙子，但是不想在页面上这个属性，可以设置inheritAttrs: false</span>
</code></pre></div></li></ul></li> <li><p><code>$listeners</code> ：包含父作用域中的 v-on 事件监听器(不含.native 修饰器)；它可通过 <code>v-on=&quot;$listeners&quot;</code> 传入内部组件；</p> <ul><li><p><code>$listeners</code>批量向下传入方法</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父级</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>爸爸<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Son1 @click<span class="token operator">=</span><span class="token string">&quot;change&quot;</span> <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Son1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span> Son1 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 子级</span>
<span class="token comment">// 可在 son1 组件中使用 $listeners 属性, 配合 v-on 可将方法继续向下传递</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>儿子<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>$attrs<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>grandson1 v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$attrs&quot;</span> v<span class="token operator">-</span>on<span class="token operator">=</span><span class="token string">&quot;$listeners&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>grandson1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> grandson1 <span class="token keyword">from</span> <span class="token string">&quot;./grandson1&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    grandson1<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 孙级</span>
<span class="token comment">// 孙子组件可以直接使用 $listeners 上的方法</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>孙子<span class="token punctuation">{</span><span class="token punctuation">{</span>$attrs<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;$listeners.click&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li></ul></li></ul></li> <li><p><code>Provide、inject；</code></p> <ul><li><p>祖先组件中通过 provider 来提供变量，然后在子孙组件中通过 inject 注入变量；</p></li> <li><p>provide / inject API 主要解决跨级组件间通信问题，但其使用场景，主要是子组件获取上级组件状态，此模式建立了一种主动提供&amp;依赖注入关系；</p></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父级声明</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> vm<span class="token operator">:</span> <span class="token keyword">this</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 子级注入</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>孙子<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vm&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></li></ul></li></ul> <p><strong><u><em>其他方式</em></u></strong>：</p> <ul><li>Pub / Sub</li> <li>Element UI dispatch / broadcast</li> <li>Observable</li> <li>Vue-rx</li></ul> <h5 id="_1-4-1、事件绑定与-on-off-emit-once"><a href="#_1-4-1、事件绑定与-on-off-emit-once" class="header-anchor">#</a> 1-4-1、事件绑定与 on/off/emit/once</h5> <p>原生事件绑定是通过 addEventListener 绑定给真实元素，组件事件绑定是通过 Vue自定义的 <code>$on</code> 实现；手写 <code>$on,$off,$emit,$once</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 事件通道调度中心</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">$on</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">$once</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    on<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> on<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">$off</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>events <span class="token operator">=</span>
        object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> cbs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> cb<span class="token punctuation">;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> cbs<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      cb <span class="token operator">=</span> cbs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cb <span class="token operator">===</span> fn <span class="token operator">||</span> cb<span class="token punctuation">.</span>fn <span class="token operator">===</span> fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cbs<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">$emit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cbs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cbs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      cbs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        args <span class="token operator">?</span> <span class="token function">item</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">item</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_1-4-2、vuex"><a href="#_1-4-2、vuex" class="header-anchor">#</a> 1-4-2、Vuex</h5> <img src="/Image/Frame/Vue/504.png" style="zoom:50%;"> <p>Vuex 是一个专为 Vue 应用开发的状态管理库；也可以说 Vuex 就是一放了很多对象的仓库；其中 state 就是数据源存放地，对应于一般 vue 对象里面的 data，state 中存放的数据是响应式的，vue 组件从 store 读取数据，若 store 中的数据发生改变，依赖这相数据的组件也会发生更新；</p> <ul><li><p>可通过 mapState 将全局 state 和 getters 映射到当前组件的 computed 计算属性中；</p></li> <li><p>改变 store 中状态的唯一途径：显式地提交(commit) mutation，如此可方便地跟踪每一个状态的变化；</p></li> <li><p>State：定义应用状态的数据结构，可在这里设置默认的初始状态；</p> <ul><li>注意：Vuex 使用单一状态树，即每个应用仅包含一个 store 实例，但单一状态树与模块化并不冲突；存放的数据状态，不可直接修改其中的数据；</li></ul></li> <li><p>Getter：允许组件从 Store 中获取数据，类似 vue 计算属性，主用来过滤数据；</p> <ul><li>注意 mapGetters 辅助函数仅将 store 中的 getter 映射到局部计算属性；</li></ul></li> <li><p>Mutation：是唯一能更改 store 中数据状态的方法，且必须是同步函数；</p></li> <li><p>Action：可理解为：通过将 mutations 中，处里数据的方法变成可异步的处理数据的方法，即异步操作数据；view 层通过 store.dispath 来分发 action；</p></li> <li><p>Module:允许将单- -的 Store拆分为多个store且同时保存在单一的状态树中 。</p></li></ul> <p>Vuex 一般用于中大型 web 单页应用中对应用的状态进行管理，对于某些组件间关系较为简单的小型应用，使用 Vuex 必要性不是很大，因为完全可以用组件 prop 属性或事件来完成父子组件间的通信，Vuex 更多地用于解决跨组件通信以及作为数据中心集中式存储数据；</p> <ul><li>使用 Vuex 解决非父子组件间通信问题：Vuex 是通过将 state 作为数据中心、各个组件共享 state 实现跨组件通信，此时的数据完全独立于组件，因此将组件间共享的数据置于 State中，能有效解决多层级组件嵌套的跨组件通信问题；</li> <li>Vuex 作为数据存储中心：Vuex 的 State 在单页应用的开发中本身具有一个&quot;数据库&quot;的作用，可将组件中用到的数据存储在 State 中，并在 Action 中封装数据读写的逻辑；通常个主要有两种数据会使用 Vuex 进行管理：
<ul><li>组件间全局共享的数据；</li> <li>通过后端异步请求的数据；比如：加入购物车、登录状态等都可以使用 Vuex 来管理数据状态；</li></ul></li></ul> <p>Vuex 项目中注意的问题：</p> <ul><li>开发时，改变数组或对象的数据，但是页面没有更新如何解决？</li> <li>vue 弹窗后如何禁止滚动条滚动?</li> <li>如何在 vue 项目里正确地引用 jquery 和 jquery-ui 插件?</li></ul> <h4 id="_1-4-2、angular-组件通信方式"><a href="#_1-4-2、angular-组件通信方式" class="header-anchor">#</a> 1-4-2、Angular 组件通信方式</h4> <img src="/Image/Frame/Angular/24.png" align="" style="zoom:50%;"> <p>通过输入型绑定把数据从父组件传到子组件 - @Input</p> <ul><li>通过 setter 截听输入属性值的变化</li> <li>通过 ngOnChanges() 来截听输入属性值的变化</li></ul> <p>父组件监听子组件的事件 - @Output</p> <p>父组件与子组件通过本地变量互动；</p> <p>父组件调用@ViewChild()</p> <p>父组件和子组件通过服务来通讯</p> <p><strong><u><em>方式1+2：Input、Output：</em></u></strong></p> <ul><li>被 @Input 修饰的 ParentData 为输入属性，被 @Output 修饰的为输出属性，输入输出相对于当前组件角度，输出属性一般通过事件形式，将数据通过 EventEmitter 发射出去；</li> <li>而对于输入属性，有两种操作可实现数据的拦截：setter、ngOnChanges，以可二次处理，确保可控；</li></ul> <img src="/Image/Frame/Angular/25.png" align="" style="zoom:50%;"> <p>拦截方式1：set，set &amp; get 须成对出现：</p> <img src="/Image/Frame/Angular/26.png" align="" style="zoom:50%;"> <p>拦截方式2：ngOnChanges 是组件生命周期之一，发生在 ngOninit 之前，输入值(指通过@Input 装饰器显式指定的变量)，发生变化时会触发，可用于检测数据前后变化，但有性能问题，不推荐使用；</p> <img src="/Image/Frame/Angular/27.png" align="" style="zoom:50%;"> <img src="/Image/Frame/Angular/28.png" align="" style="zoom:50%;"> <img src="/Image/Frame/Angular/29.png" align="" style="zoom:50%;"> <p><strong><u><em>方式3+4：通过变量“映射” &amp; ViewChild</em></u></strong></p> <ul><li>父组件不能使用数据绑定来读取子组件的属性或调用子组件的方法；</li> <li>但可在父组件模板里，新建本地变量来代表子组件，然后利用这个变量来读取子组件的属性和调用子组件的方法，比如下面的 son 变量；</li> <li>缺点：通过变量连接的行为，须在父组件的模板中进行，父组件本身代码，无法访问子组件；</li></ul> <img src="/Image/Frame/Angular/30.png" align="" style="zoom:50%;"> <p>改进：若想实现父组件类访问子组件方法和属性，须使用 @ViewChild 装饰器，将子组件作为 ViewChild，注入父组件中；</p> <p>导入对装饰器 <a href="https://angular.cn/api/core/ViewChild" target="_blank" rel="noopener noreferrer">ViewChild<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 、导入生命周期钩子 <a href="https://angular.cn/api/core/AfterViewInit" target="_blank" rel="noopener noreferrer">AfterViewInit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 引用、通过 @<a href="https://angular.cn/api/core/ViewChild" target="_blank" rel="noopener noreferrer">ViewChild<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 属性装饰器，将子组件注入到私有属性中；</p> <p>使用 ngAfterViewInit 的目的是将更新主动延迟一轮，因 Ng 单向数据流规则会阻止在同一个周期内更新父组件视图 (AfterViewInit 再更新就太晚了)</p> <img src="/Image/Frame/Angular/31.png" align="" style="zoom:50%;"> <p><strong><u><em>方式5：通过服务跨组件通讯 (实际上能作为第三方的均可实现：存储、Rxjs等)；</em></u></strong></p> <img src="/Image/Frame/Angular/32.png" align="" style="zoom:50%;"> <h3 id="_1-5、虚拟-dom-与-diff"><a href="#_1-5、虚拟-dom-与-diff" class="header-anchor">#</a> 1-5、虚拟 DOM 与 Diff</h3> <h4 id="_1-5-1、虚拟dom"><a href="#_1-5-1、虚拟dom" class="header-anchor">#</a> 1-5-1、虚拟DOM</h4> <p>优点：</p> <ul><li>保证性能下限：虚拟DOM 需要适配任何上层 API 可能产生的操作，其一些 DOM 操作的实现必须是普适的，所以性能并非最优；但与真实 DOM 操作性能相比仍要好得多；虛拟DOM 可以保证在无需手动优化的情况下，依然可以提供不错性能，即保证性能下限; .</li> <li>无需手动操作DOM：无需手动操作DOM，只需要写好 View-Model 代码逻辑，框架会根据虚拟 DOM &amp; 数据双向绑定，辅助更新视图，极大提高开发效率;</li> <li>跨平台：真实 DOM 与平台强相关，而虚拟 DOM 本质上是 JS 对象，可进行更方便地跨平台操作；</li></ul> <p>缺点:</p> <ul><li>无法进行极致优化：虽虚拟DOM +合理优化，足以应对绝大部分应用的性能需求，但在某些性能要求极高的应用，虚拟DOM无法进行针对性的极致优化；</li></ul> <p>原理：</p> <ul><li>用 JS 对象模拟真实 DOM树，对真实DOM进行抽象；</li> <li>用 Diff 算法比较两棵虚拟DOM树间的差异；</li> <li>用 pach 算法将两个虚拟 DOM 对象的差异，应用到真正的DOM树；</li></ul> <p>示例：</p> <ul><li>Vue2 的 Virtual DOM 借鉴了开源库 snabbdom 的实现；</li> <li>Vue2 的 VirtualDOM 映射到真实DOM 要经历 VNode 的 create、diff 、patch等阶段；</li></ul> <h4 id="_1-5-2、diff"><a href="#_1-5-2、diff" class="header-anchor">#</a> 1-5-2、Diff</h4> <h5 id="_1-5-1、diff-过程"><a href="#_1-5-1、diff-过程" class="header-anchor">#</a> 1-5-1、Diff 过程</h5> <p>正常 Diff 两个树的时间复杂度是 O(n^3)， 但实际情况中很少会进行跨层级的 DOM 移动，所以 Vue 将传统 Diff 过程进行了优化，使其时间复杂度从O(n^3) 降至 O(n)，只有当新旧 children 都为多个子节点时，才需要用核心的 Diff 算法进行同层级比较；</p> <p>Vue2 核心Diff算法采用双端比较的算法：同时从新旧 children 的两端开始进行比较，并借助 key 值找到可复用节点，再进行相关操作；</p> <p>Vue3.x 借鉴了 ivi 算法和 inferno 算法：在创建 VNode 时就确定其类型，以及在 mount/patch 过程中采用位运算，来判断 VNode 类型，在此基础之上再配合核心的 Diff 算法，使其性能较 Vue2.x 有进一步提升；该算法中还运用了动态规划的思想求解最长递归子序列；</p> <p>Vue2 Diff 实现主要通过两个方法：patchVnode 与 updateChildren：</p> <ul><li>patchVnode：有两个参数：老节点oldVnode,新节点vnode；主要分五种情况：
<ul><li>if (oldVnode === vnode)，引用一致，则可认为无变化；</li> <li>if(oldVnode.text !== null &amp;&amp; vnode.text !== null &amp;&amp; oldVnode.text !== vnode.text)，文本节点比较，需修改则调用 Node.textContent = vnode.text；</li> <li>if( oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch)，两个节点均有子节点且不一样，则调用 updateChildren 函数比较子节点(此乃 diff 核心)；</li> <li>if (ch)，只有新节点有子节点，则调用 createEle(vnode)，vnode.el 已引用了老的 dom节点，createEle 函数会在老dom节点上添加子节点；</li> <li>if (oldCh)，新节点没有子节点，老节点有子节点，则直接删除老节点；</li></ul></li> <li>updateChildren：方法关键，过程可概括如下：
<ul><li>oldCh 和 newCh 各有两个头尾的变量 oldStartIndex、oldEndIndex &amp; newStartIndex、newEndIndex，它们之间两两相互比较，共有 4种比较方式，若4种比较均无匹配，且若设置了 key，就会利用 key 进行比较，在比较过程中，变量会往中间靠拢，一旦 Startldx &gt; Endldx 则表明 oldCh 和 newCh 至少有一个已经遍历完了，就会结束比较；</li></ul></li></ul> <img src="/Image/Frame/Vue/505.png" style="zoom:50%;"> <h5 id="_1-5-2、vue-中-key-的作用"><a href="#_1-5-2、vue-中-key-的作用" class="header-anchor">#</a> 1-5-2、Vue 中 key 的作用</h5> <p>key 是 Vue 中 vnode 的唯一标记，通过 key，在 diff 操作时可以更准确、更快速；</p> <ul><li>注意：对于简单列表页渲染来说，diff 节点也更快，但可能会产生隐藏副作用；比如不产生过渡效果、某些节点有绑定数据(表单)状态、状态错位等；</li></ul> <p>通过观察前面 Diff 过程，可得出 Vue 中 key 的作用是：key 是 Vue 中 vnode 的唯一标记， 通过 key，在 diff 操作时可更准确、更快速：</p> <ul><li>更准确：因带 key 就不是就地复用了，在 sameNode 函数 a.key === b. key 对比中，可避免就地复用，所以会更加准确；</li> <li>更快速：利用 key 的唯一性，生成 map 对象，来获取对应节点，比遍历方式更快；</li></ul> <p>补充：key 的作用是尽可能的复用DOM元素</p> <ul><li>新旧 children 中的节点只有顺序是不同时，最佳操作应是通过移动元素位置来实现更新目的；</li> <li>在新旧 children 节点中保存映射关系，以便能够在旧 children 节点中找到可复用节点，而 key 也就是 children 中节点的唯一标识；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createKeyToOldIdx</span> <span class="token punctuation">(</span><span class="token parameter">children<span class="token punctuation">,</span> beginIdx<span class="token punctuation">,</span> endIdx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i<span class="token punctuation">,</span> key
	<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> beginIdx<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		key <span class="token operator">=</span> children <span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>key
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> map<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> i
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> map 
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-6、keepalive"><a href="#_1-6、keepalive" class="header-anchor">#</a> 1-6、KeepAlive</h3> <p>keep-alive 可实现组件缓存，在组件切换时不会对当前组件进行卸载(即将组件包含在 keep-alive 元素，组件就会被缓存，在组件切换时就不会重新渲染而是直接使用，响应速度也更快)；keep-alive 是 Vue内置的一个组件，可使被包含的组件保留状态，避免重新渲染，一般结合路由和动态组件一起使用，用于缓存组件：</p> <ul><li>常用的两个属性 include/exclude 允许组件有条件的进行缓存，两者都支持字符串或正则表达式
<ul><li>include 表示只有名称匹配的组件会被缓存；</li> <li>exclude 表示任何名称匹配的组件都不会被缓存，其中 exclude 优先级比 include 高；</li></ul></li> <li>两个钩子函数 activated/deactivated，用来得知当前组件是否处于活跃状态；
<ul><li>当组件被激活时，触发钩子函数 activated，当组件被移除时，触发钩子函数 deactivated；</li></ul></li></ul> <p><strong><u><em>KeepAlive 实现原理与缓存策略</em></u></strong>：</p> <img src="/Image/Frame/Vue/507.png" align="" style="zoom:50%;"> <ul><li>首先，获取 keep-alive 包裹着的第一个子组件对象及其组件名：getFirstComponentChild；</li> <li>然后，根据设定的 include/exclude 进行条件匹配，决定是否缓存；不匹配，则直接返回组件实例；</li> <li>然后，根据组件 ID 和 tag 生成缓存 Key，并在缓存对象中查找是否已缓存过该组件实例；
<ul><li>若存在，则直接取出缓存值并更新该 key 在 this.keys 中的位置 (更新 key 的位置是实现 LRU 置换策略的关键)</li></ul></li> <li>然后，在 this.cache 对象中存储该组件实例并保存 key 值；</li> <li>然后，检查缓存的实例数量是否超过 max 设置值，若超过则根据 LRU 置换策略删除最近最久未使用的实例(即是下标为0的那个key)；
<ul><li>LRU(Least recently used)，缓存淘汰算法，根据数据历史访问记录来进行淘汰数据，核心思想是&quot;若数据最近被访问过，则将来被访问的几率也更高&quot;</li> <li>keep-alive 的实现正是利用了 LRU 策略，将最近访问的组件 push 到 this.keys 末尾，this.keys[0] 也即最久没被访问的组件；</li></ul></li> <li>最后，将组件实例的 keepAlive 属性设置为 true，此在渲染和执行被包裹组件的钩子函数会用到；</li></ul> <img src="/Image/Frame/Vue/506.png" align="" style="zoom:50%;"> <h3 id="_1-7、vuerouter"><a href="#_1-7、vuerouter" class="header-anchor">#</a> 1-7、VueRouter</h3> <p>Vue-router 有3种路由模式: hash、history、 abstract：</p> <ul><li>hash：使用 URL hash 值来作路由；支持所有浏览器，包括不支持HTML5 History Api的浏览器；</li> <li>history：依赖 HTML5 History API 和服务器配置；具体可以查看HTML5 History模式；</li> <li>abstract：支持所有 JS 运行环境，如 Node.js 服务器端；若发现没有浏览器的API，则会自动强制进入此模式；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">'history'</span><span class="token operator">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTML5History</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">case</span> <span class="token string">'hash'</span><span class="token operator">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fallback<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">case</span> <span class="token string">'abstract'</span><span class="token operator">:</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbstractHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE__ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid mode: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong><u><em>hash 模式的实现原理</em></u></strong>
早期前端路由的实现就是基于 location.hash，location.hash 值即 URL 中 # 后面的内容(含符号#)；hash 路由模式实现基于以下几个特性</p> <ul><li>URL 中 hash值只是客户端的一种状态，也即当向服务器端发出请求时，hash 部分不会被发送；</li> <li>hash 值的改变，都会在浏览器访问历史中增加记录；因此能通过浏览器回退、前进按钮控制 hash 的切换；</li> <li>可通过 a 标签，并设置 href 属性，当用户点击标签后，URL 的 hash 值就会发生改变；</li> <li>或可通过 JS 来对 loaction.hash 进行赋值，改变 URL 的 hash值；</li> <li>可使用 hashchange 事件来监听 hash 值变化，从而对页面进行跳转(渲染)；</li></ul> <p><em><strong><u>history 模式的实现原理</u></strong></em>
H5 提供 History API 来实现 URL 变化；其中最主要的API有：historv.pushState()—新增历史记录、historv.repalceState()—直接替换当前的历史记录；此两个 API 可在不进行刷新的情况下，操作浏览器的历史纪录；history 路由模式实现基于以下几个特性：</p> <ul><li>pushState 和 repalceState 操作实现 URL 变化；</li> <li>使用 popstate 事件来监听 url 变化，从而对页面进行跳转(渲染)；</li> <li>注意：history.pushState() 或 history.replaceState() 不会触发 popstate 事件，所以需要手动触发页面跳转(渲染)；</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-8、compiler-render"><a href="#_1-8、compiler-render" class="header-anchor">#</a> 1-8、Compiler &amp; Render</h3> <img src="/Image/Frame/Vue/508.png" align="" style="zoom:50%;"> <h4 id="_1-8-1、compiler"><a href="#_1-8-1、compiler" class="header-anchor">#</a> 1-8-1、Compiler</h4> <p>模板解析这种事，本质是将数据转化为一段html，最开始出现在后端，经过各种处理吐给前端；但随着各种 mv* 兴起，模板解析交由前端处理；</p> <p>1、Vue complier 将 template 转化成一个 render 函数字符串，编译过程如下：</p> <ul><li>parse函数：负责解析 template，利用正则生成 AST；</li> <li>optimize 函数：负责优化静态节点(标记不需要每次都更新的内容，diff 算法会直接跳过静态节点，从而减少比较过程，优化 patch 性能)；</li> <li>generate 函数：生成 render 函数字符串；</li></ul> <p>2、调用 new Watcher 函数，监听数据的变化，当数据发生变化时，Render 函数执行生成 vnode 对象；</p> <p>3、调用 patch 方法，对比新旧 vnode 对象，通过DOM diff 算法添加、修改、删除真正的 DOM 元素；</p> <h3 id="_1-9、nexttick"><a href="#_1-9、nexttick" class="header-anchor">#</a> 1-9、nextTick</h3> <h4 id="_1-9-1、异步更新队列与-nexttick"><a href="#_1-9-1、异步更新队列与-nexttick" class="header-anchor">#</a> 1-9-1、异步更新队列与 nextTick</h4> <p>Vue 在更新 DOM 时是异步执行的；</p> <ul><li>首先，只要侦听到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环下所发生的所有数据变更；假若同一个 watcher 被多次触发，则只会被推入到队列中一次；这种在缓冲时，去除重复数据能避免不必要的计算和 DOM 操作；</li> <li>然后，在下一个的事件循环 Tick 中，Vue 刷新队列并执行实际已去重的工作；
<ul><li>回顾：主线程的执行过程就是一个 tick，而所有的异步结果都是通过&quot;任务队列&quot;来调度；比如消息队列中存放的是一个个的任务 (task) 。规范中规定task分为两大类，分别是 macro task 和 micro task，且每个 macro task 结束后，都要清空所有的 micro task；</li></ul></li> <li>Vue 内部对异步队列，会依次尝试使用原生 Promise.then、MutationObserver、setlmmediate，若执行环境均不支持，则会采用 setTimeout(fn, 0)代替；在vue2.5的源码中，macrotask 降级的方案依次是：setlmmediate、 MessageChannel、 setTimeout；</li></ul> <p>Vue 的 nextTick 方法的实现原理：</p> <ul><li>Vue 用异步队列方式，来控制 DOM 更新和 nextTick 回调分别先后执行；
<ul><li>nextTick 在下次DOM更新循环结束后执行延迟回调；主要使用了宏&amp;微任务，并根据环境分别尝试使用 Promise、MutationObserver、setlmmediate、setTimeout；</li></ul></li> <li>microtask 因其高优先级特性，能确保队列中的微任务在一次事件循环前被执行完毕；</li> <li>考虑兼容问题，Vue 对 microtask 做了向 macrotask 降级的方案；</li></ul> <h3 id="_1-x、其他"><a href="#_1-x、其他" class="header-anchor">#</a> 1-X、其他</h3> <h4 id="_1-x-1、prop-data"><a href="#_1-x-1、prop-data" class="header-anchor">#</a> 1-X-1、Prop &amp; Data</h4> <h5 id="_1-x-1-1、单向数据流"><a href="#_1-x-1-1、单向数据流" class="header-anchor">#</a> 1-X-1-1、单向数据流</h5> <p>所有 prop 都使得其 父子 prop 间形成一个**<u><em>单向下行</em></u>**：绑定父级的 prop 的更新会向下传递到子组件中，反之则不行，以防止从子组件意外改变父级组件状态；</p> <ul><li><p>注意：每次父级组件发生更新时，子组件中所有的 prop 都将会刷新为最新值；即不应在子组件内部改变 prop；若子组件想修改，则只能通过 $emit 派发自定义事件，父组件接收到后，由父组件修改；即谁负责的数据谁管理；以下是两种试图改变 prop 的情形：</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 情形1：</span>
<span class="token comment">// 下面的 prop 用来传递初始值; 而子组件希望将其作为本地的 prop 数据来使用; 此时应定义一本地 data 属性将此 prop 用作其初始值:</span>
props<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'initialCounter'</span><span class="token punctuation">]</span> <span class="token punctuation">,</span>
<span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		counter<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initialCounter
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 情形2：</span>
<span class="token comment">// 下面的 prop 以一种原始值传入且需要进行转换；此时应使用这个 prop 的值来定义一个计算属性</span>
props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
computed<span class="token operator">:</span> <span class="token punctuation">(</span>
	<span class="token function-variable function">normalizedSize</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>注意：prop 指定类型</p> <ul><li><div class="language-js extra-class"><pre class="language-js"><code>props<span class="token operator">:</span> <span class="token punctuation">{</span>
  accountNumber<span class="token operator">:</span> <span class="token punctuation">{</span>
  	type<span class="token operator">:</span> Number<span class="token punctuation">,</span>
  	required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span>
  	type<span class="token operator">:</span>
  	String<span class="token punctuation">,</span>
  	required<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  favoriteColors<span class="token operator">:</span> Array
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h5 id="_1-x-1-2、组件-data-与-实例-data"><a href="#_1-x-1-2、组件-data-与-实例-data" class="header-anchor">#</a> 1-X-1-2、组件 data 与 实例 data</h5> <p>组件 data 与 实例 data，前者为函数，后者为对象；</p> <p>因为组件是用来复用的，某组件被复用多次， 也就会创建多个实例，而本质上，这些实例用的都是同一个构造函数；若组件中的 data 是一个对象(引用类型)，子组件中的 data 属性值就会相互影响；而若组件中 data 选项是函数，则每个实例就可以维护一 份被返回对象的独立的拷贝，组件实例间的 data 属性值也不会互相影响；但是 new Vue 的实例，不会被复用的，不存在引用对象问题；</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 组件 data</span>
<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		name<span class="token operator">:</span> <span class="token string">'TLP'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 实例 data</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	el<span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
	router<span class="token punctuation">,</span>
	store<span class="token punctuation">,</span>
	template<span class="token operator">:</span> <span class="token string">'&lt;App/&gt;'</span><span class="token punctuation">,</span>
	components<span class="token operator">:</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_1-x-2、常用指令"><a href="#_1-x-2、常用指令" class="header-anchor">#</a> 1-X-2、常用指令</h4> <h5 id="_1-x-2-1、v-if-与-v-show-区别"><a href="#_1-x-2-1、v-if-与-v-show-区别" class="header-anchor">#</a> 1-X-2-1、v-if 与 v-show 区别</h5> <p>前者，是真正的条件渲染，其会确保在切换过程中，条件块内的事件监听器和子组件适当地被销毁和重建，也即惰性的：若初始渲染时条件为假，则什么都不做直到条件首次变为真时，才会开始渲染条件块；</p> <p>后者，不管初始条件是什么，元素总是会被渲染，然后只是简单地基于 CSS 的 &quot;display&quot; 属性进行切换；
所以，前者适用于在运行时很少改变条件，无需频繁切换条件的场景；后者则适用于需要非常频繁切换条件的场景；</p> <h4 id="_1-x-3、watch-computed-methods"><a href="#_1-x-3、watch-computed-methods" class="header-anchor">#</a> 1-X-3、watch/computed/methods</h4> <p>三者区别：</p> <ul><li>computed：计算属性，依赖其它属性值，且 computed 有缓存性，只有它依赖的属性值发生改变，下一次获取 computed 时才会重新计算新值；
<ul><li>本质是一个惰性求值的观察者，其内部实现了一个具有缓存功能的 watcher，也即 computed watcher，watcher 不会立刻求值，同时其持有一个 dep 实例；实例内部通过 this.dirty 属性标记计算属性是否需要重新求值；然后，当 computed 的依赖状态发生改变时，就会通知这个惰性的 watcher；然后，computed watcher 通过  this.dep.subs.length 判断有没有订阅者：
<ul><li>若有则会重新计算，然后对比新旧值，有变化就会重新渲染；注意：Vue 想确保不仅是计算属性依赖的值发生变化就触发渲染，而是当计算属性最终计算的值发生变化，才会触发渲染 watcher 重新渲染，本质上是一种优化；</li> <li>若无则仅将 this.dirty = true；注意：当计算属性依赖于其他数据时，属性并不会立即重新计算，只有之后其他地方需要读取属性时，它才会真正计算，即具备 lazy 特性；</li></ul></li> <li>注意：computed 是在 DOM加载后马上执行，比如赋值操作；</li> <li>注意：计算属性计算时所依赖的属性一定是响应式依赖，否则计算属性不会执行；</li> <li>注意：计算属性是基于依赖进行缓存，若依赖无更新，调用计算属性并不会重新计算，因此可减少开销，只有在其依赖的属性值改变后的下一次获取computed 值时才会重新调用对应的 getter 来计算出相应新值；</li></ul></li> <li>watch：侦听器，更多起观察作用，无缓存性，可以监听某些数据执行回调，每当监听的数据变化时，都会执行回调进行后续操作；
<ul><li>注意：当需要进行深度监听对象中属性时，可打开 deep: true 选项，这样便会对对象中的每一项进行监听，虽会带来性能问题，但可使用字符串形式监听来优化；此外如果没有写到组件中，需要注意使用 unWatch 手动注销；</li></ul></li> <li>methods：方法，无缓存性，不像 computed 在 DOM 加载后可自动执行，必须有一定触发条件才被执行，如点击事件等；
<ul><li>区别：与 computed 区别在于：前者必须有一定的触发条件才能执行，比如重渲染，异步绑定事件等；而后者则基于它的依赖进行缓存，若多次访问的时候(值不变情况下)，计算属性会立即返回数据，而不必再次执行函数，另外还可自动执行(依赖变化且被读取)；</li></ul></li></ul> <p>使用场景:</p> <ul><li>当数值计算并依赖于其它数据、计算耗性能的计算场景、模板表达式过于复杂时、复杂渲染数据的计算、不必重新计算数值，可利用 computed 缓存特性，避免每次获取值时都重新计算；</li> <li>当需要在数据变化时执行异步或开销较大操作时，可使用 watch，注意限制执行该操作的频率，并在得到最终结果前，设置中间状态；</li> <li>注意：能使用 watch 属性的场景基本上都可使用 computed 属性，且 computed 属性开销小性能高，故因尽量使用 computed 属性，除非要执行异步或昂贵的操作以响应不断变化的数据；</li> <li>比如：点击搜索按钮的时候才进行数据的响应和操作，使用 computed；获取当前时间，使用 methods；</li></ul> <h4 id="_1-x-4、ssr"><a href="#_1-x-4、ssr" class="header-anchor">#</a> 1-X-4、SSR</h4> <img src="/Image/Frame/Vue/509.png" align="" style="zoom:50%;"> <p>VueSSR 即 Vue 在客户端将标签渲染成的整个 html 片段的工作在服务端完成，服务端将形成的 html 片段直接返回给客户端的过程就叫做服务端渲染；</p> <p>服务端渲染的优点：</p> <ul><li>更好的SEO：SPA 页面的内容通过 Ajax 获取，而搜索引擎爬取工具并不会等待 Ajax 异步完成后再抓取页面内容；而 SSR 是直接由服务端返回已渲染好的页面(数据已经包含在页面中)，所以搜索引擎爬取工具可以抓取渲染好的页面；</li> <li>更快的内容到达时间(首屏加载更快)：SPA 会等待所有 Vue 编译后的 JS 文件都下载完成后，才开始进行页面渲染，文件下载等需要一定的时间，所以首屏渲染需要一定时间；而 SSR 则直接由服务端渲染好页面直接返回显示，无需等待下载 JS 文件及再去渲染等，所以 SSR 有更快的内容到达时间；</li></ul> <p>服务端渲染的缺点：</p> <ul><li>更多的开发条件限制：比如服务端渲染只支持 beforCreate 和 created 两个钩子函数，导致一些外部扩展库需要特殊处理才能在 SSR 应用中运行；且与可以部署在任何静态文件服务器上的完全静态单页面应用 SPA 不同，服务端渲染应用需要处于 Node.js server 运行环境；</li> <li>更多的服务器负载：在 Node 中渲染完整的应用，显然会比仅仅提供静态文件的 server 更大量占用 CPU 资源(CPU-intensive - CPU密集)；若想在高流量环境( high traffic )下使用，请先提供服务器负载，并明智地采用缓存策略；</li></ul> <p>服务端渲染基本原理：</p> <ul><li>app.js 作为客户端与服务端的公用入口，导出 Vue 根实例，供客户端 entry 与服务端 entry 使用；
<ul><li>客户端 entry 主要作用挂载到 DOM 上；</li> <li>服务端 entry 除创建和返回实例，还进行路由匹配与数据预获取；</li></ul></li> <li>webpack 为客服端打包一个Client Bundle，为服务端打包一个Server Bundle；</li> <li>服务器接收请求时，会根据 url，加载相应组件，获取和解析异步数据，创建一个读取 Server Bundle 的 BundleRenderer，然后生成 html 发送给客户端；</li> <li>客户端混合，客户端收到从服务端传来的 DOM 与自己的生成的 DOM 进行对比，将不相同的DOM激活，使其能够响应后续变化，这个过程称为客户端激活；为确保混合成功，客户端与服务器端需共享同一套数据；在服务端，可在渲染前获取数据并填充到 stroe 中；如此，在客户端挂载到DOM前，便可直接从 store 里取数据。首屏的动态数据通过 window._ INITIAL_ STATE__ 发送到客户端；</li></ul> <p>Vue SSR 的实现，主要是将 Vue 的组件输出成完整 HTML(vue-server-renderer 负责这项功能)；纯客户端输出过程有一 complier 过程，其主要作用是将 template 转化成 render字符串；而 Vue SSR 则还需负责：输出完整HTML、complier -&gt; vnode、数据获取填充至 HTML、客户端混合(hydration) 、 缓存等等；</p> <h4 id="_1-x-5、spa"><a href="#_1-x-5、spa" class="header-anchor">#</a> 1-X-5、SPA</h4> <p>SPA(single-page application)，仅在Web页面初始化时加载相应的 HTML、Js 和 CSS；一旦页面加载完成，SPA 不会因为用户的操作而进行页面的重新加载或跳转；取而代之的是利用路由机制实现 HTML 内容的变换，UI 与用户的交互，避免页面的重新加载；</p> <p>优点:</p> <ul><li>用户体验好、快，内容改变无需重载整个页面，避免不必要的跳转和渲染，对服务器压力小；</li> <li>前后端职责分离，架构清晰，前端进行交互逻辑，后端负责数据处理；</li></ul> <p>缺点：</p> <ul><li>初次加载耗时多：为实现单页Web应用功能及显示效果，需在加载页面时将 JS、CSS 统一加载，部分页面按需加载；</li> <li>前进后退路由管理：由于单页应用在一个页面中显示所有内容，所以不能使用浏览器的前进后退功能，所有页面切换需要自己建立堆栈管理；</li> <li>SEO难度较大：由于所有的内容都在一个页面中动态替换显示，在SEO上其有着天然弱势；</li></ul> <h4 id="_1-x-6、性能优化"><a href="#_1-x-6、性能优化" class="header-anchor">#</a> 1-X-6、性能优化</h4> <ul><li><p>编码阶段：</p> <ul><li>keep-alive</li> <li>防抖、节流</li> <li>使用事件代理</li> <li>采用keep-alive缓存组件</li> <li>v-if 和 v-show 区分使用场景</li> <li>computed 和 watch区分使用场景</li> <li>长列表性能优化，滚动到可视区域动态加载、优化无限列表性能</li> <li>v-for 遍历必须为 item 添加 key，key 保证唯一， v-if 和 v-for 不同用</li> <li>三方模块按需导入、图片懒加载、路由懒加载、异步组件、事件的销毁</li> <li>尽量减少 data 中的数据，data 中的数据都会增加 Get/Set，会收集对应的 watcher</li></ul></li> <li><p>SEO优化</p> <ul><li>预渲染</li> <li>服务端渲染SSR</li></ul></li> <li><p>打包优化：</p> <ul><li>splitChunks提取公共代码、压缩代码、图片压缩、提取组件的CSS、优化SourceMap</li> <li>Tree Shaking/Scope Hoisting、多线程打包happypack、模板预编译、构建结果输出分析</li> <li>使用cdn加载第三方模块、减少ES6转为ES5的冗余代码</li></ul></li> <li><p>网络优化</p> <ul><li>开启gzip压缩</li> <li>浏览器缓存</li> <li>使用 CDN</li> <li>使用 Chrome Performance 查找性能瓶颈</li></ul></li> <li><p>用户体验</p> <ul><li>骨架屏</li> <li>PWA</li></ul></li></ul> <p>响应式依赖扁平化</p> <p>减少非必要的响应式依赖</p> <p>Object.freeze</p> <p>DOM 滚动加载</p> <p>事件销毁（防止内存泄漏）</p> <p>组件按需引入</p> <p>预渲染</p> <p>按需 Polyfill</p> <p>模板预编译</p> <p>渲染函数</p> <p>官方风格指南 + 官方 ESLint 插件</p> <h4 id="_1-x-x、ms"><a href="#_1-x-x、ms" class="header-anchor">#</a> 1-X-X、MS</h4> <ul><li>Vue.js 源码的入口主要做了些什么处理？
<ul><li>各种初始化，各种属性方法的添加(静态 &amp; 原型)；</li></ul></li> <li>Vue 的整个框架的实现原理大致可分为哪几个部分？
<ul><li>详看 1-1 实现原理；</li></ul></li> <li>Vue.js 中的数据劫持是怎么实现的？浏览器兼容性呢？
<ul><li>详看数据绑定小节 &amp; 源码小节；通过  Object.defineProperty 实现，最低支持 IE8；</li></ul></li> <li>Vue.js 中的依赖收集是怎么处理的？和闭包有什么关联吗？
<ul><li>详看数据绑定小节 &amp; 源码小节；Dep 内部通过闭包获取 watcher，Watcher 内部通过闭包获取 dep；</li></ul></li> <li>Vue.js 中的模板解析需要经历哪几个阶段？
<ul><li>parse，optimize，generate，解析模板，生成渲染模板的 render</li> <li>注意：optimize 标记了静态节点(没有绑定任何动态数据)，在页面需要更新时，VueDiff 时会直接此部分 DOM 的处理，从而达到性能优化的目的；</li></ul></li> <li>Vue.js 中的虚拟节点优势是什么？
<ul><li>详看 DOM Diff 小节；无需频繁操作 DOM，性能优异、本质为 JS 对象，可跨平台处理；</li></ul></li> <li>Vue.js 中的 DIFF 算法是怎么处理的？
<ul><li>详看生命周期小节与源码解析部分小节；</li></ul></li> <li><h2 id="vue-js-中-diff-算法的时间复杂度是多少-为什么"><a href="#vue-js-中-diff-算法的时间复杂度是多少-为什么" class="header-anchor">#</a> Vue.js 中 DIFF 算法的时间复杂度是多少？为什么？</h2></li> <li>Vue.js 中 <code>computed</code> / <code>watch</code> 实现的原理是什么？
<ul><li>详看源码解析部分小节；前者是带有 dirty 属性的 watch，通过 dirty 标记位，阻止页面刷新渲染时计算值，而只有相关值变化时才触发；</li></ul></li> <li>Vue.js 中有哪些周期函数？这些周期函数都是在什么时机执行的？
<ul><li>详看生命周期小节；</li></ul></li> <li>Vue.js 中的 <code>$nextTick</code> 的原理是什么？它主要经历了哪些变化？为什么？
<ul><li>详看源码解析部分小节；</li></ul></li> <li><h2 id="vue-js-对-dom-的更新做了哪些标记优化处理"><a href="#vue-js-对-dom-的更新做了哪些标记优化处理" class="header-anchor">#</a> Vue.js 对 DOM 的更新做了哪些标记优化处理？</h2></li> <li><h2 id="vue-js-在语法层面可以做哪些优化处理"><a href="#vue-js-在语法层面可以做哪些优化处理" class="header-anchor">#</a> Vue.js 在语法层面可以做哪些优化处理？</h2></li> <li>Vue.js 2.x 中的 Proxy 代理主要做了些什么工作？
<ul><li>通过 Object.defineProperty 实现，将 data 属性代理到 vm 实例上(this.key == this.data.key)；</li></ul></li> <li>Vue 3.x 的源码相对 Vue 2.x 主要做了哪些变化？</li> <li></li> <li>Vue 2.x 中的数据劫持能否采用发布 / 订阅模式实现？采用观察者模式带来的优势和劣势有哪些？</li> <li>Vue.js 中的 M / V / VM 分别指的是哪些？简述 MVC / MVP / MVVM 的区别？</li> <li>发布 / 订阅模式和观察者模式的区别是什么？手写一个发布 / 订阅模式？</li> <li></li> <li><h2 id="vue-js-报-error-warning-的时有深入追踪错误栈的习惯吗-如何追踪"><a href="#vue-js-报-error-warning-的时有深入追踪错误栈的习惯吗-如何追踪" class="header-anchor">#</a> Vue.js 报 error / warning 的时有深入追踪错误栈的习惯吗，如何追踪；</h2></li> <li><h2 id="polyfill-是什么-vue-支持哪些相关的可配置化信息"><a href="#polyfill-是什么-vue-支持哪些相关的可配置化信息" class="header-anchor">#</a> Polyfill 是什么？Vue 支持哪些相关的可配置化信息？</h2></li> <li><h2 id="vue-js-2-x-中如何支持-typescript"><a href="#vue-js-2-x-中如何支持-typescript" class="header-anchor">#</a> Vue.js 2.x 中如何支持 TypeScript ?</h2></li> <li><h2 id="vue-js-如何做-eslint-校验"><a href="#vue-js-如何做-eslint-校验" class="header-anchor">#</a> Vue.js 如何做 ESLint 校验？</h2></li> <li><h2 id="vue-js-如何做单元测试"><a href="#vue-js-如何做单元测试" class="header-anchor">#</a> Vue.js 如何做单元测试？</h2></li> <li>了解过 Vue-Router  / Vuex 的源码吗？
<ul><li>了解过，还研究过；</li></ul></li> <li><h2 id="vue-loader-主要有哪些特性"><a href="#vue-loader-主要有哪些特性" class="header-anchor">#</a> Vue-loader 主要有哪些特性？</h2></li> <li>Vue 路由懒加载是如何实现的？</li> <li>Coding Split 和哪些 Webpack 配置相关？</li> <li>Vue 中可以使用 JSX 吗？</li> <li></li> <li>设置了 <code>keep-alive</code> 之后对组件渲染的生命周期有什么影响？</li> <li><code>keep-alive</code> 有哪些特性？</li></ul> <p>参考：https://juejin.im/post/6844904093425598471</p> <h3 id="_1-z、代码风格"><a href="#_1-z、代码风格" class="header-anchor">#</a> 1-Z、代码风格</h3> <h4 id="_1-z-1、vue-代码风格"><a href="#_1-z-1、vue-代码风格" class="header-anchor">#</a> 1-Z-1、Vue 代码风格</h4> <h4 id="_1-z-2、angular-代码风格"><a href="#_1-z-2、angular-代码风格" class="header-anchor">#</a> 1-Z-2、Angular 代码风格</h4> <p>https://angular.cn/guide/styleguide</p> <p>https://juejin.im/post/6844904122718617608</p> <p>使用 <a href="https://tsquery-playground.firebaseapp.com/" target="_blank" rel="noopener noreferrer">TSQuery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 自定义 tsLint：https://medium.com/@phenomnominal/custom-typescript-lint-rules-with-tsquery-and-tslint-144184b6ff2d</p> <p>上述补充：https://medium.com/angular-in-depth/bending-tslint-to-your-needs-6ae0a51e633</p> <p>TSLint：https://palantir.github.io/tslint/rules/</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.cda475f7.js" defer></script><script src="/docs/assets/js/2.c902c426.js" defer></script><script src="/docs/assets/js/57.cd784d78.js" defer></script>
  </body>
</html>

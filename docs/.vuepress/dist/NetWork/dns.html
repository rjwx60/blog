<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、基本 | Leibnize 个人学习笔记</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="整理自网络">
    <link rel="preload" href="/docs/assets/css/0.styles.2f643d57.css" as="style"><link rel="preload" href="/docs/assets/js/app.cda475f7.js" as="script"><link rel="preload" href="/docs/assets/js/2.c902c426.js" as="script"><link rel="preload" href="/docs/assets/js/64.c7956833.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.418fecbd.js"><link rel="prefetch" href="/docs/assets/js/11.e2c998bf.js"><link rel="prefetch" href="/docs/assets/js/12.b627468b.js"><link rel="prefetch" href="/docs/assets/js/13.682b9b92.js"><link rel="prefetch" href="/docs/assets/js/14.0880e743.js"><link rel="prefetch" href="/docs/assets/js/15.4a6c4027.js"><link rel="prefetch" href="/docs/assets/js/16.200e0299.js"><link rel="prefetch" href="/docs/assets/js/17.1c6394bc.js"><link rel="prefetch" href="/docs/assets/js/18.c0560a2b.js"><link rel="prefetch" href="/docs/assets/js/19.f63607cc.js"><link rel="prefetch" href="/docs/assets/js/20.d56d802e.js"><link rel="prefetch" href="/docs/assets/js/21.52c3ae8e.js"><link rel="prefetch" href="/docs/assets/js/22.b47add39.js"><link rel="prefetch" href="/docs/assets/js/23.a8a40e53.js"><link rel="prefetch" href="/docs/assets/js/24.a0e2af55.js"><link rel="prefetch" href="/docs/assets/js/25.1fb24116.js"><link rel="prefetch" href="/docs/assets/js/26.068130b1.js"><link rel="prefetch" href="/docs/assets/js/27.6cb72d75.js"><link rel="prefetch" href="/docs/assets/js/28.d99e5701.js"><link rel="prefetch" href="/docs/assets/js/29.4848d9ba.js"><link rel="prefetch" href="/docs/assets/js/3.be11a00a.js"><link rel="prefetch" href="/docs/assets/js/30.92ed4a03.js"><link rel="prefetch" href="/docs/assets/js/31.de402b39.js"><link rel="prefetch" href="/docs/assets/js/32.b5ca6564.js"><link rel="prefetch" href="/docs/assets/js/33.c3d91abd.js"><link rel="prefetch" href="/docs/assets/js/34.b868c98b.js"><link rel="prefetch" href="/docs/assets/js/35.4128bd9f.js"><link rel="prefetch" href="/docs/assets/js/36.8e4b22b8.js"><link rel="prefetch" href="/docs/assets/js/37.090897e6.js"><link rel="prefetch" href="/docs/assets/js/38.f8d5752b.js"><link rel="prefetch" href="/docs/assets/js/39.f949333a.js"><link rel="prefetch" href="/docs/assets/js/4.64176cb5.js"><link rel="prefetch" href="/docs/assets/js/40.39833f40.js"><link rel="prefetch" href="/docs/assets/js/41.a12c7b96.js"><link rel="prefetch" href="/docs/assets/js/42.a5e6d9e8.js"><link rel="prefetch" href="/docs/assets/js/43.28874788.js"><link rel="prefetch" href="/docs/assets/js/44.8d4042e3.js"><link rel="prefetch" href="/docs/assets/js/45.b148e845.js"><link rel="prefetch" href="/docs/assets/js/46.91062fd6.js"><link rel="prefetch" href="/docs/assets/js/47.2026c6cc.js"><link rel="prefetch" href="/docs/assets/js/48.b0f3d68f.js"><link rel="prefetch" href="/docs/assets/js/49.9d81175e.js"><link rel="prefetch" href="/docs/assets/js/5.1d876c62.js"><link rel="prefetch" href="/docs/assets/js/50.1a00f734.js"><link rel="prefetch" href="/docs/assets/js/51.b16e53d7.js"><link rel="prefetch" href="/docs/assets/js/52.831b9cca.js"><link rel="prefetch" href="/docs/assets/js/53.4ce4ac34.js"><link rel="prefetch" href="/docs/assets/js/54.6d7ca762.js"><link rel="prefetch" href="/docs/assets/js/55.2bb32bbd.js"><link rel="prefetch" href="/docs/assets/js/56.388173c5.js"><link rel="prefetch" href="/docs/assets/js/57.cd784d78.js"><link rel="prefetch" href="/docs/assets/js/58.d994c1a9.js"><link rel="prefetch" href="/docs/assets/js/59.0665a00b.js"><link rel="prefetch" href="/docs/assets/js/6.bc091efc.js"><link rel="prefetch" href="/docs/assets/js/60.12f3479d.js"><link rel="prefetch" href="/docs/assets/js/61.679d1273.js"><link rel="prefetch" href="/docs/assets/js/62.04ef0d26.js"><link rel="prefetch" href="/docs/assets/js/63.70e8cd2b.js"><link rel="prefetch" href="/docs/assets/js/65.0304095c.js"><link rel="prefetch" href="/docs/assets/js/66.f16304a7.js"><link rel="prefetch" href="/docs/assets/js/67.d0a945f4.js"><link rel="prefetch" href="/docs/assets/js/68.26e1c58d.js"><link rel="prefetch" href="/docs/assets/js/69.ac162984.js"><link rel="prefetch" href="/docs/assets/js/7.255d7d5f.js"><link rel="prefetch" href="/docs/assets/js/70.5408bf05.js"><link rel="prefetch" href="/docs/assets/js/8.2117996a.js"><link rel="prefetch" href="/docs/assets/js/9.e855c324.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.2f643d57.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Leibnize 个人学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/rjwx60" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span></span> <span class="arrow down"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="一、基本"><a href="#一、基本" class="header-anchor">#</a> 一、基本</h3> <h4 id="_1-1、基本"><a href="#_1-1、基本" class="header-anchor">#</a> 1-1、基本</h4> <p>DNS (Domain Name System)，是一种组织成：域层次结构的计算机和网络服务命名系统，<u>提供将主机名和域名转换为IP地址的服务</u>，是将人类可读域名与服务器 IP 进行映射的数据库，使用户更为方便访问网络；</p> <p>DNS 运行在 UDP 协议之上，使用端口 53；(网络通讯大部分基于 TCP/IP，虽 IP 不方便记忆，但机器不认域名)</p> <p>DNS 是互联网中的重要基础设施，为保证高可用、高并发和分布式，它设计成了树状的层次结构；</p> <p>DNS 由<u>根DNS服务器、顶级域 DNS 服务器、权威 DNS 服务器</u> 组成；解析顺序是：</p> <p>首先从 <u>浏览器缓存</u>、<u>操作系统缓存</u> 及 <u>本地 DNS 缓存 (/etc/hosts)</u> 逐级查找，然后从 <u>本地 DNS 服务器</u>、<u>根 DNS</u>、<u>顶级 DNS</u> 及 <u>权威 DNS</u> 层层递归查询；还可基于域名在内网、外网进行负载均衡；</p> <p>传统 DNS 有很多问题(解析慢、更新不及时)，但是 <u>HTTP DNS</u> 通过客户端 SDK 和服务端配合，直接通过 HTTP 调用解析 DNS 的方式，从而绕过传统 DNS 缺点，实现智能调度；</p> <h4 id="_1-2、域名结构"><a href="#_1-2、域名结构" class="header-anchor">#</a> 1-2、域名结构</h4> <img src="/Image/NetWork/dns/1.png" style="zoom:50%;"> <img src="/Image/NetWork/dns/11.png" style="zoom:50%;"> <h5 id="_1-2-1、根子结构"><a href="#_1-2-1、根子结构" class="header-anchor">#</a> 1-2-1、根子结构</h5> <p>DNS服务器一般分三种，根DNS服务器，顶级DNS服务器，权威DNS服务器；</p> <p><strong><u>根域</u> <strong>名服务器，只保存下一级域名( <strong><u>顶级域</u></strong> 名服务器，保存下级域名服务器 IP)，比如 com、net、org 等，此外还有国家域名 jp、cn 等，而 <a href="https://www.zhihu.com/question/22587247/answer/66417484" target="_blank" rel="noopener noreferrer">全球只有13台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 根服务器；而顶级域名服务器则保存更下级的域名服务器 IP(</strong><u>第二层域</u></strong> 名服务器)，第二层域下含有 <strong><u>子域</u></strong> 名服务器；</p> <ul><li>根 DNS 服务器 ：返回顶级域 DNS 服务器的 IP 地址；</li> <li>顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址；</li> <li>权威 DNS 服务器 ：返回相应主机的 IP 地址；</li></ul> <h5 id="_1-2-2、分布式"><a href="#_1-2-2、分布式" class="header-anchor">#</a> 1-2-2、分布式</h5> <p>DNS 使用分布式的层次数据库模式缓存方法，来解决单点集中式的问题：</p> <ul><li>故障影响大(因特网规模持续增长，集中式设计一旦发生故障，全球通讯失败)</li> <li>通信容量(上亿台主机发送查询DNS报文请求，包括但不限于 HTTP请求，电子邮件报文、TCP长连接服务)</li> <li>远距离的时间延迟；</li> <li>维护开销大(因所有主机名的 IP 映射都要在同一服务站点更新)</li></ul> <h4 id="_1-3、查询工具-dig"><a href="#_1-3、查询工具-dig" class="header-anchor">#</a> 1-3、查询工具 Dig</h4> <img src="/Image/NetWork/dns/8.png" align="left" style="zoom:50%;"> <p>注意：资源记录：DNS 数据库中包含的 <strong><u>资源记录 (RR)</u></strong>，每个 RR 标识数据库中的特定资源；</p> <ul><li>在建立 DNS 服务器时，常用到 SOA、NS、A 记录；</li> <li>在维护 DNS 服务器时，则用到 MX、CNAME 记录</li></ul> <img src="/Image/NetWork/dns/12.png" align="left" style="zoom:50%;"> <h4 id="_1-4、解析流程-how-dns-query-works"><a href="#_1-4、解析流程-how-dns-query-works" class="header-anchor">#</a> 1-4、解析流程—<a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc775637(v=ws.10)?redirectedfrom=MSDN" target="_blank" rel="noopener noreferrer">How DNS query works<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h4> <p>1、首先：浏览器中输入域名 <code>www.baidu.com</code> ，然后浏览器搜索  <strong><u>自身 DNS 缓存</u></strong> (时效1min可存1000条，可通过地址栏输入 <code>chrome://net-internals/#dns</code> 查看)，若无则该请求会传递到 DNS 客户端服务，以使用计算机本地缓存的信息进行解析， <strong><u>本地解析器缓存</u></strong> 可从2个可能的来源获得名称信息：(查看本机 DNS 缓存方式详看：<a href="https://stackoverflow.com/questions/38867905/how-to-view-dns-cache-in-osx" target="_blank" rel="noopener noreferrer">stackoverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> )</p> <ul><li>若在本地配置 Hosts 文件，则在启动 DNS 客户端服务时，该文件中所有的主机到地址的映射均会预加载到缓存中；</li> <li>从以前的 DNS 查询的答复中获得的资源记录将添加到缓存中并保留一段时间；</li></ul> <p>2、然后，若查询与缓存中的条目不匹配，则解析过程将继续进行，客户端将向 <strong><u>本地配置的首选DNS 服务器</u></strong> 发起 <u><em>递归</em></u> 的域名解析请求，当运营商 DNS 服务器收到查询时，首先根据服务器本地配置区域中包含的资源记录信息，检查是否可权威地回答查询，若查询名称与本地区域信息中相应资源记录相匹配，则以此来解析查询名称以进行权威应答；若查询名称不存在于当前区域，则使用先前查询的本地缓存结果 (<strong><u>本地DNS服务器已缓存的映射关系</u></strong>) 进行检查，若匹配且未过期，则表示查询成功 (但此结果不具有权威性)；</p> <ul><li><p>注意：本地配置的首选DNS 服务器，一般是电信运营商提供的，也可是 Google 提供的 DNS 服务器；</p></li> <li><p>注意：浏览器发起 DNS 的系统调用，在很多基于UNIX的机器上，应用程序需调用函数 <code>gethostbyname()</code> ，用户主机的DNS客户端接收到后，便向网络中发送 DNS 查询报文；</p></li> <li><p>注意：查询其他DNS服务器使用递归查询，而为了使 DNS 服务器正确进行递归，需要一些有关 DNS 域名称空间中其他 DNS 服务器的有用的联系信息。此信息以 <em><strong>根提示 root hints</strong></em> 的形式提供(若下图)，***根提示***是可以由  DNS 服务用来查找对 DNS 域名称空间树的根具有权威性的其他 DNS 服务器的初步资源记录的列表；通过 <em><strong>根提示</strong></em> 查找根服务器，DNS 服务器可完成递归使用；</p></li></ul> <p>3、然后，若查询不得，则过程继续，DNS 服务器为用户发起 DNS 解析<u><em>迭代</em></u> 请求；</p> <img src="/Image/NetWork/dns/10.png" style="zoom:50%;"> <ul><li>注意：DNS的域名查找，在客户端和浏览器，本地DNS之间的查询方式是递归查询；在本地DNS服务器与根域及其子域之间的查询方式是迭代查询；递归查询与迭代查询区别：
<ul><li><strong>递归查询-Recursive resolution (query)</strong>：在递归解析中，如果客户机被授权使用域名，它就向第一服务器(the.edu)发送请求，否则就向下一服务器发送客户机请求，直到正确的服务器解析查询并向客户机发送应答；</li> <li><img src="/Image/NetWork/dns/16.png" align="left" style="zoom:50%;"></li> <li><img src="/Image/NetWork/dns/18.png" align="left" style="zoom:50%;"></li> <li><strong>迭代查询-Iterative resolution</strong>：客户端向第一个服务器发送查询，如果服务器被授权使用域名，它就会发送应答(IP 或域名) ，否则它就会发送下一个服务器的 IP 地址来解决查询。现在客户端将查询发送到第二台服务器。客户端继续这个向服务器发送查询的过程，直到查询被解析；</li> <li><img src="/Image/NetWork/dns/17.png" align="left" style="zoom:50%;"></li> <li><img src="/Image/NetWork/dns/19.png" align="left" style="zoom:30%;"></li> <li>综上，递归查询时客户单只发送查询到第一个服务器，然后服务器将请求发送到下一个服务器，直到查询被解析；而在迭代查询中，客户端负责将查询发送到不同的服务器，直到查询被解析；</li></ul></li></ul> <p>4、然后，若上述过程均解析失败，则根据本地 DNS 服务器的设置(是否设置转发器)进行查询：</p> <ul><li>若未开启转发模式：
<ul><li>首先，本地 DNS 服务器会向 13台 <u><em>根 DNS 服务器</em></u> 发起查询(DNS 服务器均内置13台根域的 DNS 的 IP 地址)，后者收到请求后会判断(.com) 由谁授权管理，并会返回负责该顶级域名的服务器的 IP (<u><em>下一级DNS服务器</em></u>)；</li> <li>然后，本地 DNS 服务器收到响应后，向负责 .com 域的服务器发起查询，若服务器自身无法解析，则会将管理 <code>baidu.com</code> 域的<u><em>下一级 DNS服务器</em></u> IP 地址返回给本地 DNS 服务器；</li> <li>最后，当本地 DNS 服务器收到后，查询负责 <code>baidu.com</code>  域的服务器；</li> <li>重复上述动作进行查询，直至 <code>www.baidu.com</code> ，最后返回给 DNS 服务器，服务器将结果返回给主机，主机再交给浏览器；</li></ul></li> <li>若已开启转发模式：本地 DNS服务器就会将请求转发至上一级 DNS服务器，由上一级服务器进行解析，若上级服务器无法解析，则或寻找根DNS或把转请求转至上上级，循环往复，最后返回给 DNS 服务器，服务器将结果返回给主机，主机再交给浏览器；</li></ul> <p>5、最后，若上述方法 (本地、DNS 服务器、缓存、迭代查询)均失败，操作系统则会：</p> <ul><li>首先，查询 <strong><u>NetBIOS name Cache (NETBIOS名称缓存，存放最近一段时间内成功通讯的计算机的机名与 IP 地址)</u></strong>，</li> <li>然后，若还失败，则查询 <strong><u>WINS 服务器(NETBIOS 名称和 IP 地址对应的服务器)</u></strong>，</li> <li>倘若，还失败，则客户端进行广播查找</li> <li>假若，还失败，客户端读取 <strong><u>LMHOSTS 文件 (类似 Hosts)</u></strong>；</li> <li>最后，解析失败</li></ul> <p>注意：无论本地DNS服务器开启转发模式与否，最后均将结果返回给自身，本地DNS服务器再将其返回给用户；从 <strong>客户端到本地DNS服务器是递归查询，而DNS服务器间的交互查询是迭代查询</strong>；</p> <img src="/Image/NetWork/dns/9.png" style="zoom:50%;"> <p>注意：<strong>主机向本地域名服务器的查询一般都是采用递归查询</strong>：若主机所询问的本地域名服务器不知道被查询的域名的IP地址，则本地域名服务器就以 DNS客户身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址；而<strong>本地域名服务器向根域名服务器的查询的迭代查询</strong>：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“下一步应当向哪个域名服务器进行查询”。然后让本地服务器进行后续的查询。根域名服务器通常是将自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一权限域名服务器进行查询。最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机；</p> <img src="/Image/NetWork/dns/15.png" style="zoom:50%;"> <img src="/Image/NetWork/dns/13.png" style="zoom:50%;"> <p>注意：查找过程中，优化点如下：</p> <ul><li>DNS 存在着多级缓存，从离浏览器的距离排序的话，有以下几种：</li> <li>浏览器缓存，系统缓存，路由器缓存，IPS服务器缓存，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存；</li> <li>在域名和 IP 的映射过程中，给了应用基于域名做负载均衡的机会，可以是简单的负载均衡，也可以根据地址和运营商做全局的负载均衡；</li></ul> <h3 id="二、dns-报文"><a href="#二、dns-报文" class="header-anchor">#</a> 二、DNS 报文</h3> <img src="/Image/NetWork/dns/2.png" style="zoom:50%;"> <img src="/Image/NetWork/dns/3.png" style="zoom:50%;"> <ul><li>注意：请求和响应格式为同一结构，只是部分字段内容的有无；</li> <li>注意：query：查询域名；response：返回 IP 地址；</li></ul> <h4 id="_2-1、dns-请求报文"><a href="#_2-1、dns-请求报文" class="header-anchor">#</a> 2-1、DNS 请求报文</h4> <h5 id="_2-1-1、question-字段格式"><a href="#_2-1-1、question-字段格式" class="header-anchor">#</a> 2-1-1、Question 字段格式</h5> <img src="/Image/NetWork/dns/5.png" align="left" style="zoom:40%;"> <img src="/Image/NetWork/dns/4.png" align="left" style="zoom:50%;"> <h4 id="_2-2、dns-响应报文"><a href="#_2-2、dns-响应报文" class="header-anchor">#</a> 2-2、DNS 响应报文</h4> <h5 id="_2-2-1、answer-字段格式"><a href="#_2-2-1、answer-字段格式" class="header-anchor">#</a> 2-2-1、Answer 字段格式</h5> <img src="/Image/NetWork/dns/7.png" align="left" style="zoom:40%;"> <img src="/Image/NetWork/dns/6.png" style="zoom:50%;"> <h4 id="_2-3、dns-使用-udp"><a href="#_2-3、dns-使用-udp" class="header-anchor">#</a> 2-3、DNS 使用 UDP</h4> <p><u>DNS 使用 UDP 传输原因：减小响应时间</u> (响应时间= DNS域名解析时间(域名解析时间越小越好)+ TCP 连接建立时间(固定的三次握手很难有进一步缩小的空间) + HTTP交易时间(基于Request / Response很难有提升的空间))；</p> <ul><li>采用TCP传输，则域名解析时间为：
<ul><li>DNS域名解析时间 = TCP连接时间 + DNS交易时间(若查询冷门域名信息，则还可能会经过域名根服务器、一二级域名服务器迭代查询，成本高昂)；</li></ul></li> <li>采用UDP传输，则域名解析时间为：
<ul><li>DNS域名解析时间 = DNS交易时间，减小响应时间，有效信息占比高；</li></ul></li></ul> <h3 id="三、安全与优化"><a href="#三、安全与优化" class="header-anchor">#</a> 三、安全与优化</h3> <h4 id="_3-1、dns-安全问题"><a href="#_3-1、dns-安全问题" class="header-anchor">#</a> 3-1、DNS 安全问题</h4> <h5 id="_3-1-1、dns-ddos-攻击"><a href="#_3-1-1、dns-ddos-攻击" class="header-anchor">#</a> 3-1-1、DNS DDoS 攻击</h5> <p>DNS 分布式拒绝服务 (DDoS) 带宽洪泛攻击，即攻击者向每个 DNS 根服务器/顶级域名服务器发送大量分组，使得大多数合法  DNS 请求无法得到应答；</p> <ul><li>对策A：使用分组过滤器保护，阻挡所偶有指向根服务器的 ICMP ping 报文；</li> <li>对策B：启动本地服务器的缓存技术，本地服务器缓存顶级域名服务器地址(便可绕过迭代查询根级服务器)；</li></ul> <h4 id="_3-2、dns-优化方式"><a href="#_3-2、dns-优化方式" class="header-anchor">#</a> 3-2、DNS 优化方式</h4> <h5 id="_3-2-1、减少主机名"><a href="#_3-2-1、减少主机名" class="header-anchor">#</a> 3-2-1、减少主机名</h5> <p>当客户端 DNS 缓存为空，DNS 查找数量与要加载的  Web 页面中唯一主机名的数量相同(含各类资源主机名)，</p> <p>所以：减少主机名数量可减少 DNS 查找数量，提升页面加载速度；</p> <p>注意：减少主机名与尽可能让浏览器并行下载相冲突，需合理处理关系；</p> <p>建议：将组件放到至少2个但不多于4个的主机名下，减少 DNS 查找的同时也允许高度并行下载；</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.cda475f7.js" defer></script><script src="/docs/assets/js/2.c902c426.js" defer></script><script src="/docs/assets/js/64.c7956833.js" defer></script>
  </body>
</html>

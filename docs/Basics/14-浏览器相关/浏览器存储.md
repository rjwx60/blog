# 三、浏览器存储

浏览器的本地存储主要分为： **Cookie**、**WebStorage(可再分为 localStorage 和 sessionStorage)**、**IndexedDB**；

## 3-1、Cookie

Cookie 设计之初并非用于本地存储，而是为了弥补 HTTP 在状态管理上的不足(无状态协议，服务端无法辨别每次请求的客户端的具体情况)；

Cookie 本质是浏览器中存储的一个很小的、内容以键值对形式存储的文本文件，每次向同一域名发送请求，均会自动携带相同 Cookie，服务器拿到 Cookie 后进行解析，即可获取客户端状态；即 Cookie 用于 <u>状态存储</u>，但缺点有如下：

- 容量缺陷：体积上限只有`4KB`，只能存储少量信息；
- 性能缺陷：Cookie 紧跟域名发送而不管是否真正需要，随着请求数增多性能浪费越严重——请求携带不必要数据；
- 安全缺陷：Cookie 纯文本形式，在飞行途中很容易被非法用户截获篡改，在有效期内发送给服务器更是危险操作；
  - 此外，若 **HttpOnly** 字段为 false，Cookie 信息还可直接通过 JS 脚本来读取；



## 3-2、localStorage

### 3-2-1、与 Cookie 的异同

同一个域名下，会存储相同一段 **localStorage / Cookie**，而不同在：

- 容量：针对每个域名，均有上限为 5M 的存储容量；
- 安全：只存在客户端，默认不参与与服务端通信；
- 接口：接口友好，通过 `localStorage` 全局暴露，拥有诸多方法可供操作(Cookie 只能自定义)；

### 3-2-2、操作方式

**localStorage**  存储的都是字符串，若是存储对象需要调用 `JSON.stringify`方法，并且用 `JSON.parse `来解析成对象；

### 3-2-3、应用场景

适合存储一些内容稳定的资源，比如官网的`logo`，存储`Base64`格式的图片资源，因此利用`localStorage`；



## 3-3、sessionStorage

### 3-3-1、与 sessionStorage 的异同

最大区别在：**sessionStorage** 只是会话级别的存储，并非持久化存储，一旦会话结束(当前 tab 页面关闭)就消失；

- 容量：容量上限也为 5M；
- 安全：只存在客户端，默认不参与与服务端的通信；
- 接口：接口友好，类似 **localStorage**；

### 3-3-2、应用场景

- 表单信息进行维护：将表单信息存储在里面，可保证页面即使刷新也不会让先前表单信息丢失；
- 存储本次浏览记录：因关闭页面后不需要这些记录；



## 3-5、IndexedDB

其实运行在浏览器中的 <u>非关系型数据库</u>，理论上容量是无上限；[使用文档](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API/Using_IndexedDB)，其拥有数据库本身的特性，比如：支持事务，存储二进制数据，还有其他特殊特性：

- 键值对存储：内部采用 <u>对象仓库</u> 存放数据，在此仓库中数据采用 <u>键值对</u> 形式存储；
- 异步操作：数据库的读写属于 I/O 操作，浏览器中对异步 I/O 提供了支持；
- 受同源策略限制，无法访问跨域的数据库；



## 3-6、总结

- Cookie 并不适合存储，而且存在非常多的缺陷；
- Web Storage 包括 localStorage 和 sessionStorage，默认不会参与和服务器的通信；
- IndexedDB 为运行在浏览器上的非关系型数据库，为大型数据的存储提供了接口；


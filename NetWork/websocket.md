---
typora-root-url: ../Source
---

### 一、问题与解决

#### 		1-1、问题

​		HTTP不支持持久连接。所谓的 keep-alive(1.1) 是指在一次TCP连接中完成多个HTTP请求，但每一请求仍需单独发送header；所谓的 polling 是指客户端不断主动向服务器发送 HTTP 请求查询是否有新数据；上述模式建立的长连接是长连接(伪)，<u>通讯双方需大量交换HTTP header</u>(无状态协议，须头部以鉴别)，信息交换效率低下(但实现简单，无需作架构升级即可使用)；

​		在这种环境下，过去客户端想要及时获取更新一般基于两种形式：Ajax轮询 和 long poll；前者原理简单粗暴，即每间隔一定时间就向服务器发送请求，询问是否有最新消息；后者则在轮询基础上，采取阻塞模型(客户端发起连接后，服务器等待直至有新消息才响应请求，随后客户端再次发起同样连接...)；<u>服务端无法主动联系客户端</u>，应对轮询需要有较快的处理速度与相应资源，应对 long poll 需要有高并发处理能力，不管如何都会<u>增加服务端的压力</u>；

#### 	1-2、解决

​		Websocket，HTML5新出的持久化协议(相对于非持久的HTTP)，可看作是HTTP协议的补充或拓展补丁，旨在实现通讯双方长连接(真)，是解决 HTTP 本身无法解决的问题而做出的一个改良设计。

​		Websocket 通过首个 HTTP Request 建立 TCP 连接后(通讯双方须进行协议升级-后文提到)，后续进行数据交换时便不用再发 HTTP header、双方可同时收发信息(双通道)，由被动发送变为主动发送，减轻了服务端的负担、拥有 multiplexing 功能(不用URI复用同一 Websocket 连接)、维持连接状态(通讯双方能发送 Ping/Pong Frame 监控中间节点的异常情况的发生)；

### 二、优劣

#### 		2-1、优点

​		可主动发送、可同时收发、不必每次发送 header 提高信息交换效率、减轻服务端负担等

#### 		2-2、缺点

​		兼容问题(对旧式等不支持 websocket 的浏览器须作系列兼容处理)、宽带与耗电问题(ping/pong机制-已有相应优化)、可伸缩性较差操作复杂：

![](/Image/Basics/Websocket/1.png)



### 三、协议格式

#### 		3-1、编码格式(传递消息时)

### 四、实现

#### 		4-1、新建连接

#### 		4-2、保持心跳

#### 		4-3、关闭连接

### 五、安全

#### 		5-1、代理污染攻击与掩码防御

### 六、其他

### 七、转自





